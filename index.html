
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Формулы для 1-11 классов</title>
    <style>
        :root {
            --primary: #1e5799;
            --primary-light: #207cca;
            --primary-dark: #1a4a85;
            --secondary: #e63946;
            --secondary-light: #f04958;
            --secondary-dark: #c1121f;
            --bg-primary: #f8f9fa;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f1f1f1;
            --text-primary: #333333;
            --text-secondary: #666666;
            --border: #dddddd;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --accent: var(--primary);
            --accent-hover: #1c4f8c;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
        }
        
        body {
            background-color: #f5f5f5;
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            touch-action: manipulation;
        }
        
        .container {
            width: 95%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 15px;
        }
        
        header {
            text-align: center;
            margin-bottom: 25px;
            padding: 15px;
            background-color: var(--bg-secondary);
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        header h1 {
            font-size: 1.8rem;
            margin-bottom: 8px;
            color: var(--primary);
            font-weight: 600;
        }
        
        header p {
            font-size: 0.95rem;
            opacity: 0.9;
            color: var(--text-secondary);
        }
        
        .tabs {
            display: flex;
            margin-bottom: 15px;
            background-color: var(--bg-tertiary);
            border-radius: 8px;
            overflow: hidden;
            flex-wrap: wrap;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .tab {
            flex: 1;
            padding: 12px 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 2px solid transparent;
            font-weight: 500;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        .tab.active {
            background-color: var(--primary);
            color: white;
            border-bottom: 2px solid var(--secondary);
        }
        
        .tab:hover:not(.active) {
            background-color: var(--accent-hover);
            color: white;
        }
        
        .tab-content {
            display: none;
            background-color: var(--bg-secondary);
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .tab-content.active {
            display: block;
        }
        
        .search-container {
            display: flex;
            margin-bottom: 20px;
            gap: 10px;
            flex-wrap: wrap;
            position: relative;
        }
        
        .search-box {
            flex: 1;
            min-width: 180px;
            padding: 10px 12px;
            background-color: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 5px;
            color: var(--text-primary);
            font-size: 0.95rem;
        }
        
        .search-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background-color: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 0 0 5px 5px;
            max-height: 250px;
            overflow-y: auto;
            z-index: 100;
            display: none;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .suggestion-item {
            padding: 8px 12px;
            cursor: pointer;
            border-bottom: 1px solid var(--border);
            font-size: 0.9rem;
        }
        
        .suggestion-item:hover {
            background-color: var(--primary);
            color: white;
        }
        
        .filter-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .filter-select {
            flex: 1;
            min-width: 140px;
            padding: 10px 12px;
            background-color: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 5px;
            color: var(--text-primary);
            font-size: 0.9rem;
        }
        
        .content {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .sidebar {
            background-color: var(--bg-secondary);
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            width: 100%;
        }
        
        .subject-list {
            list-style-type: none;
        }
        
        .subject-item {
            margin-bottom: 8px;
        }
        
        .subject-title {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background-color: var(--bg-tertiary);
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            border: 1px solid var(--border);
        }
        
        .subject-title:hover {
            background-color: var(--primary);
            color: white;
        }
        
        .arrow {
            transition: transform 0.3s;
            font-size: 0.8rem;
        }
        
        .arrow.rotated {
            transform: rotate(180deg);
        }
        
        .class-list {
            list-style-type: none;
            margin-left: 15px;
            margin-top: 8px;
            display: none;
        }
        
        .class-item {
            margin-bottom: 5px;
        }
        
        .class-title {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 7px;
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
            border-left: 2px solid var(--primary);
        }
        
        .class-title:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .topic-list {
            list-style-type: none;
            margin-left: 15px;
            margin-top: 5px;
            display: none;
        }
        
        .topic-item {
            padding: 5px 8px;
            cursor: pointer;
            transition: background-color 0.3s;
            border-radius: 3px;
            margin: 3px 0;
            border-left: 2px solid transparent;
        }
        
        .topic-item:hover {
            background-color: rgba(255, 255, 255, 0.05);
            border-left: 2px solid var(--primary);
        }
        
        .main-content {
            background-color: var(--bg-secondary);
            border-radius: 10px;
            padding: 15px;
            width: 100%;
        }
        
        .formula-container {
            margin-bottom: 25px;
        }
        
        .formula-title {
            font-size: 1.3rem;
            margin-bottom: 12px;
            color: var(--primary);
            border-bottom: 1px solid var(--border);
            padding-bottom: 8px;
        }
        
        .formula-display {
            background-color: var(--bg-tertiary);
            padding: 12px;
            border-radius: 5px;
            margin-bottom: 15px;
        }
        
        .formula-item {
            background-color: var(--bg-secondary);
            border-radius: 5px;
            padding: 12px;
            margin-bottom: 12px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            border-left: 3px solid var(--primary);
        }
        
        .formula-item h3 {
            margin-bottom: 8px;
            color: var(--primary);
            font-size: 1.1rem;
        }
        
        .formula {
            font-size: 1.1rem;
            text-align: center;
            margin: 8px 0;
            padding: 8px;
            background: #f1f1f1;
            border-radius: 4px;
            font-weight: bold;
            overflow-x: auto;
            white-space: nowrap;
        }
        
        .explanation {
            margin: 8px 0;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        .use-formula-btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 8px;
            transition: background-color 0.3s;
            font-size: 0.85rem;
        }
        
        .use-formula-btn:hover {
            background-color: var(--primary-dark);
        }
        
        .calculator {
            background: var(--bg-tertiary);
            padding: 12px;
            border-radius: 4px;
            margin-top: 15px;
            display: none;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 12px;
        }
        
        .input-field {
            padding: 6px;
            border: 1px solid var(--border);
            border-radius: 4px;
            width: 100%;
            font-size: 0.9rem;
        }
        
        .calculate-btn, .show-steps-btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 8px;
            transition: background-color 0.3s;
            font-size: 0.9rem;
        }
        
        .calculate-btn:hover, .show-steps-btn:hover {
            background-color: var(--primary-dark);
        }
        
        .result {
            margin-top: 12px;
            padding: 8px;
            background: #e9f4fc;
            border-radius: 4px;
            font-size: 1rem;
            display: none;
            word-break: break-word;
        }
        
        .step-by-step {
            margin-top: 15px;
            display: none;
        }
        
        .step-by-step h3 {
            margin-bottom: 8px;
            color: var(--primary);
            font-size: 1.1rem;
        }
        
        .steps-container {
            background: var(--bg-tertiary);
            padding: 12px;
            border-radius: 4px;
        }
        
        .step {
            margin-bottom: 6px;
            padding-left: 8px;
            border-left: 2px solid var(--primary);
            font-size: 0.9rem;
        }
        
        .recommendations {
            background-color: var(--bg-tertiary);
            padding: 12px;
            border-radius: 5px;
            margin-top: 15px;
        }
        
        .recommendations h2 {
            margin-bottom: 12px;
            color: var(--primary);
            font-size: 1.1rem;
        }
        
        .recommendation-item {
            padding: 8px;
            margin-bottom: 8px;
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-size: 0.9rem;
        }
        
        .recommendation-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        /* Калькулятор */
        .calculator-container {
            background-color: var(--bg-secondary);
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            display: none;
        }
        
        .calc-display {
            padding: 12px;
            background-color: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 5px;
            font-size: 1.3rem;
            text-align: right;
            margin-bottom: 8px;
            min-height: 50px;
            word-break: break-all;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            color: var(--text-primary);
            overflow-x: auto;
        }
        
        .calculator-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
        }
        
        .calc-btn {
            padding: 12px 5px;
            border: none;
            border-radius: 5px;
            background-color: var(--bg-tertiary);
            cursor: pointer;
            font-size: 1.1rem;
            transition: background-color 0.3s;
            color: var(--text-primary);
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .calc-btn:hover {
            background-color: var(--accent-hover);
            color: white;
        }
        
        .calc-clear {
            background-color: var(--primary);
            color: white;
        }
        
        .calc-equals {
            background-color: var(--secondary);
            color: white;
        }
        
        .calc-func {
            background-color: #2d4059;
            color: white;
        }
        
        /* Блокнот */
        .notebook-container {
            display: flex;
            flex-direction: column;
            height: 600px;
            background-color: var(--bg-secondary);
            border-radius: 5px;
            padding: 12px;
        }
        
        .notebook-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .notebook-page-indicator {
            font-weight: bold;
            color: var(--primary);
            padding: 4px 8px;
            background-color: var(--bg-tertiary);
            border-radius: 15px;
            font-size: 0.9rem;
        }
        
        .notebook-tools {
            display: flex;
            gap: 8px;
            margin-bottom: 10px;
            flex-wrap: wrap;
            border-bottom: 1px solid var(--border);
            padding-bottom: 8px;
            overflow-x: auto;
            padding-right: 10px;
        }
        
        .tool-btn {
            padding: 6px 10px;
            border: 1px solid var(--border);
            border-radius: 4px;
            background-color: var(--bg-tertiary);
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.85rem;
            min-width: 60px;
            text-align: center;
        }
        
        .tool-btn.active {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .tool-btn[data-tool="color"] {
            width: 25px;
            height: 25px;
            padding: 0;
            border-radius: 50%;
        }
        
        .notebook-content {
            display: flex;
            gap: 15px;
            flex: 1;
            overflow: hidden;
            flex-direction: column;
        }
        
        .notebook-textarea {
            flex: 1;
            min-height: 300px;
            display: none;
            width: 100%;
        }
        
        .notebook-textarea.active {
            display: block;
        }
        
        .notebook-textarea textarea {
            width: 100%;
            height: 100%;
            padding: 12px;
            border: 1px solid var(--border);
            border-radius: 4px;
            resize: none;
            font-size: 1rem;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            min-height: 280px;
        }
        
        .notebook-canvas {
            flex: 1;
            min-height: 300px;
            border: 1px solid var(--border);
            border-radius: 4px;
            background: white;
            display: none;
            position: relative;
            overflow: hidden;
            width: 100%;
        }
        
        .notebook-canvas.active {
            display: block;
        }
        
        .notebook-canvas canvas {
            width: 100%;
            height: 100%;
            display: block;
        }
        
        .notebook-page-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .page-btn {
            padding: 6px 12px;
            background-color: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .page-btn.active {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .notebook-actions {
            margin-top: 10px;
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        
        .notebook-btn {
            padding: 8px 12px;
            border: none;
            border-radius: 4px;
            background-color: var(--primary);
            color: white;
            cursor: pointer;
            transition: background-color 0.3s;
            font-size: 0.9rem;
        }
        
        .notebook-btn:hover {
            background-color: var(--primary-dark);
        }
        
        /* Адаптивность */
        @media (min-width: 768px) {
            .content {
                flex-direction: row;
            }
            
            .sidebar {
                flex: 0 0 280px;
                max-height: 70vh;
                overflow-y: auto;
            }
            
            .main-content {
                flex: 1;
            }
            
            .notebook-content {
                flex-direction: row;
            }
            
            .notebook-textarea, .notebook-canvas {
                min-height: 350px;
            }
        }
        
        @media (min-width: 992px) {
            .sidebar {
                flex: 0 0 300px;
            }
        }
        
        @media (max-width: 767px) {
            .tabs {
                flex-direction: column;
                border-radius: 5px;
            }
            
            .tab {
                border-bottom: 1px solid var(--border);
                border-radius: 0;
            }
            
            .tab:last-child {
                border-bottom-left-radius: 5px;
                border-bottom-right-radius: 5px;
            }
            
            .calculator-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .calc-display {
                grid-column: span 4;
            }
            
            .calc-btn {
                padding: 10px 5px;
                font-size: 1rem;
                height: 45px;
            }
            
            .notebook-content {
                flex-direction: column;
            }
            
            .notebook-textarea, .notebook-canvas {
                min-height: 250px;
            }
            
            .notebook-container {
                height: 650px;
            }
        }
        
        @media (max-width: 576px) {
            header h1 {
                font-size: 1.6rem;
            }
            
            .container {
                padding: 10px;
            }
            
            .search-container {
                flex-direction: column;
            }
            
            .search-box {
                width: 100%;
            }
            
            .calculator-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .notebook-container {
                height: 550px;
            }
            
            .notebook-textarea, .notebook-canvas {
                min-height: 220px;
            }
            
            .calc-btn {
                height: 40px;
                font-size: 0.9rem;
                padding: 8px 5px;
            }
            
            .calc-display {
                font-size: 1.1rem;
                min-height: 45px;
            }
        }
        
        @media (max-width: 480px) {
            .notebook-container {
                height: 500px;
            }
            
            .notebook-textarea, .notebook-canvas {
                min-height: 180px;
            }
            
            .calc-btn {
                height: 35px;
                font-size: 0.8rem;
                padding: 6px 5px;
            }
            
            .calc-display {
                font-size: 1rem;
                min-height: 40px;
            }
            
            .formula-item h3 {
                font-size: 1rem;
            }
            
            .formula {
                font-size: 1rem;
            }
            
            .step {
                font-size: 0.85rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Формулы для 1-11 классов</h1>
            <p>Все формулы по алгебре, геометрии, физике и химии с интерактивными калькуляторами</p>
        </header>
        
        <div class="tabs">
            <div class="tab active" data-tab="formulas">Формулы</div>
            <div class="tab" data-tab="calculator">Инженерный калькулятор</div>
            <div class="tab" data-tab="notebook">Блокнот</div>
        </div>
        
        <!-- Вкладка с формулами -->
        <div class="tab-content active" id="formulas-tab">
            <div class="search-container">
                <input type="text" class="search-box" placeholder="Поиск формулы или темы...">
                <div class="search-suggestions"></div>
            </div>
            
            <div class="filter-controls">
                <select class="filter-select" id="subject-filter">
                    <option value="all">Все предметы</option>
                    <option value="algebra">Алгебра</option>
                    <option value="geometry">Геометрия</option>
                    <option value="physics">Физика</option>
                    <option value="chemistry">Химия</option>
                </select>
                
                <select class="filter-select" id="class-filter">
                    <option value="all">Все классы</option>
                    <option value="1-4">1-4 классы</option>
                    <option value="5-6">5-6 классы</option>
                    <option value="7">7 класс</option>
                    <option value="8">8 класс</option>
                    <option value="9">9 класс</option>
                    <option value="10">10 класс</option>
                    <option value="11">11 класс</option>
                </select>
            </div>
            
            <div class="content">
                <div class="sidebar">
                    <ul class="subject-list">
                        <li class="subject-item">
                            <div class="subject-title">
                                <span>Алгебра</span>
                                <span class="arrow">▼</span>
                            </div>
                            <ul class="class-list">
                                <li class="class-item">
                                    <div class="class-title">
                                        <span>1-4 классы</span>
                                        <span class="arrow">▼</span>
                                    </div>
                                    <ul class="topic-list">
                                        <li class="topic-item" data-subject="algebra" data-class="1-4" data-topic="arithmetic">Арифметические действия</li>
                                        <li class="topic-item" data-subject="algebra" data-class="1-4" data-topic="fractions">Дроби</li>
                                        <li class="topic-item" data-subject="algebra" data-class="1-4" data-topic="units">Единицы измерения</li>
                                    </ul>
                                </li>
                                <li class="class-item">
                                    <div class="class-title">
                                        <span>5-6 классы</span>
                                        <span class="arrow">▼</span>
                                    </div>
                                    <ul class="topic-list">
                                        <li class="topic-item" data-subject="algebra" data-class="5-6" data-topic="decimals">Десятичные дроби</li>
                                        <li class="topic-item" data-subject="algebra" data-class="5-6" data-topic="proportions">Пропорции</li>
                                        <li class="topic-item" data-subject="algebra" data-class="5-6" data-topic="percentages">Проценты</li>
                                    </ul>
                                </li>
                                <li class="class-item">
                                    <div class="class-title">
                                        <span>7 класс</span>
                                        <span class="arrow">▼</span>
                                    </div>
                                    <ul class="topic-list">
                                        <li class="topic-item" data-subject="algebra" data-class="7" data-topic="degree">Степени</li>
                                        <li class="topic-item" data-subject="algebra" data-class="7" data-topic="formulas">Формулы сокращенного умножения</li>
                                        <li class="topic-item" data-subject="algebra" data-class="7" data-topic="linear">Линейные уравнения</li>
                                    </ul>
                                </li>
                                <li class="class-item">
                                    <div class="class-title">
                                        <span>8 класс</span>
                                        <span class="arrow">▼</span>
                                    </div>
                                    <ul class="topic-list">
                                        <li class="topic-item" data-subject="algebra" data-class="8" data-topic="quadratic">Квадратные уравнения</li>
                                        <li class="topic-item" data-subject="algebra" data-class="8" data-topic="inequalities">Неравенства</li>
                                        <li class="topic-item" data-subject="algebra" data-class="8" data-topic="functions">Функции</li>
                                    </ul>
                                </li>
                                <li class="class-item">
                                    <div class="class-title">
                                        <span>9 класс</span>
                                        <span class="arrow">▼</span>
                                    </div>
                                    <ul class="topic-list">
                                        <li class="topic-item" data-subject="algebra" data-class="9" data-topic="progressions">Прогрессии</li>
                                        <li class="topic-item" data-subject="algebra" data-class="9" data-topic="probability">Теория вероятностей</li>
                                        <li class="topic-item" data-subject="algebra" data-class="9" data-topic="statistics">Статистика</li>
                                    </ul>
                                </li>
                                <li class="class-item">
                                    <div class="class-title">
                                        <span>10 класс</span>
                                        <span class="arrow">▼</span>
                                    </div>
                                    <ul class="topic-list">
                                        <li class="topic-item" data-subject="algebra" data-class="10" data-topic="trigonometry">Тригонометрия</li>
                                        <li class="topic-item" data-subject="algebra" data-class="10" data-topic="logarithms">Логарифмы</li>
                                        <li class="topic-item" data-subject="algebra" data-class="10" data-topic="complex">Комплексные числа</li>
                                    </ul>
                                </li>
                                <li class="class-item">
                                    <div class="class-title">
                                        <span>11 класс</span>
                                        <span class="arrow">▼</span>
                                    </div>
                                    <ul class="topic-list">
                                        <li class="topic-item" data-subject="algebra" data-class="11" data-topic="derivatives">Производные</li>
                                        <li class="topic-item" data-subject="algebra" data-class="11" data-topic="integrals">Интегралы</li>
                                        <li class="topic-item" data-subject="algebra" data-class="11" data-topic="limits">Пределы</li>
                                    </ul>
                                </li>
                            </ul>
                        </li>
                        
                        <li class="subject-item">
                            <div class="subject-title">
                                <span>Геометрия</span>
                                <span class="arrow">▼</span>
                            </div>
                            <ul class="class-list">
                                <li class="class-item">
                                    <div class="class-title">
                                        <span>1-4 классы</span>
                                        <span class="arrow">▼</span>
                                    </div>
                                    <ul class="topic-list">
                                        <li class="topic-item" data-subject="geometry" data-class="1-4" data-topic="shapes">Геометрические фигуры</li>
                                        <li class="topic-item" data-subject="geometry" data-class="1-4" data-topic="perimeter">Периметр</li>
                                        <li class="topic-item" data-subject="geometry" data-class="1-4" data-topic="area">Площадь</li>
                                    </ul>
                                </li>
                                <li class="class-item">
                                    <div class="class-title">
                                        <span>5-6 классы</span>
                                        <span class="arrow">▼</span>
                                    </div>
                                    <ul class="topic-list">
                                        <li class="topic-item" data-subject="geometry" data-class="5-6" data-topic="angles">Углы</li>
                                        <li class="topic-item" data-subject="geometry" data-class="5-6" data-topic="symmetry">Симметрия</li>
                                        <li class="topic-item" data-subject="geometry" data-class="5-6" data-topic="circles">Окружность</li>
                                    </ul>
                                </li>
                                <li class="class-item">
                                    <div class="class-title">
                                        <span>7 класс</span>
                                        <span class="arrow">▼</span>
                                    </div>
                                    <ul class="topic-list">
                                        <li class="topic-item" data-subject="geometry" data-class="7" data-topic="triangles">Треугольники</li>
                                        <li class="topic-item" data-subject="geometry" data-class="7" data-topic="quadrilaterals">Четырехугольники</li>
                                        <li class="topic-item" data-subject="geometry" data-class="7" data-topic="vectors">Векторы</li>
                                    </ul>
                                </li>
                                <li class="class-item">
                                    <div class="class-title">
                                        <span>8 класс</span>
                                        <span class="arrow">▼</span>
                                    </div>
                                    <ul class="topic-list">
                                        <li class="topic-item" data-subject="geometry" data-class="8" data-topic="similar-figures">Подобные фигуры</li>
                                        <li class="topic-item" data-subject="geometry" data-class="8" data-topic="circle-theorems">Теоремы об окружности</li>
                                        <li class="topic-item" data-subject="geometry" data-class="8" data-topic="area-volume">Площади и объемы</li>
                                    </ul>
                                </li>
                                <li class="class-item">
                                    <div class="class-title">
                                        <span>9 класс</span>
                                        <span class="arrow">▼</span>
                                    </div>
                                    <ul class="topic-list">
                                        <li class="topic-item" data-subject="geometry" data-class="9" data-topic="coordinate-geometry">Координатная геометрия</li>
                                        <li class="topic-item" data-subject="geometry" data-class="9" data-topic="transformations">Преобразования</li>
                                        <li class="topic-item" data-subject="geometry" data-class="9" data-topic="trigonometry">Тригонометрия в геометрии</li>
                                    </ul>
                                </li>
                                <li class="class-item">
                                    <div class="class-title">
                                        <span>10-11 классы</span>
                                        <span class="arrow">▼</span>
                                    </div>
                                    <ul class="topic-list">
                                        <li class="topic-item" data-subject="geometry" data-class="10-11" data-topic="stereometry">Стереометрия</li>
                                        <li class="topic-item" data-subject="geometry" data-class="10-11" data-topic="vector-geometry">Векторная геометрия</li>
                                        <li class="topic-item" data-subject="geometry" data-class="10-11" data-topic="analytic-geometry">Аналитическая геометрия</li>
                                    </ul>
                                </li>
                            </ul>
                        </li>
                        
                        <li class="subject-item">
                            <div class="subject-title">
                                <span>Физика</span>
                                <span class="arrow">▼</span>
                            </div>
                            <ul class="class-list">
                                <li class="class-item">
                                    <div class="class-title">
                                        <span>7 класс</span>
                                        <span class="arrow">▼</span>
                                    </div>
                                    <ul class="topic-list">
                                        <li class="topic-item" data-subject="physics" data-class="7" data-topic="mechanics">Механика</li>
                                        <li class="topic-item" data-subject="physics" data-class="7" data-topic="thermal">Тепловые явления</li>
                                        <li class="topic-item" data-subject="physics" data-class="7" data-topic="optics">Оптика</li>
                                    </ul>
                                </li>
                                <li class="class-item">
                                    <div class="class-title">
                                        <span>8 класс</span>
                                        <span class="arrow">▼</span>
                                    </div>
                                    <ul class="topic-list">
                                        <li class="topic-item" data-subject="physics" data-class="8" data-topic="electromagnetism">Электромагнетизм</li>
                                        <li class="topic-item" data-subject="physics" data-class="8" data-topic="energy">Энергия</li>
                                        <li class="topic-item" data-subject="physics" data-class="8" data-topic="waves">Волны</li>
                                    </ul>
                                </li>
                                <li class="class-item">
                                    <div class="class-title">
                                        <span>9 класс</span>
                                        <span class="arrow">▼</span>
                                    </div>
                                    <ul class="topic-list">
                                        <li class="topic-item" data-subject="physics" data-class="9" data-topic="kinematics">Кинематика</li>
                                        <li class="topic-item" data-subject="physics" data-class="9" data-topic="dynamics">Динамика</li>
                                        <li class="topic-item" data-subject="physics" data-class="9" data-topic="electromagnetism">Электромагнитные явления</li>
                                    </ul>
                                </li>
                                <li class="class-item">
                                    <div class="class-title">
                                        <span>10 класс</span>
                                        <span class="arrow">▼</span>
                                    </div>
                                    <ul class="topic-list">
                                        <li class="topic-item" data-subject="physics" data-class="10" data-topic="mechanics">Механика</li>
                                        <li class="topic-item" data-subject="physics" data-class="10" data-topic="molecular">Молекулярная физика</li>
                                        <li class="topic-item" data-subject="physics" data-class="10" data-topic="electricity">Электричество</li>
                                    </ul>
                                </li>
                                <li class="class-item">
                                    <div class="class-title">
                                        <span>11 класс</span>
                                        <span class="arrow">▼</span>
                                    </div>
                                    <ul class="topic-list">
                                        <li class="topic-item" data-subject="physics" data-class="11" data-topic="electrodynamics">Электродинамика</li>
                                        <li class="topic-item" data-subject="physics" data-class="11" data-topic="quantum">Квантовая физика</li>
                                        <li class="topic-item" data-subject="physics" data-class="11" data-topic="nuclear">Ядерная физика</li>
                                    </ul>
                                </li>
                            </ul>
                        </li>
                        
                        <li class="subject-item">
                            <div class="subject-title">
                                <span>Химия</span>
                                <span class="arrow">▼</span>
                            </div>
                            <ul class="class-list">
                                <li class="class-item">
                                    <div class="class-title">
                                        <span>8 класс</span>
                                        <span class="arrow">▼</span>
                                    </div>
                                    <ul class="topic-list">
                                        <li class="topic-item" data-subject="chemistry" data-class="8" data-topic="basics">Основы химии</li>
                                        <li class="topic-item" data-subject="chemistry" data-class="8" data-topic="periodic-table">Периодическая таблица</li>
                                        <li class="topic-item" data-subject="chemistry" data-class="8" data-topic="chemical-reactions">Химические реакции</li>
                                    </ul>
                                </li>
                                <li class="class-item">
                                    <div class="class-title">
                                        <span>9 класс</span>
                                        <span class="arrow">▼</span>
                                    </div>
                                    <ul class="topic-list">
                                        <li class="topic-item" data-subject="chemistry" data-class="9" data-topic="inorganic">Неорганическая химия</li>
                                        <li class="topic-item" data-subject="chemistry" data-class="9" data-topic="solutions">Растворы</li>
                                        <li class="topic-item" data-subject="chemistry" data-class="9" data-topic="electrochemistry">Электрохимия</li>
                                    </ul>
                                </li>
                                <li class="class-item">
                                    <div class="class-title">
                                        <span>10 класс</span>
                                        <span class="arrow">▼</span>
                                    </div>
                                    <ul class="topic-list">
                                        <li class="topic-item" data-subject="chemistry" data-class="10" data-topic="organic">Органическая химия</li>
                                        <li class="topic-item" data-subject="chemistry" data-class="10" data-topic="thermodynamics">Термодинамика</li>
                                        <li class="topic-item" data-subject="chemistry" data-class="10" data-topic="kinetics">Кинетика</li>
                                    </ul>
                                </li>
                                <li class="class-item">
                                    <div class="class-title">
                                        <span>11 класс</span>
                                        <span class="arrow">▼</span>
                                    </div>
                                    <ul class="topic-list">
                                        <li class="topic-item" data-subject="chemistry" data-class="11" data-topic="advanced-organic">Продвинутая органическая химия</li>
                                        <li class="topic-item" data-subject="chemistry" data-class="11" data-topic="biochemistry">Биохимия</li>
                                        <li class="topic-item" data-subject="chemistry" data-class="11" data-topic="analytical">Аналитическая химия</li>
                                    </ul>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
                
                <div class="main-content">
                    <div class="formula-container">
                        <h2 class="formula-title">Выберите тему для отображения формул</h2>
                        <div class="formula-display">Формулы появятся здесь после выбора темы</div>
                        <div class="calculator">
                            <div class="input-group">
                                <!-- Поля для ввода появятся здесь динамически -->
                            </div>
                            <button class="calculate-btn">Решить</button>
                            <button class="show-steps-btn">Показать шаги решения</button>
                            <div class="result"></div>
                        </div>
                        <div class="step-by-step">
                            <h3>Пошаговое решение:</h3>
                            <div class="steps-container"></div>
                        </div>
                    </div>
                    
                    <div class="recommendations">
                        <h2>Рекомендуем</h2>
                        <div class="recommendations-list">
                            <div class="recommendation-item">Рекомендации появятся здесь после выбора темы</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Вкладка с калькулятором -->
        <div class="tab-content" id="calculator-tab">
            <div class="calculator-container">
                <div class="calc-display">0</div>
                <div class="calculator-grid">
                    <button class="calc-btn calc-clear">C</button>
                    <button class="calc-btn">⌫</button>
                    <button class="calc-btn calc-func">(</button>
                    <button class="calc-btn calc-func">)</button>
                    
                    <button class="calc-btn calc-func">x²</button>
                    <button class="calc-btn calc-func">x³</button>
                    <button class="calc-btn calc-func">x<sup>y</sup></button>
                    <button class="calc-btn calc-func">√</button>
                    
                    <button class="calc-btn calc-func">sin</button>
                    <button class="calc-btn calc-func">cos</button>
                    <button class="calc-btn calc-func">tan</button>
                    <button class="calc-btn calc-func">log</button>
                    
                    <button class="calc-btn calc-func">7</button>
                    <button class="calc-btn calc-func">8</button>
                    <button class="calc-btn calc-func">9</button>
                    <button class="calc-btn calc-func">÷</button>
                    
                    <button class="calc-btn calc-func">4</button>
                    <button class="calc-btn calc-func">5</button>
                    <button class="calc-btn calc-func">6</button>
                    <button class="calc-btn calc-func">×</button>
                    
                    <button class="calc-btn calc-func">1</button>
                    <button class="calc-btn calc-func">2</button>
                    <button class="calc-btn calc-func">3</button>
                    <button class="calc-btn calc-func">-</button>
                    
                    <button class="calc-btn calc-func">0</button>
                    <button class="calc-btn calc-func">.</button>
                    <button class="calc-btn calc-func">±</button>
                    <button class="calc-btn calc-equals">=</button>
                </div>
            </div>
        </div>
        
        <!-- Вкладка с блокнотом -->
        <div class="tab-content" id="notebook-tab">
            <div class="notebook-container">
                <div class="notebook-header">
                    <div class="notebook-page-indicator">Страница <span id="current-page">1</span>/3</div>
                    <div class="notebook-page-controls">
                        <button class="page-btn" data-page="1">1</button>
                        <button class="page-btn" data-page="2">2</button>
                        <button class="page-btn" data-page="3">3</button>
                    </div>
                </div>
                
                <div class="notebook-tools">
                    <button class="tool-btn active" data-tool="text">Текст</button>
                    <button class="tool-btn" data-tool="draw">Рисование</button>
                    <button class="tool-btn" data-tool="erase">Ластик</button>
                    <button class="tool-btn" data-tool="color" style="background-color: #000000;"></button>
                    <button class="tool-btn" data-tool="color" style="background-color: #ff0000;"></button>
                    <button class="tool-btn" data-tool="color" style="background-color: #00ff00;"></button>
                    <button class="tool-btn" data-tool="color" style="background-color: #0000ff;"></button>
                    <button class="tool-btn" data-tool="color" style="background-color: #ffff00;"></button>
                    <button class="tool-btn" data-tool="color" style="background-color: #000000;"></button>
                </div>
                
                <div class="notebook-content">
                    <div class="notebook-textarea active" id="page1-text">
                        <textarea placeholder="Введите текст здесь..."></textarea>
                    </div>
                    <div class="notebook-textarea" id="page2-text">
                        <textarea placeholder="Введите текст здесь..."></textarea>
                    </div>
                    <div class="notebook-textarea" id="page3-text">
                        <textarea placeholder="Введите текст здесь..."></textarea>
                    </div>
                    
                    <div class="notebook-canvas" id="page1-canvas">
                        <canvas></canvas>
                    </div>
                    <div class="notebook-canvas" id="page2-canvas">
                        <canvas></canvas>
                    </div>
                    <div class="notebook-canvas" id="page3-canvas">
                        <canvas></canvas>
                    </div>
                </div>
                
                <div class="notebook-actions">
                    <button class="notebook-btn clear-btn">Очистить</button>
                    <button class="notebook-btn save-btn">Сохранить</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Расширенная база формул
        const formulasData = {
            algebra: {
                "1-4": {
                    arithmetic: {
                        title: "Арифметические действия",
                        formulas: [
                            {
                                name: "Сложение",
                                formula: "a + b = c",
                                explanation: "Сложение - это операция объединения двух чисел в одно.",
                                calculator: {
                                    inputs: [
                                        { label: "a", value: "" },
                                        { label: "b", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const b = parseFloat(inputs.b);
                                        if (isNaN(a) || isNaN(b)) return "Введите числа";
                                        return a + b;
                                    },
                                    steps: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const b = parseFloat(inputs.b);
                                        if (isNaN(a) || isNaN(b)) return ["Введите числа"];
                                        return [
                                            `Шаг 1: Записываем числа: ${a} и ${b}`,
                                            `Шаг 2: Складываем единицы: ${a} + ${b}`,
                                            `Шаг 3: Получаем результат: ${a + b}`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Вычитание",
                                formula: "a - b = c",
                                explanation: "Вычитание - это операция нахождения разности двух чисел.",
                                calculator: {
                                    inputs: [
                                        { label: "a", value: "" },
                                        { label: "b", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const b = parseFloat(inputs.b);
                                        if (isNaN(a) || isNaN(b)) return "Введите числа";
                                        return a - b;
                                    },
                                    steps: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const b = parseFloat(inputs.b);
                                        if (isNaN(a) || isNaN(b)) return ["Введите числа"];
                                        return [
                                            `Шаг 1: Записываем числа: ${a} и ${b}`,
                                            `Шаг 2: Вычитаем: ${a} - ${b}`,
                                            `Шаг 3: Получаем результат: ${a - b}`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Умножение",
                                formula: "a × b = c",
                                explanation: "Умножение - это операция многократного сложения числа.",
                                calculator: {
                                    inputs: [
                                        { label: "a", value: "" },
                                        { label: "b", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const b = parseFloat(inputs.b);
                                        if (isNaN(a) || isNaN(b)) return "Введите числа";
                                        return a * b;
                                    },
                                    steps: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const b = parseFloat(inputs.b);
                                        if (isNaN(a) || isNaN(b)) return ["Введите числа"];
                                        return [
                                            `Шаг 1: Записываем числа: ${a} и ${b}`,
                                            `Шаг 2: Умножаем: ${a} × ${b}`,
                                            `Шаг 3: Получаем результат: ${a * b}`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Деление",
                                formula: "a ÷ b = c",
                                explanation: "Деление - это операция нахождения количества раз, которое одно число содержится в другом.",
                                calculator: {
                                    inputs: [
                                        { label: "a", value: "" },
                                        { label: "b", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const b = parseFloat(inputs.b);
                                        if (isNaN(a) || isNaN(b)) return "Введите числа";
                                        if (b === 0) return "Ошибка: деление на ноль";
                                        return a / b;
                                    },
                                    steps: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const b = parseFloat(inputs.b);
                                        if (isNaN(a) || isNaN(b)) return ["Введите числа"];
                                        if (b === 0) return ["Ошибка: деление на ноль"];
                                        return [
                                            `Шаг 1: Записываем числа: ${a} и ${b}`,
                                            `Шаг 2: Делим: ${a} ÷ ${b}`,
                                            `Шаг 3: Получаем результат: ${a / b}`
                                        ];
                                    }
                                }
                            }
                        ]
                    },
                    fractions: {
                        title: "Дроби",
                        formulas: [
                            {
                                name: "Сложение дробей",
                                formula: "a/b + c/d = (ad + bc)/(bd)",
                                explanation: "Чтобы сложить дроби с разными знаменателями, нужно привести их к общему знаменателю.",
                                calculator: {
                                    inputs: [
                                        { label: "a", value: "" },
                                        { label: "b", value: "" },
                                        { label: "c", value: "" },
                                        { label: "d", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const b = parseFloat(inputs.b);
                                        const c = parseFloat(inputs.c);
                                        const d = parseFloat(inputs.d);
                                        if (isNaN(a) || isNaN(b) || isNaN(c) || isNaN(d)) return "Введите все значения";
                                        if (b === 0 || d === 0) return "Ошибка: знаменатель не может быть нулем";
                                        return (a*d + b*c) + "/" + (b*d);
                                    },
                                    steps: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const b = parseFloat(inputs.b);
                                        const c = parseFloat(inputs.c);
                                        const d = parseFloat(inputs.d);
                                        if (isNaN(a) || isNaN(b) || isNaN(c) || isNaN(d)) return ["Введите все значения"];
                                        if (b === 0 || d === 0) return ["Ошибка: знаменатель не может быть нулем"];
                                        return [
                                            `Шаг 1: Записываем дроби: ${a}/${b} и ${c}/${d}`,
                                            `Шаг 2: Находим общий знаменатель: ${b} × ${d} = ${b*d}`,
                                            `Шаг 3: Приводим дроби к общему знаменателю: ${a*d}/${b*d} и ${c*b}/${b*d}`,
                                            `Шаг 4: Складываем числители: ${a*d} + ${c*b} = ${a*d + c*b}`,
                                            `Шаг 5: Получаем результат: ${a*d + c*b}/${b*d}`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Вычитание дробей",
                                formula: "a/b - c/d = (ad - bc)/(bd)",
                                explanation: "Чтобы вычесть дроби с разными знаменателями, нужно привести их к общему знаменателю.",
                                calculator: {
                                    inputs: [
                                        { label: "a", value: "" },
                                        { label: "b", value: "" },
                                        { label: "c", value: "" },
                                        { label: "d", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const b = parseFloat(inputs.b);
                                        const c = parseFloat(inputs.c);
                                        const d = parseFloat(inputs.d);
                                        if (isNaN(a) || isNaN(b) || isNaN(c) || isNaN(d)) return "Введите все значения";
                                        if (b === 0 || d === 0) return "Ошибка: знаменатель не может быть нулем";
                                        return (a*d - b*c) + "/" + (b*d);
                                    },
                                    steps: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const b = parseFloat(inputs.b);
                                        const c = parseFloat(inputs.c);
                                        const d = parseFloat(inputs.d);
                                        if (isNaN(a) || isNaN(b) || isNaN(c) || isNaN(d)) return ["Введите все значения"];
                                        if (b === 0 || d === 0) return ["Ошибка: знаменатель не может быть нулем"];
                                        return [
                                            `Шаг 1: Записываем дроби: ${a}/${b} и ${c}/${d}`,
                                            `Шаг 2: Находим общий знаменатель: ${b} × ${d} = ${b*d}`,
                                            `Шаг 3: Приводим дроби к общему знаменателю: ${a*d}/${b*d} и ${c*b}/${b*d}`,
                                            `Шаг 4: Вычитаем числители: ${a*d} - ${c*b} = ${a*d - c*b}`,
                                            `Шаг 5: Получаем результат: ${a*d - c*b}/${b*d}`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Умножение дробей",
                                formula: "(a/b) × (c/d) = (a×c)/(b×d)",
                                explanation: "Чтобы умножить дроби, нужно перемножить числители и знаменатели.",
                                calculator: {
                                    inputs: [
                                        { label: "a", value: "" },
                                        { label: "b", value: "" },
                                        { label: "c", value: "" },
                                        { label: "d", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const b = parseFloat(inputs.b);
                                        const c = parseFloat(inputs.c);
                                        const d = parseFloat(inputs.d);
                                        if (isNaN(a) || isNaN(b) || isNaN(c) || isNaN(d)) return "Введите все значения";
                                        if (b === 0 || d === 0) return "Ошибка: знаменатель не может быть нулем";
                                        return (a*c) + "/" + (b*d);
                                    },
                                    steps: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const b = parseFloat(inputs.b);
                                        const c = parseFloat(inputs.c);
                                        const d = parseFloat(inputs.d);
                                        if (isNaN(a) || isNaN(b) || isNaN(c) || isNaN(d)) return ["Введите все значения"];
                                        if (b === 0 || d === 0) return ["Ошибка: знаменатель не может быть нулем"];
                                        return [
                                            `Шаг 1: Записываем дроби: ${a}/${b} и ${c}/${d}`,
                                            `Шаг 2: Перемножаем числители: ${a} × ${c} = ${a*c}`,
                                            `Шаг 3: Перемножаем знаменатели: ${b} × ${d} = ${b*d}`,
                                            `Шаг 4: Получаем результат: ${a*c}/${b*d}`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Деление дробей",
                                formula: "(a/b) ÷ (c/d) = (a/b) × (d/c) = (a×d)/(b×c)",
                                explanation: "Чтобы разделить дроби, нужно умножить первую дробь на обратную второй.",
                                calculator: {
                                    inputs: [
                                        { label: "a", value: "" },
                                        { label: "b", value: "" },
                                        { label: "c", value: "" },
                                        { label: "d", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const b = parseFloat(inputs.b);
                                        const c = parseFloat(inputs.c);
                                        const d = parseFloat(inputs.d);
                                        if (isNaN(a) || isNaN(b) || isNaN(c) || isNaN(d)) return "Введите все значения";
                                        if (b === 0 || c === 0 || d === 0) return "Ошибка: знаменатель не может быть нулем";
                                        return (a*d) + "/" + (b*c);
                                    },
                                    steps: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const b = parseFloat(inputs.b);
                                        const c = parseFloat(inputs.c);
                                        const d = parseFloat(inputs.d);
                                        if (isNaN(a) || isNaN(b) || isNaN(c) || isNaN(d)) return ["Введите все значения"];
                                        if (b === 0 || c === 0 || d === 0) return ["Ошибка: знаменатель не может быть нулем"];
                                        return [
                                            `Шаг 1: Записываем дроби: ${a}/${b} ÷ ${c}/${d}`,
                                            `Шаг 2: Берем обратную дробь для второй дроби: ${d}/${c}`,
                                            `Шаг 3: Перемножаем дроби: ${a}/${b} × ${d}/${c}`,
                                            `Шаг 4: Перемножаем числители: ${a} × ${d} = ${a*d}`,
                                            `Шаг 5: Перемножаем знаменатели: ${b} × ${c} = ${b*c}`,
                                            `Шаг 6: Получаем результат: ${a*d}/${b*c}`
                                        ];
                                    }
                                }
                            }
                        ]
                    },
                    units: {
                        title: "Единицы измерения",
                        formulas: [
                            {
                                name: "Конвертация метров в сантиметры",
                                formula: "см = м × 100",
                                explanation: "Для перевода метров в сантиметры умножаем на 100.",
                                calculator: {
                                    inputs: [
                                        { label: "метры", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const meters = parseFloat(inputs['метры']);
                                        if (isNaN(meters)) return "Введите значение";
                                        return meters * 100;
                                    },
                                    steps: function(inputs) {
                                        const meters = parseFloat(inputs['метры']);
                                        if (isNaN(meters)) return ["Введите значение"];
                                        return [
                                            `Шаг 1: Записываем количество метров: ${meters}`,
                                            `Шаг 2: Умножаем на 100: ${meters} × 100`,
                                            `Шаг 3: Получаем результат: ${meters * 100} см`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Конвертация килограммов в граммы",
                                formula: "г = кг × 1000",
                                explanation: "Для перевода килограммов в граммы умножаем на 1000.",
                                calculator: {
                                    inputs: [
                                        { label: "килограммы", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const kg = parseFloat(inputs['килограммы']);
                                        if (isNaN(kg)) return "Введите значение";
                                        return kg * 1000;
                                    },
                                    steps: function(inputs) {
                                        const kg = parseFloat(inputs['килограммы']);
                                        if (isNaN(kg)) return ["Введите значение"];
                                        return [
                                            `Шаг 1: Записываем количество килограммов: ${kg}`,
                                            `Шаг 2: Умножаем на 1000: ${kg} × 1000`,
                                            `Шаг 3: Получаем результат: ${kg * 1000} г`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Конвертация часов в минуты",
                                formula: "мин = ч × 60",
                                explanation: "Для перевода часов в минуты умножаем на 60.",
                                calculator: {
                                    inputs: [
                                        { label: "часы", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const hours = parseFloat(inputs['часы']);
                                        if (isNaN(hours)) return "Введите значение";
                                        return hours * 60;
                                    },
                                    steps: function(inputs) {
                                        const hours = parseFloat(inputs['часы']);
                                        if (isNaN(hours)) return ["Введите значение"];
                                        return [
                                            `Шаг 1: Записываем количество часов: ${hours}`,
                                            `Шаг 2: Умножаем на 60: ${hours} × 60`,
                                            `Шаг 3: Получаем результат: ${hours * 60} мин`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Конвертация минут в секунды",
                                formula: "сек = мин × 60",
                                explanation: "Для перевода минут в секунды умножаем на 60.",
                                calculator: {
                                    inputs: [
                                        { label: "минуты", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const minutes = parseFloat(inputs['минуты']);
                                        if (isNaN(minutes)) return "Введите значение";
                                        return minutes * 60;
                                    },
                                    steps: function(inputs) {
                                        const minutes = parseFloat(inputs['минуты']);
                                        if (isNaN(minutes)) return ["Введите значение"];
                                        return [
                                            `Шаг 1: Записываем количество минут: ${minutes}`,
                                            `Шаг 2: Умножаем на 60: ${minutes} × 60`,
                                            `Шаг 3: Получаем результат: ${minutes * 60} сек`
                                        ];
                                    }
                                }
                            }
                        ]
                    }
                },
                "5-6": {
                    decimals: {
                        title: "Десятичные дроби",
                        formulas: [
                            {
                                name: "Сложение десятичных дробей",
                                formula: "a,b + c,d = e,f",
                                explanation: "Для сложения десятичных дробей нужно выровнять десятичные точки и сложить числа как обычные.",
                                calculator: {
                                    inputs: [
                                        { label: "Первое число", value: "" },
                                        { label: "Второе число", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const num1 = parseFloat(inputs['Первое число'].replace(',', '.'));
                                        const num2 = parseFloat(inputs['Второе число'].replace(',', '.'));
                                        if (isNaN(num1) || isNaN(num2)) return "Ошибка: введите корректные числа";
                                        return (num1 + num2).toFixed(2);
                                    },
                                    steps: function(inputs) {
                                        const num1 = parseFloat(inputs['Первое число'].replace(',', '.'));
                                        const num2 = parseFloat(inputs['Второе число'].replace(',', '.'));
                                        if (isNaN(num1) || isNaN(num2)) return ["Ошибка: введите корректные числа"];
                                        return [
                                            `Шаг 1: Записываем числа: ${num1} и ${num2}`,
                                            `Шаг 2: Выравниваем десятичные точки`,
                                            `Шаг 3: Складываем как обычные числа: ${num1} + ${num2}`,
                                            `Шаг 4: Получаем результат: ${(num1 + num2).toFixed(2)}`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Вычитание десятичных дробей",
                                formula: "a,b - c,d = e,f",
                                explanation: "Для вычитания десятичных дробей нужно выровнять десятичные точки и вычесть числа как обычные.",
                                calculator: {
                                    inputs: [
                                        { label: "Первое число", value: "" },
                                        { label: "Второе число", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const num1 = parseFloat(inputs['Первое число'].replace(',', '.'));
                                        const num2 = parseFloat(inputs['Второе число'].replace(',', '.'));
                                        if (isNaN(num1) || isNaN(num2)) return "Ошибка: введите корректные числа";
                                        return (num1 - num2).toFixed(2);
                                    },
                                    steps: function(inputs) {
                                        const num1 = parseFloat(inputs['Первое число'].replace(',', '.'));
                                        const num2 = parseFloat(inputs['Второе число'].replace(',', '.'));
                                        if (isNaN(num1) || isNaN(num2)) return ["Ошибка: введите корректные числа"];
                                        return [
                                            `Шаг 1: Записываем числа: ${num1} и ${num2}`,
                                            `Шаг 2: Выравниваем десятичные точки`,
                                            `Шаг 3: Вычитаем как обычные числа: ${num1} - ${num2}`,
                                            `Шаг 4: Получаем результат: ${(num1 - num2).toFixed(2)}`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Умножение десятичных дробей",
                                formula: "a,b × c,d = e,f",
                                explanation: "Для умножения десятичных дробей умножаем как целые числа, затем ставим десятичную точку.",
                                calculator: {
                                    inputs: [
                                        { label: "Первое число", value: "" },
                                        { label: "Второе число", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const num1 = parseFloat(inputs['Первое число'].replace(',', '.'));
                                        const num2 = parseFloat(inputs['Второе число'].replace(',', '.'));
                                        if (isNaN(num1) || isNaN(num2)) return "Ошибка: введите корректные числа";
                                        return (num1 * num2).toFixed(4);
                                    },
                                    steps: function(inputs) {
                                        const num1 = parseFloat(inputs['Первое число'].replace(',', '.'));
                                        const num2 = parseFloat(inputs['Второе число'].replace(',', '.'));
                                        if (isNaN(num1) || isNaN(num2)) return ["Ошибка: введите корректные числа"];
                                        return [
                                            `Шаг 1: Записываем числа: ${num1} и ${num2}`,
                                            `Шаг 2: Умножаем как целые числа: ${num1} × ${num2}`,
                                            `Шаг 3: Считаем количество знаков после запятой: ${num1.toString().split('.')[1]?.length || 0} + ${num2.toString().split('.')[1]?.length || 0} = ${((num1.toString().split('.')[1] || '').length + (num2.toString().split('.')[1] || '').length)}`,
                                            `Шаг 4: Ставим десятичную точку: ${(num1 * num2).toFixed(4)}`,
                                            `Шаг 5: Получаем результат: ${(num1 * num2).toFixed(4)}`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Деление десятичных дробей",
                                formula: "a,b ÷ c,d = e,f",
                                explanation: "Для деления десятичных дробей переносим запятую в делителе до целого числа и делаем то же самое с делимым.",
                                calculator: {
                                    inputs: [
                                        { label: "Делимое", value: "" },
                                        { label: "Делитель", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const dividend = parseFloat(inputs['Делимое'].replace(',', '.'));
                                        const divisor = parseFloat(inputs['Делитель'].replace(',', '.'));
                                        if (isNaN(dividend) || isNaN(divisor) || divisor === 0) return "Ошибка: введите корректные числа или делитель не может быть нулем";
                                        return (dividend / divisor).toFixed(4);
                                    },
                                    steps: function(inputs) {
                                        const dividend = parseFloat(inputs['Делимое'].replace(',', '.'));
                                        const divisor = parseFloat(inputs['Делитель'].replace(',', '.'));
                                        if (isNaN(dividend) || isNaN(divisor) || divisor === 0) return ["Ошибка: введите корректные числа или делитель не может быть нулем"];
                                        return [
                                            `Шаг 1: Записываем числа: ${dividend} ÷ ${divisor}`,
                                            `Шаг 2: Переносим запятую в делителе до целого числа: ${divisor} → ${(divisor * Math.pow(10, (divisor.toString().split('.')[1] || '').length)).toFixed(0)}`,
                                            `Шаг 3: Переносим запятую в делимом на то же количество знаков: ${dividend} → ${(dividend * Math.pow(10, (divisor.toString().split('.')[1] || '').length)).toFixed((dividend.toString().split('.')[1] || '').length + (divisor.toString().split('.')[1] || '').length)}`,
                                            `Шаг 4: Делим как целые числа: ${(dividend * Math.pow(10, (divisor.toString().split('.')[1] || '').length)).toFixed(0)} ÷ ${(divisor * Math.pow(10, (divisor.toString().split('.')[1] || '').length)).toFixed(0)}`,
                                            `Шаг 5: Получаем результат: ${(dividend / divisor).toFixed(4)}`
                                        ];
                                    }
                                }
                            }
                        ]
                    },
                    proportions: {
                        title: "Пропорции",
                        formulas: [
                            {
                                name: "Основное свойство пропорции",
                                formula: "a/b = c/d ⇒ a × d = b × c",
                                explanation: "Произведение крайних членов пропорции равно произведению средних.",
                                calculator: {
                                    inputs: [
                                        { label: "a", value: "" },
                                        { label: "b", value: "" },
                                        { label: "c", value: "" },
                                        { label: "d", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const b = parseFloat(inputs.b);
                                        const c = parseFloat(inputs.c);
                                        const d = parseFloat(inputs.d);
                                        if (isNaN(a) || isNaN(b) || isNaN(c) || isNaN(d)) return "Введите все значения";
                                        if (b === 0 || d === 0) return "Ошибка: деление на ноль";
                                        if (a * d === b * c) {
                                            return "Пропорция верна";
                                        } else {
                                            return "Пропорция неверна";
                                        }
                                    },
                                    steps: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const b = parseFloat(inputs.b);
                                        const c = parseFloat(inputs.c);
                                        const d = parseFloat(inputs.d);
                                        if (isNaN(a) || isNaN(b) || isNaN(c) || isNaN(d)) return ["Введите все значения"];
                                        if (b === 0 || d === 0) return ["Ошибка: деление на ноль"];
                                        return [
                                            `Шаг 1: Записываем пропорцию: ${a}/${b} = ${c}/${d}`,
                                            `Шаг 2: Проверяем основное свойство: ${a} × ${d} = ${b} × ${c}`,
                                            `Шаг 3: Вычисляем: ${a * d} = ${b * c}`,
                                            `Шаг 4: Результат: ${a * d === b * c ? 'Пропорция верна' : 'Пропорция неверна'}`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Нахождение неизвестного члена пропорции",
                                formula: "x = (a × b) / c",
                                explanation: "Чтобы найти неизвестный член пропорции, нужно перемножить известные члены и разделить на оставшийся известный член.",
                                calculator: {
                                    inputs: [
                                        { label: "a", value: "" },
                                        { label: "b", value: "" },
                                        { label: "c", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const b = parseFloat(inputs.b);
                                        const c = parseFloat(inputs.c);
                                        if (isNaN(a) || isNaN(b) || isNaN(c)) return "Введите все значения";
                                        if (c === 0) return "Ошибка: деление на ноль";
                                        return (a * b) / c;
                                    },
                                    steps: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const b = parseFloat(inputs.b);
                                        const c = parseFloat(inputs.c);
                                        if (isNaN(a) || isNaN(b) || isNaN(c)) return ["Введите все значения"];
                                        if (c === 0) return ["Ошибка: деление на ноль"];
                                        return [
                                            `Шаг 1: Записываем пропорцию: x/${a} = ${b}/${c}`,
                                            `Шаг 2: Применяем основное свойство: x × ${c} = ${a} × ${b}`,
                                            `Шаг 3: Вычисляем: x × ${c} = ${a * b}`,
                                            `Шаг 4: Делим на ${c}: x = ${a * b} / ${c}`,
                                            `Шаг 5: Получаем результат: x = ${(a * b) / c}`
                                        ];
                                    }
                                }
                            }
                        ]
                    },
                    percentages: {
                        title: "Проценты",
                        formulas: [
                            {
                                name: "Нахождение процента от числа",
                                formula: "x% от y = (x × y) / 100",
                                explanation: "Чтобы найти процент от числа, нужно умножить число на процент и разделить на 100.",
                                calculator: {
                                    inputs: [
                                        { label: "процент", value: "" },
                                        { label: "число", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const percent = parseFloat(inputs['процент']);
                                        const number = parseFloat(inputs['число']);
                                        if (isNaN(percent) || isNaN(number)) return "Введите значения";
                                        return (percent * number) / 100;
                                    },
                                    steps: function(inputs) {
                                        const percent = parseFloat(inputs['процент']);
                                        const number = parseFloat(inputs['число']);
                                        if (isNaN(percent) || isNaN(number)) return ["Введите значения"];
                                        return [
                                            `Шаг 1: Записываем значения: ${percent}% от ${number}`,
                                            `Шаг 2: Умножаем процент на число: ${percent} × ${number}`,
                                            `Шаг 3: Делим на 100: (${percent} × ${number}) / 100`,
                                            `Шаг 4: Получаем результат: ${(percent * number) / 100}`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Нахождение числа по его проценту",
                                formula: "y = (x × 100) / p",
                                explanation: "Чтобы найти число по известному проценту и его значению, нужно умножить значение на 100 и разделить на процент.",
                                calculator: {
                                    inputs: [
                                        { label: "значение", value: "" },
                                        { label: "процент", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const value = parseFloat(inputs['значение']);
                                        const percent = parseFloat(inputs['процент']);
                                        if (isNaN(value) || isNaN(percent)) return "Введите значения";
                                        if (percent === 0) return "Ошибка: процент не может быть нулем";
                                        return (value * 100) / percent;
                                    },
                                    steps: function(inputs) {
                                        const value = parseFloat(inputs['значение']);
                                        const percent = parseFloat(inputs['процент']);
                                        if (isNaN(value) || isNaN(percent)) return ["Введите значения"];
                                        if (percent === 0) return ["Ошибка: процент не может быть нулем"];
                                        return [
                                            `Шаг 1: Записываем значения: ${value} это ${percent}% от числа`,
                                            `Шаг 2: Умножаем значение на 100: ${value} × 100`,
                                            `Шаг 3: Делим на процент: (${value} × 100) / ${percent}`,
                                            `Шаг 4: Получаем результат: ${(value * 100) / percent}`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Нахождение процентного отношения",
                                formula: "p = (x / y) × 100",
                                explanation: "Чтобы найти процентное отношение двух чисел, нужно разделить первое число на второе и умножить на 100.",
                                calculator: {
                                    inputs: [
                                        { label: "число", value: "" },
                                        { label: "целое", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const number = parseFloat(inputs['число']);
                                        const whole = parseFloat(inputs['целое']);
                                        if (isNaN(number) || isNaN(whole)) return "Введите значения";
                                        if (whole === 0) return "Ошибка: целое не может быть нулем";
                                        return (number / whole) * 100;
                                    },
                                    steps: function(inputs) {
                                        const number = parseFloat(inputs['число']);
                                        const whole = parseFloat(inputs['целое']);
                                        if (isNaN(number) || isNaN(whole)) return ["Введите значения"];
                                        if (whole === 0) return ["Ошибка: целое не может быть нулем"];
                                        return [
                                            `Шаг 1: Записываем значения: ${number} от ${whole}`,
                                            `Шаг 2: Делим число на целое: ${number} / ${whole}`,
                                            `Шаг 3: Умножаем на 100: (${number} / ${whole}) × 100`,
                                            `Шаг 4: Получаем результат: ${(number / whole) * 100}%`
                                        ];
                                    }
                                }
                            }
                        ]
                    }
                },
                7: {
                    degree: {
                        title: "Степени",
                        formulas: [
                            {
                                name: "Умножение степеней с одинаковым основанием",
                                formula: "a<sup>m</sup> × a<sup>n</sup> = a<sup>m+n</sup>",
                                explanation: "При умножении степеней с одинаковым основанием показатели складываются.",
                                calculator: {
                                    inputs: [
                                        { label: "a", value: "" },
                                        { label: "m", value: "" },
                                        { label: "n", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const m = parseFloat(inputs.m);
                                        const n = parseFloat(inputs.n);
                                        if (isNaN(a) || isNaN(m) || isNaN(n)) return "Введите значения";
                                        return Math.pow(a, m + n);
                                    },
                                    steps: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const m = parseFloat(inputs.m);
                                        const n = parseFloat(inputs.n);
                                        if (isNaN(a) || isNaN(m) || isNaN(n)) return ["Введите значения"];
                                        return [
                                            `Шаг 1: Записываем выражение: ${a}<sup>${m}</sup> × ${a}<sup>${n}</sup>`,
                                            `Шаг 2: Складываем показатели: ${m} + ${n} = ${m + n}`,
                                            `Шаг 3: Получаем результат: ${a}<sup>${m + n}</sup> = ${Math.pow(a, m + n)}`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Деление степеней с одинаковым основанием",
                                formula: "a<sup>m</sup> ÷ a<sup>n</sup> = a<sup>m-n</sup>",
                                explanation: "При делении степеней с одинаковым основанием показатели вычитаются.",
                                calculator: {
                                    inputs: [
                                        { label: "a", value: "" },
                                        { label: "m", value: "" },
                                        { label: "n", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const m = parseFloat(inputs.m);
                                        const n = parseFloat(inputs.n);
                                        if (isNaN(a) || isNaN(m) || isNaN(n)) return "Введите значения";
                                        if (a === 0 && m <= n) return "Ошибка: деление на ноль";
                                        return Math.pow(a, m - n);
                                    },
                                    steps: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const m = parseFloat(inputs.m);
                                        const n = parseFloat(inputs.n);
                                        if (isNaN(a) || isNaN(m) || isNaN(n)) return ["Введите значения"];
                                        if (a === 0 && m <= n) return ["Ошибка: деление на ноль"];
                                        return [
                                            `Шаг 1: Записываем выражение: ${a}<sup>${m}</sup> ÷ ${a}<sup>${n}</sup>`,
                                            `Шаг 2: Вычитаем показатели: ${m} - ${n} = ${m - n}`,
                                            `Шаг 3: Получаем результат: ${a}<sup>${m - n}</sup> = ${Math.pow(a, m - n)}`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Возведение степени в степень",
                                formula: "(a<sup>m</sup>)<sup>n</sup> = a<sup>m×n</sup>",
                                explanation: "При возведении степени в степень показатели перемножаются.",
                                calculator: {
                                    inputs: [
                                        { label: "a", value: "" },
                                        { label: "m", value: "" },
                                        { label: "n", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const m = parseFloat(inputs.m);
                                        const n = parseFloat(inputs.n);
                                        if (isNaN(a) || isNaN(m) || isNaN(n)) return "Введите значения";
                                        return Math.pow(a, m * n);
                                    },
                                    steps: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const m = parseFloat(inputs.m);
                                        const n = parseFloat(inputs.n);
                                        if (isNaN(a) || isNaN(m) || isNaN(n)) return ["Введите значения"];
                                        return [
                                            `Шаг 1: Записываем выражение: (${a}<sup>${m}</sup>)<sup>${n}</sup>`,
                                            `Шаг 2: Перемножаем показатели: ${m} × ${n} = ${m * n}`,
                                            `Шаг 3: Получаем результат: ${a}<sup>${m * n}</sup> = ${Math.pow(a, m * n)}`
                                        ];
                                    }
                                }
                            }
                        ]
                    },
                    formulas: {
                        title: "Формулы сокращенного умножения",
                        formulas: [
                            {
                                name: "Квадрат суммы",
                                formula: "(a + b)<sup>2</sup> = a<sup>2</sup> + 2ab + b<sup>2</sup>",
                                explanation: "Квадрат суммы двух выражений равен квадрату первого плюс удвоенное произведение первого на второе плюс квадрат второго.",
                                calculator: {
                                    inputs: [
                                        { label: "a", value: "" },
                                        { label: "b", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const b = parseFloat(inputs.b);
                                        if (isNaN(a) || isNaN(b)) return "Введите значения";
                                        return a*a + 2*a*b + b*b;
                                    },
                                    steps: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const b = parseFloat(inputs.b);
                                        if (isNaN(a) || isNaN(b)) return ["Введите значения"];
                                        return [
                                            `Шаг 1: Записываем выражение: (a + b)<sup>2</sup>`,
                                            `Шаг 2: Возводим в квадрат: a<sup>2</sup> + 2·a·b + b<sup>2</sup>`,
                                            `Шаг 3: Подставляем значения: ${a}<sup>2</sup> + 2·${a}·${b} + ${b}<sup>2</sup>`,
                                            `Шаг 4: Вычисляем: ${a*a} + ${2*a*b} + ${b*b}`,
                                            `Шаг 5: Получаем результат: ${a*a + 2*a*b + b*b}`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Квадрат разности",
                                formula: "(a - b)<sup>2</sup> = a<sup>2</sup> - 2ab + b<sup>2</sup>",
                                explanation: "Квадрат разности двух выражений равен квадрату первого минус удвоенное произведение первого на второе плюс квадрат второго.",
                                calculator: {
                                    inputs: [
                                        { label: "a", value: "" },
                                        { label: "b", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const b = parseFloat(inputs.b);
                                        if (isNaN(a) || isNaN(b)) return "Введите значения";
                                        return a*a - 2*a*b + b*b;
                                    },
                                    steps: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const b = parseFloat(inputs.b);
                                        if (isNaN(a) || isNaN(b)) return ["Введите значения"];
                                        return [
                                            `Шаг 1: Записываем выражение: (a - b)<sup>2</sup>`,
                                            `Шаг 2: Возводим в квадрат: a<sup>2</sup> - 2·a·b + b<sup>2</sup>`,
                                            `Шаг 3: Подставляем значения: ${a}<sup>2</sup> - 2·${a}·${b} + ${b}<sup>2</sup>`,
                                            `Шаг 4: Вычисляем: ${a*a} - ${2*a*b} + ${b*b}`,
                                            `Шаг 5: Получаем результат: ${a*a - 2*a*b + b*b}`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Разность квадратов",
                                formula: "a<sup>2</sup> - b<sup>2</sup> = (a - b)(a + b)",
                                explanation: "Разность квадратов двух выражений равна произведению разности и суммы этих выражений.",
                                calculator: {
                                    inputs: [
                                        { label: "a", value: "" },
                                        { label: "b", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const b = parseFloat(inputs.b);
                                        if (isNaN(a) || isNaN(b)) return "Введите значения";
                                        return (a - b) * (a + b);
                                    },
                                    steps: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const b = parseFloat(inputs.b);
                                        if (isNaN(a) || isNaN(b)) return ["Введите значения"];
                                        return [
                                            `Шаг 1: Записываем выражение: a<sup>2</sup> - b<sup>2</sup>`,
                                            `Шаг 2: Раскладываем на множители: (a - b)(a + b)`,
                                            `Шаг 3: Подставляем значения: (${a} - ${b})(${a} + ${b})`,
                                            `Шаг 4: Вычисляем: ${a - b} × ${a + b}`,
                                            `Шаг 5: Получаем результат: ${(a - b) * (a + b)}`
                                        ];
                                    }
                                }
                            }
                        ]
                    },
                    linear: {
                        title: "Линейные уравнения",
                        formulas: [
                            {
                                name: "Линейное уравнение",
                                formula: "ax + b = 0",
                                explanation: "Линейное уравнение первой степени с одной переменной.",
                                calculator: {
                                    inputs: [
                                        { label: "a", value: "" },
                                        { label: "b", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const b = parseFloat(inputs.b);
                                        if (isNaN(a) || isNaN(b)) return "Введите значения";
                                        if (a === 0) {
                                            if (b === 0) return "Бесконечно много решений";
                                            return "Нет решений";
                                        }
                                        return -b / a;
                                    },
                                    steps: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const b = parseFloat(inputs.b);
                                        if (isNaN(a) || isNaN(b)) return ["Введите значения"];
                                        if (a === 0) {
                                            if (b === 0) return ["Уравнение 0x + 0 = 0 верно для любого x", "Бесконечно много решений"];
                                            return ["Уравнение 0x + " + b + " = 0 не имеет решений", "Нет решений"];
                                        }
                                        return [
                                            `Шаг 1: Записываем уравнение: ${a}x + ${b} = 0`,
                                            `Шаг 2: Переносим ${b} в правую часть: ${a}x = -${b}`,
                                            `Шаг 3: Делим на ${a}: x = -${b}/${a}`,
                                            `Шаг 4: Получаем результат: x = ${-b / a}`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Система линейных уравнений (метод подстановки)",
                                formula: "x = (c - by)/a",
                                explanation: "Метод подстановки для решения системы линейных уравнений.",
                                calculator: {
                                    inputs: [
                                        { label: "a", value: "" },
                                        { label: "b", value: "" },
                                        { label: "c", value: "" },
                                        { label: "d", value: "" },
                                        { label: "e", value: "" },
                                        { label: "f", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const b = parseFloat(inputs.b);
                                        const c = parseFloat(inputs.c);
                                        const d = parseFloat(inputs.d);
                                        const e = parseFloat(inputs.e);
                                        const f = parseFloat(inputs.f);
                                        
                                        if (isNaN(a) || isNaN(b) || isNaN(c) || isNaN(d) || isNaN(e) || isNaN(f)) return "Введите все значения";
                                        
                                        if (a === 0) return "Ошибка: a не может быть 0 в методе подстановки";
                                        
                                        const y = (f - d * (c / a)) / (e - d * (b / a));
                                        const x = (c - b * y) / a;
                                        
                                        return `x = ${x}, y = ${y}`;
                                    },
                                    steps: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const b = parseFloat(inputs.b);
                                        const c = parseFloat(inputs.c);
                                        const d = parseFloat(inputs.d);
                                        const e = parseFloat(inputs.e);
                                        const f = parseFloat(inputs.f);
                                        
                                        if (isNaN(a) || isNaN(b) || isNaN(c) || isNaN(d) || isNaN(e) || isNaN(f)) return ["Введите все значения"];
                                        
                                        if (a === 0) return ["Ошибка: a не может быть 0 в методе подстановки"];
                                        
                                        const y = (f - d * (c / a)) / (e - d * (b / a));
                                        const x = (c - b * y) / a;
                                        
                                        return [
                                            `Шаг 1: Записываем систему уравнений:`,
                                            `  ${a}x + ${b}y = ${c}`,
                                            `  ${d}x + ${e}y = ${f}`,
                                            `Шаг 2: Выражаем x из первого уравнения: x = (${c} - ${b}y)/${a}`,
                                            `Шаг 3: Подставляем x во второе уравнение: ${d}·((${c} - ${b}y)/${a}) + ${e}y = ${f}`,
                                            `Шаг 4: Решаем уравнение относительно y: y = ${y}`,
                                            `Шаг 5: Подставляем y в выражение для x: x = (${c} - ${b}·${y})/${a} = ${x}`,
                                            `Шаг 6: Получаем решение: x = ${x}, y = ${y}`
                                        ];
                                    }
                                }
                            }
                        ]
                    }
                },
                8: {
                    quadratic: {
                        title: "Квадратные уравнения",
                        formulas: [
                            {
                                name: "Квадратное уравнение",
                                formula: "ax<sup>2</sup> + bx + c = 0",
                                explanation: "Квадратное уравнение второй степени с одной переменной.",
                                calculator: {
                                    inputs: [
                                        { label: "a", value: "" },
                                        { label: "b", value: "" },
                                        { label: "c", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const b = parseFloat(inputs.b);
                                        const c = parseFloat(inputs.c);
                                        
                                        if (isNaN(a) || isNaN(b) || isNaN(c)) return "Введите все значения";
                                        
                                        if (a === 0) return "Это не квадратное уравнение";
                                        
                                        const discriminant = b*b - 4*a*c;
                                        
                                        if (discriminant < 0) return "Нет действительных корней";
                                        
                                        if (discriminant === 0) {
                                            const x = -b / (2*a);
                                            return `x = ${x}`;
                                        }
                                        
                                        const x1 = (-b + Math.sqrt(discriminant)) / (2*a);
                                        const x2 = (-b - Math.sqrt(discriminant)) / (2*a);
                                        
                                        return `x₁ = ${x1}, x₂ = ${x2}`;
                                    },
                                    steps: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const b = parseFloat(inputs.b);
                                        const c = parseFloat(inputs.c);
                                        
                                        if (isNaN(a) || isNaN(b) || isNaN(c)) return ["Введите все значения"];
                                        
                                        if (a === 0) return ["Ошибка: a не может быть 0 в квадратном уравнении"];
                                        
                                        const discriminant = b*b - 4*a*c;
                                        
                                        let steps = [
                                            `Шаг 1: Записываем уравнение: ${a}x² + ${b}x + ${c} = 0`,
                                            `Шаг 2: Вычисляем дискриминант: D = b² - 4ac = ${b}² - 4·${a}·${c} = ${discriminant}`
                                        ];
                                        
                                        if (discriminant < 0) {
                                            steps.push("Шаг 3: D < 0, уравнение не имеет действительных корней");
                                        } else if (discriminant === 0) {
                                            const x = -b / (2*a);
                                            steps.push(
                                                `Шаг 3: D = 0, уравнение имеет один корень`,
                                                `Шаг 4: x = -b/(2a) = -${b}/(2·${a}) = ${x}`
                                            );
                                        } else {
                                            const x1 = (-b + Math.sqrt(discriminant)) / (2*a);
                                            const x2 = (-b - Math.sqrt(discriminant)) / (2*a);
                                            steps.push(
                                                `Шаг 3: D > 0, уравнение имеет два корня`,
                                                `Шаг 4: x₁ = (-b + √D)/(2a) = (-${b} + √${discriminant})/(2·${a}) = ${x1}`,
                                                `Шаг 5: x₂ = (-b - √D)/(2a) = (-${b} - √${discriminant})/(2·${a}) = ${x2}`
                                            );
                                        }
                                        
                                        return steps;
                                    }
                                }
                            },
                            {
                                name: "Теорема Виета",
                                formula: "x₁ + x₂ = -b/a, x₁ × x₂ = c/a",
                                explanation: "Сумма корней квадратного уравнения равна -b/a, а произведение корней равно c/a.",
                                calculator: {
                                    inputs: [
                                        { label: "a", value: "" },
                                        { label: "b", value: "" },
                                        { label: "c", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const b = parseFloat(inputs.b);
                                        const c = parseFloat(inputs.c);
                                        
                                        if (isNaN(a) || isNaN(b) || isNaN(c)) return "Введите все значения";
                                        
                                        if (a === 0) return "Это не квадратное уравнение";
                                        
                                        const sum = -b / a;
                                        const product = c / a;
                                        
                                        return `Сумма корней: ${sum}, Произведение корней: ${product}`;
                                    },
                                    steps: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const b = parseFloat(inputs.b);
                                        const c = parseFloat(inputs.c);
                                        
                                        if (isNaN(a) || isNaN(b) || isNaN(c)) return ["Введите все значения"];
                                        
                                        if (a === 0) return ["Ошибка: a не может быть 0 в квадратном уравнении"];
                                        
                                        const sum = -b / a;
                                        const product = c / a;
                                        
                                        return [
                                            `Шаг 1: Записываем уравнение: ${a}x² + ${b}x + ${c} = 0`,
                                            `Шаг 2: Сумма корней: x₁ + x₂ = -b/a = -${b}/${a} = ${sum}`,
                                            `Шаг 3: Произведение корней: x₁ × x₂ = c/a = ${c}/${a} = ${product}`,
                                            `Шаг 4: Получаем результат: Сумма корней = ${sum}, Произведение корней = ${product}`
                                        ];
                                    }
                                }
                            }
                        ]
                    },
                    inequalities: {
                        title: "Неравенства",
                        formulas: [
                            {
                                name: "Линейное неравенство",
                                formula: "ax + b > 0",
                                explanation: "Линейное неравенство решается аналогично уравнению, но при умножении или делении на отрицательное число знак неравенства меняется.",
                                calculator: {
                                    inputs: [
                                        { label: "a", value: "" },
                                        { label: "b", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const b = parseFloat(inputs.b);
                                        
                                        if (isNaN(a) || isNaN(b)) return "Введите значения";
                                        
                                        if (a === 0) return b > 0 ? "x ∈ R" : "Нет решений";
                                        if (a > 0) {
                                            return `x > ${-b/a}`;
                                        } else {
                                            return `x < ${-b/a}`;
                                        }
                                    },
                                    steps: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const b = parseFloat(inputs.b);
                                        
                                        if (isNaN(a) || isNaN(b)) return ["Введите значения"];
                                        
                                        if (a === 0) {
                                            if (b > 0) return ["Условие всегда верно", "Решение: x ∈ R"];
                                            return ["Условие всегда неверно", "Нет решений"];
                                        }
                                        return [
                                            `Шаг 1: Записываем неравенство: ${a}x + ${b} > 0`,
                                            `Шаг 2: Переносим ${b}: ${a}x > ${-b}`,
                                            `Шаг 3: Делим на ${a}: x ${a > 0 ? '>' : '<'} ${-b/a}`,
                                            `Шаг 4: Получаем решение: x ${a > 0 ? '>' : '<'} ${-b/a}`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Квадратное неравенство",
                                formula: "ax<sup>2</sup> + bx + c > 0",
                                explanation: "Квадратное неравенство решается через нахождение корней соответствующего уравнения и анализ знаков на интервалах.",
                                calculator: {
                                    inputs: [
                                        { label: "a", value: "" },
                                        { label: "b", value: "" },
                                        { label: "c", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const b = parseFloat(inputs.b);
                                        const c = parseFloat(inputs.c);
                                        
                                        if (isNaN(a) || isNaN(b) || isNaN(c)) return "Введите все значения";
                                        
                                        if (a === 0) return "Это не квадратное неравенство";
                                        
                                        const discriminant = b*b - 4*a*c;
                                        
                                        if (discriminant < 0) {
                                            return a > 0 ? "x ∈ R" : "Нет решений";
                                        }
                                        
                                        if (discriminant === 0) {
                                            const x = -b / (2*a);
                                            return a > 0 ? `x ∈ (-∞; ${x}) ∪ (${x}; +∞)` : "Нет решений";
                                        }
                                        
                                        const x1 = (-b + Math.sqrt(discriminant)) / (2*a);
                                        const x2 = (-b - Math.sqrt(discriminant)) / (2*a);
                                        
                                        // Упорядочиваем корни
                                        const [minX, maxX] = x1 < x2 ? [x1, x2] : [x2, x1];
                                        
                                        if (a > 0) {
                                            return `x ∈ (-∞; ${minX}) ∪ (${maxX}; +∞)`;
                                        } else {
                                            return `x ∈ (${minX}; ${maxX})`;
                                        }
                                    },
                                    steps: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const b = parseFloat(inputs.b);
                                        const c = parseFloat(inputs.c);
                                        
                                        if (isNaN(a) || isNaN(b) || isNaN(c)) return ["Введите все значения"];
                                        
                                        if (a === 0) return ["Ошибка: a не может быть 0 в квадратном неравенстве"];
                                        
                                        const discriminant = b*b - 4*a*c;
                                        
                                        let steps = [
                                            `Шаг 1: Записываем неравенство: ${a}x² + ${b}x + ${c} > 0`,
                                            `Шаг 2: Решаем соответствующее уравнение: ${a}x² + ${b}x + ${c} = 0`,
                                            `Шаг 3: Вычисляем дискриминант: D = b² - 4ac = ${b}² - 4·${a}·${c} = ${discriminant}`
                                        ];
                                        
                                        if (discriminant < 0) {
                                            steps.push(
                                                `Шаг 4: D < 0, уравнение не имеет действительных корней`,
                                                `Шаг 5: Так как a ${a > 0 ? '>' : '<'} 0, неравенство ${a > 0 ? 'всегда верно' : 'не имеет решений'}`,
                                                `Шаг 6: Решение: ${a > 0 ? 'x ∈ R' : 'Нет решений'}`
                                            );
                                        } else if (discriminant === 0) {
                                            const x = -b / (2*a);
                                            steps.push(
                                                `Шаг 4: D = 0, уравнение имеет один корень: x = ${x}`,
                                                `Шаг 5: Так как a ${a > 0 ? '>' : '<'} 0, неравенство ${a > 0 ? 'верно для всех x, кроме x = ' + x : 'не имеет решений'}`,
                                                `Шаг 6: Решение: ${a > 0 ? 'x ∈ (-∞; ' + x + ') ∪ (' + x + '; +∞)' : 'Нет решений'}`
                                            );
                                        } else {
                                            const x1 = (-b + Math.sqrt(discriminant)) / (2*a);
                                            const x2 = (-b - Math.sqrt(discriminant)) / (2*a);
                                            
                                            // Упорядочиваем корни
                                            const [minX, maxX] = x1 < x2 ? [x1, x2] : [x2, x1];
                                            
                                            steps.push(
                                                `Шаг 4: D > 0, уравнение имеет два корня: x₁ = ${minX}, x₂ = ${maxX}`,
                                                `Шаг 5: Отмечаем корни на числовой прямой и определяем знаки`,
                                                `Шаг 6: Так как a ${a > 0 ? '>' : '<'} 0, неравенство ${a > 0 ? 'верно вне интервала' : 'верно внутри интервала'}`,
                                                `Шаг 7: Решение: x ∈ ${a > 0 ? '(-∞; ' + minX + ') ∪ (' + maxX + '; +∞)' : '(' + minX + '; ' + maxX + ')'}`
                                            );
                                        }
                                        
                                        return steps;
                                    }
                                }
                            }
                        ]
                    },
                    functions: {
                        title: "Функции",
                        formulas: [
                            {
                                name: "Линейная функция",
                                formula: "y = kx + b",
                                explanation: "Линейная функция - это функция первой степени, графиком которой является прямая.",
                                calculator: {
                                    inputs: [
                                        { label: "k", value: "" },
                                        { label: "b", value: "" },
                                        { label: "x", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const k = parseFloat(inputs.k);
                                        const b = parseFloat(inputs.b);
                                        const x = parseFloat(inputs.x);
                                        
                                        if (isNaN(k) || isNaN(b) || isNaN(x)) return "Введите значения";
                                        
                                        return k * x + b;
                                    },
                                    steps: function(inputs) {
                                        const k = parseFloat(inputs.k);
                                        const b = parseFloat(inputs.b);
                                        const x = parseFloat(inputs.x);
                                        
                                        if (isNaN(k) || isNaN(b) || isNaN(x)) return ["Введите значения"];
                                        
                                        return [
                                            `Шаг 1: Записываем функцию: y = ${k}x + ${b}`,
                                            `Шаг 2: Подставляем x = ${x}: y = ${k}×${x} + ${b}`,
                                            `Шаг 3: Вычисляем: y = ${k*x} + ${b}`,
                                            `Шаг 4: Получаем результат: y = ${k*x + b}`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Квадратичная функция",
                                formula: "y = ax<sup>2</sup> + bx + c",
                                explanation: "Квадратичная функция - это функция второй степени, графиком которой является парабола.",
                                calculator: {
                                    inputs: [
                                        { label: "a", value: "" },
                                        { label: "b", value: "" },
                                        { label: "c", value: "" },
                                        { label: "x", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const b = parseFloat(inputs.b);
                                        const c = parseFloat(inputs.c);
                                        const x = parseFloat(inputs.x);
                                        
                                        if (isNaN(a) || isNaN(b) || isNaN(c) || isNaN(x)) return "Введите все значения";
                                        
                                        return a * x * x + b * x + c;
                                    },
                                    steps: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const b = parseFloat(inputs.b);
                                        const c = parseFloat(inputs.c);
                                        const x = parseFloat(inputs.x);
                                        
                                        if (isNaN(a) || isNaN(b) || isNaN(c) || isNaN(x)) return ["Введите все значения"];
                                        
                                        return [
                                            `Шаг 1: Записываем функцию: y = ${a}x² + ${b}x + ${c}`,
                                            `Шаг 2: Подставляем x = ${x}: y = ${a}×${x}² + ${b}×${x} + ${c}`,
                                            `Шаг 3: Вычисляем квадрат: ${x}² = ${x*x}`,
                                            `Шаг 4: Вычисляем: ${a}×${x*x} = ${a*x*x}`,
                                            `Шаг 5: Вычисляем: ${b}×${x} = ${b*x}`,
                                            `Шаг 6: Складываем: ${a*x*x} + ${b*x} + ${c} = ${a*x*x + b*x + c}`,
                                            `Шаг 7: Получаем результат: y = ${a*x*x + b*x + c}`
                                        ];
                                    }
                                }
                            }
                        ]
                    }
                },
                9: {
                    progressions: {
                        title: "Прогрессии",
                        formulas: [
                            {
                                name: "Арифметическая прогрессия",
                                formula: "a<sub>n</sub> = a<sub>1</sub> + (n-1)d",
                                explanation: "Формула n-го члена арифметической прогрессии, где d - разность прогрессии.",
                                calculator: {
                                    inputs: [
                                        { label: "a₁ (первый член)", value: "" },
                                        { label: "d (разность)", value: "" },
                                        { label: "n (номер члена)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const a1 = parseFloat(inputs['a₁ (первый член)']);
                                        const d = parseFloat(inputs['d (разность)']);
                                        const n = parseInt(inputs['n (номер члена)']);
                                        
                                        if (isNaN(a1) || isNaN(d) || isNaN(n)) return "Введите значения";
                                        
                                        return a1 + (n - 1) * d;
                                    },
                                    steps: function(inputs) {
                                        const a1 = parseFloat(inputs['a₁ (первый член)']);
                                        const d = parseFloat(inputs['d (разность)']);
                                        const n = parseInt(inputs['n (номер члена)']);
                                        
                                        if (isNaN(a1) || isNaN(d) || isNaN(n)) return ["Введите значения"];
                                        
                                        return [
                                            `Шаг 1: Записываем формулу: a<sub>n</sub> = a<sub>1</sub> + (n-1)d`,
                                            `Шаг 2: Подставляем значения: a<sub>n</sub> = ${a1} + (${n}-1)×${d}`,
                                            `Шаг 3: Вычисляем: a<sub>n</sub> = ${a1} + ${n-1}×${d}`,
                                            `Шаг 4: Получаем результат: a<sub>n</sub> = ${a1 + (n-1)*d}`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Сумма арифметической прогрессии",
                                formula: "S<sub>n</sub> = (a<sub>1</sub> + a<sub>n</sub>)n/2",
                                explanation: "Формула суммы первых n членов арифметической прогрессии.",
                                calculator: {
                                    inputs: [
                                        { label: "a₁ (первый член)", value: "" },
                                        { label: "a<sub>n</sub> (последний член)", value: "" },
                                        { label: "n (количество членов)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const a1 = parseFloat(inputs['a₁ (первый член)']);
                                        const an = parseFloat(inputs['a<sub>n</sub> (последний член)']);
                                        const n = parseInt(inputs['n (количество членов)']);
                                        
                                        if (isNaN(a1) || isNaN(an) || isNaN(n)) return "Введите значения";
                                        
                                        return ((a1 + an) * n) / 2;
                                    },
                                    steps: function(inputs) {
                                        const a1 = parseFloat(inputs['a₁ (первый член)']);
                                        const an = parseFloat(inputs['a<sub>n</sub> (последний член)']);
                                        const n = parseInt(inputs['n (количество членов)']);
                                        
                                        if (isNaN(a1) || isNaN(an) || isNaN(n)) return ["Введите значения"];
                                        
                                        return [
                                            `Шаг 1: Записываем формулу: S<sub>n</sub> = (a<sub>1</sub> + a<sub>n</sub>)n/2`,
                                            `Шаг 2: Подставляем значения: S<sub>n</sub> = (${a1} + ${an})×${n}/2`,
                                            `Шаг 3: Вычисляем: S<sub>n</sub> = ${a1+an}×${n}/2`,
                                            `Шаг 4: Получаем результат: S<sub>n</sub> = ${(a1+an)*n/2}`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Геометрическая прогрессия",
                                formula: "b<sub>n</sub> = b<sub>1</sub> × q<sup>n-1</sup>",
                                explanation: "Формула n-го члена геометрической прогрессии, где q - знаменатель прогрессии.",
                                calculator: {
                                    inputs: [
                                        { label: "b₁ (первый член)", value: "" },
                                        { label: "q (знаменатель)", value: "" },
                                        { label: "n (номер члена)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const b1 = parseFloat(inputs['b₁ (первый член)']);
                                        const q = parseFloat(inputs['q (знаменатель)']);
                                        const n = parseInt(inputs['n (номер члена)']);
                                        
                                        if (isNaN(b1) || isNaN(q) || isNaN(n)) return "Введите значения";
                                        
                                        return b1 * Math.pow(q, n - 1);
                                    },
                                    steps: function(inputs) {
                                        const b1 = parseFloat(inputs['b₁ (первый член)']);
                                        const q = parseFloat(inputs['q (знаменатель)']);
                                        const n = parseInt(inputs['n (номер члена)']);
                                        
                                        if (isNaN(b1) || isNaN(q) || isNaN(n)) return ["Введите значения"];
                                        
                                        return [
                                            `Шаг 1: Записываем формулу: b<sub>n</sub> = b<sub>1</sub> × q<sup>n-1</sup>`,
                                            `Шаг 2: Подставляем значения: b<sub>n</sub> = ${b1} × ${q}<sup>${n}-1</sup>`,
                                            `Шаг 3: Вычисляем показатель степени: ${n}-1 = ${n-1}`,
                                            `Шаг 4: Вычисляем: ${q}<sup>${n-1}</sup> = ${Math.pow(q, n-1)}`,
                                            `Шаг 5: Умножаем: ${b1} × ${Math.pow(q, n-1)} = ${b1 * Math.pow(q, n-1)}`,
                                            `Шаг 6: Получаем результат: b<sub>n</sub> = ${b1 * Math.pow(q, n-1)}`
                                        ];
                                    }
                                }
                            }
                        ]
                    },
                    probability: {
                        title: "Теория вероятностей",
                        formulas: [
                            {
                                name: "Классическое определение вероятности",
                                formula: "P(A) = m/n",
                                explanation: "Вероятность события A равна отношению числа благоприятных исходов к общему числу возможных исходов.",
                                calculator: {
                                    inputs: [
                                        { label: "m (благоприятные исходы)", value: "" },
                                        { label: "n (всего исходов)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const m = parseFloat(inputs['m (благоприятные исходы)']);
                                        const n = parseFloat(inputs['n (всего исходов)']);
                                        
                                        if (isNaN(m) || isNaN(n)) return "Введите значения";
                                        
                                        if (n === 0) return "Ошибка: деление на ноль";
                                        return m / n;
                                    },
                                    steps: function(inputs) {
                                        const m = parseFloat(inputs['m (благоприятные исходы)']);
                                        const n = parseFloat(inputs['n (всего исходов)']);
                                        
                                        if (isNaN(m) || isNaN(n)) return ["Введите значения"];
                                        
                                        if (n === 0) return ["Ошибка: деление на ноль"];
                                        return [
                                            `Шаг 1: Записываем формулу: P(A) = m/n`,
                                            `Шаг 2: Подставляем значения: P(A) = ${m}/${n}`,
                                            `Шаг 3: Вычисляем: P(A) = ${m/n}`,
                                            `Шаг 4: Получаем результат: P(A) = ${m/n}`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Вероятность суммы несовместных событий",
                                formula: "P(A + B) = P(A) + P(B)",
                                explanation: "Вероятность наступления хотя бы одного из несовместных событий равна сумме их вероятностей.",
                                calculator: {
                                    inputs: [
                                        { label: "P(A)", value: "" },
                                        { label: "P(B)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const pA = parseFloat(inputs['P(A)']);
                                        const pB = parseFloat(inputs['P(B)']);
                                        
                                        if (isNaN(pA) || isNaN(pB)) return "Введите значения";
                                        
                                        return pA + pB;
                                    },
                                    steps: function(inputs) {
                                        const pA = parseFloat(inputs['P(A)']);
                                        const pB = parseFloat(inputs['P(B)']);
                                        
                                        if (isNaN(pA) || isNaN(pB)) return ["Введите значения"];
                                        
                                        return [
                                            `Шаг 1: Записываем формулу: P(A + B) = P(A) + P(B)`,
                                            `Шаг 2: Подставляем значения: P(A + B) = ${pA} + ${pB}`,
                                            `Шаг 3: Вычисляем: P(A + B) = ${pA + pB}`,
                                            `Шаг 4: Получаем результат: P(A + B) = ${pA + pB}`
                                        ];
                                    }
                                }
                            }
                        ]
                    },
                    statistics: {
                        title: "Статистика",
                        formulas: [
                            {
                                name: "Среднее арифметическое",
                                formula: "x̄ = (x<sub>1</sub> + x<sub>2</sub> + ... + x<sub>n</sub>)/n",
                                explanation: "Среднее арифметическое ряда чисел - это сумма всех чисел, деленная на их количество.",
                                calculator: {
                                    inputs: [
                                        { label: "числа (через запятую)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const numbers = inputs['числа (через запятую)']
                                            .split(',')
                                            .map(num => parseFloat(num.trim()))
                                            .filter(num => !isNaN(num));
                                            
                                        if (numbers.length === 0) return "Введите хотя бы одно число";
                                        
                                        const sum = numbers.reduce((acc, num) => acc + num, 0);
                                        return sum / numbers.length;
                                    },
                                    steps: function(inputs) {
                                        const numbers = inputs['числа (через запятую)']
                                            .split(',')
                                            .map(num => parseFloat(num.trim()))
                                            .filter(num => !isNaN(num));
                                            
                                        if (numbers.length === 0) return ["Введите хотя бы одно число"];
                                        
                                        const sum = numbers.reduce((acc, num) => acc + num, 0);
                                        return [
                                            `Шаг 1: Записываем числа: ${numbers.join(', ')}`,
                                            `Шаг 2: Считаем сумму: ${sum}`,
                                            `Шаг 3: Делим на количество чисел: ${sum}/${numbers.length}`,
                                            `Шаг 4: Получаем результат: ${sum/numbers.length}`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Медиана",
                                formula: "Медиана = среднее значение центральных элементов",
                                explanation: "Медиана - это значение, которое делит упорядоченный ряд чисел пополам.",
                                calculator: {
                                    inputs: [
                                        { label: "числа (через запятую)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const numbers = inputs['числа (через запятую)']
                                            .split(',')
                                            .map(num => parseFloat(num.trim()))
                                            .filter(num => !isNaN(num))
                                            .sort((a, b) => a - b);
                                            
                                        if (numbers.length === 0) return "Введите хотя бы одно число";
                                        
                                        const mid = Math.floor(numbers.length / 2);
                                        if (numbers.length % 2 === 0) {
                                            return (numbers[mid - 1] + numbers[mid]) / 2;
                                        } else {
                                            return numbers[mid];
                                        }
                                    },
                                    steps: function(inputs) {
                                        const numbers = inputs['числа (через запятую)']
                                            .split(',')
                                            .map(num => parseFloat(num.trim()))
                                            .filter(num => !isNaN(num))
                                            .sort((a, b) => a - b);
                                            
                                        if (numbers.length === 0) return ["Введите хотя бы одно число"];
                                        
                                        const mid = Math.floor(numbers.length / 2);
                                        let median;
                                        if (numbers.length % 2 === 0) {
                                            median = (numbers[mid - 1] + numbers[mid]) / 2;
                                        } else {
                                            median = numbers[mid];
                                        }
                                        
                                        return [
                                            `Шаг 1: Записываем числа: ${inputs['числа (через запятую)']}`,
                                            `Шаг 2: Сортируем числа: ${numbers.join(', ')}`,
                                            `Шаг 3: Находим середину ряда: позиция ${mid + 1}`,
                                            `Шаг 4: ${numbers.length % 2 === 0 ? 
                                                `Медиана = среднее значение между ${numbers[mid - 1]} и ${numbers[mid]}` : 
                                                `Медиана = ${numbers[mid]}`}`,
                                            `Шаг 5: Получаем результат: ${median}`
                                        ];
                                    }
                                }
                            }
                        ]
                    }
                },
                10: {
                    trigonometry: {
                        title: "Тригонометрия",
                        formulas: [
                            {
                                name: "Основное тригонометрическое тождество",
                                formula: "sin²α + cos²α = 1",
                                explanation: "Основное тригонометрическое тождество связывает синус и косинус одного угла.",
                                calculator: {
                                    inputs: [
                                        { label: "sin α", value: "" },
                                        { label: "cos α", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const sin = parseFloat(inputs['sin α']);
                                        const cos = parseFloat(inputs['cos α']);
                                        
                                        if (!isNaN(sin) && sin !== null) {
                                            return Math.sqrt(1 - sin*sin);
                                        }
                                        if (!isNaN(cos) && cos !== null) {
                                            return Math.sqrt(1 - cos*cos);
                                        }
                                        return "Введите значение sin или cos";
                                    },
                                    steps: function(inputs) {
                                        const sin = parseFloat(inputs['sin α']);
                                        const cos = parseFloat(inputs['cos α']);
                                        
                                        if (!isNaN(sin) && sin !== null) {
                                            return [
                                                `Шаг 1: Записываем тождество: sin²α + cos²α = 1`,
                                                `Шаг 2: Подставляем sin α = ${sin}: ${sin}² + cos²α = 1`,
                                                `Шаг 3: Вычисляем: ${sin*sin} + cos²α = 1`,
                                                `Шаг 4: Находим cos α: cos α = √(1 - ${sin*sin})`,
                                                `Шаг 5: Получаем результат: cos α = ${Math.sqrt(1 - sin*sin)}`
                                            ];
                                        }
                                        if (!isNaN(cos) && cos !== null) {
                                            return [
                                                `Шаг 1: Записываем тождество: sin²α + cos²α = 1`,
                                                `Шаг 2: Подставляем cos α = ${cos}: sin²α + ${cos}² = 1`,
                                                `Шаг 3: Вычисляем: sin²α + ${cos*cos} = 1`,
                                                `Шаг 4: Находим sin α: sin α = √(1 - ${cos*cos})`,
                                                `Шаг 5: Получаем результат: sin α = ${Math.sqrt(1 - cos*cos)}`
                                            ];
                                        }
                                        return ["Введите значение sin или cos"];
                                    }
                                }
                            },
                            {
                                name: "Тангенс угла",
                                formula: "tan α = sin α / cos α",
                                explanation: "Тангенс угла равен отношению синуса к косинусу этого угла.",
                                calculator: {
                                    inputs: [
                                        { label: "sin α", value: "" },
                                        { label: "cos α", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const sin = parseFloat(inputs['sin α']);
                                        const cos = parseFloat(inputs['cos α']);
                                        
                                        if (isNaN(sin) || isNaN(cos)) return "Введите значения";
                                        
                                        if (cos === 0) return "Ошибка: cos α не может быть 0";
                                        return sin / cos;
                                    },
                                    steps: function(inputs) {
                                        const sin = parseFloat(inputs['sin α']);
                                        const cos = parseFloat(inputs['cos α']);
                                        
                                        if (isNaN(sin) || isNaN(cos)) return ["Введите значения"];
                                        
                                        if (cos === 0) return ["Ошибка: cos α не может быть 0"];
                                        return [
                                            `Шаг 1: Записываем формулу: tan α = sin α / cos α`,
                                            `Шаг 2: Подставляем значения: tan α = ${sin} / ${cos}`,
                                            `Шаг 3: Вычисляем: tan α = ${sin / cos}`,
                                            `Шаг 4: Получаем результат: tan α = ${sin / cos}`
                                        ];
                                    }
                                }
                            }
                        ]
                    },
                    logarithms: {
                        title: "Логарифмы",
                        formulas: [
                            {
                                name: "Основное логарифмическое тождество",
                                formula: "a<sup>log<sub>a</sub>b</sup> = b",
                                explanation: "Основное логарифмическое тождество связывает логарифм и степень.",
                                calculator: {
                                    inputs: [
                                        { label: "a (основание)", value: "" },
                                        { label: "b", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const a = parseFloat(inputs['a (основание)']);
                                        const b = parseFloat(inputs['b']);
                                        
                                        if (isNaN(a) || isNaN(b)) return "Введите значения";
                                        
                                        if (a <= 0 || a === 1) return "Основание должно быть > 0 и ≠ 1";
                                        if (b <= 0) return "Подлогарифмическое выражение должно быть > 0";
                                        return Math.pow(a, Math.log(b) / Math.log(a));
                                    },
                                    steps: function(inputs) {
                                        const a = parseFloat(inputs['a (основание)']);
                                        const b = parseFloat(inputs['b']);
                                        
                                        if (isNaN(a) || isNaN(b)) return ["Введите значения"];
                                        
                                        if (a <= 0 || a === 1) return ["Основание должно быть > 0 и ≠ 1"];
                                        if (b <= 0) return ["Подлогарифмическое выражение должно быть > 0"];
                                        return [
                                            `Шаг 1: Записываем тождество: a^(log_a(b)) = b`,
                                            `Шаг 2: Подставляем значения: ${a}^(log_${a}(${b})) = ${b}`,
                                            `Шаг 3: Вычисляем log_${a}(${b}): ${Math.log(b) / Math.log(a)}`,
                                            `Шаг 4: Возводим ${a} в степень ${Math.log(b) / Math.log(a)}: ${Math.pow(a, Math.log(b) / Math.log(a))}`,
                                            `Шаг 5: Получаем результат: ${Math.pow(a, Math.log(b) / Math.log(a))}`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Свойство логарифма произведения",
                                formula: "log<sub>a</sub>(b × c) = log<sub>a</sub>b + log<sub>a</sub>c",
                                explanation: "Логарифм произведения равен сумме логарифмов множителей.",
                                calculator: {
                                    inputs: [
                                        { label: "a (основание)", value: "" },
                                        { label: "b", value: "" },
                                        { label: "c", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const a = parseFloat(inputs['a (основание)']);
                                        const b = parseFloat(inputs['b']);
                                        const c = parseFloat(inputs['c']);
                                        
                                        if (isNaN(a) || isNaN(b) || isNaN(c)) return "Введите все значения";
                                        
                                        if (a <= 0 || a === 1) return "Основание должно быть > 0 и ≠ 1";
                                        if (b <= 0 || c <= 0) return "Подлогарифмические выражения должны быть > 0";
                                        return Math.log(b * c) / Math.log(a);
                                    },
                                    steps: function(inputs) {
                                        const a = parseFloat(inputs['a (основание)']);
                                        const b = parseFloat(inputs['b']);
                                        const c = parseFloat(inputs['c']);
                                        
                                        if (isNaN(a) || isNaN(b) || isNaN(c)) return ["Введите все значения"];
                                        
                                        if (a <= 0 || a === 1) return ["Основание должно быть > 0 и ≠ 1"];
                                        if (b <= 0 || c <= 0) return ["Подлогарифмические выражения должны быть > 0"];
                                        return [
                                            `Шаг 1: Записываем формулу: log_a(b × c) = log_a(b) + log_a(c)`,
                                            `Шаг 2: Подставляем значения: log_${a}(${b} × ${c}) = log_${a}(${b}) + log_${a}(${c})`,
                                            `Шаг 3: Вычисляем левую часть: log_${a}(${b * c}) = ${Math.log(b * c) / Math.log(a)}`,
                                            `Шаг 4: Вычисляем правую часть: log_${a}(${b}) + log_${a}(${c}) = ${Math.log(b) / Math.log(a)} + ${Math.log(c) / Math.log(a)}`,
                                            `Шаг 5: Получаем результат: ${Math.log(b * c) / Math.log(a)}`
                                        ];
                                    }
                                }
                            }
                        ]
                    },
                    complex: {
                        title: "Комплексные числа",
                        formulas: [
                            {
                                name: "Сложение комплексных чисел",
                                formula: "(a + bi) + (c + di) = (a+c) + (b+d)i",
                                explanation: "При сложении комплексных чисел складываются их действительные и мнимые части по отдельности.",
                                calculator: {
                                    inputs: [
                                        { label: "a (действительная часть первого числа)", value: "" },
                                        { label: "b (мнимая часть первого числа)", value: "" },
                                        { label: "c (действительная часть второго числа)", value: "" },
                                        { label: "d (мнимая часть второго числа)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const a = parseFloat(inputs['a (действительная часть первого числа)']);
                                        const b = parseFloat(inputs['b (мнимая часть первого числа)']);
                                        const c = parseFloat(inputs['c (действительная часть второго числа)']);
                                        const d = parseFloat(inputs['d (мнимая часть второго числа)']);
                                        
                                        if (isNaN(a) || isNaN(b) || isNaN(c) || isNaN(d)) return "Введите все значения";
                                        
                                        const real = a + c;
                                        const imag = b + d;
                                        return `${real} ${imag >= 0 ? '+' : ''}${imag}i`;
                                    },
                                    steps: function(inputs) {
                                        const a = parseFloat(inputs['a (действительная часть первого числа)']);
                                        const b = parseFloat(inputs['b (мнимая часть первого числа)']);
                                        const c = parseFloat(inputs['c (действительная часть второго числа)']);
                                        const d = parseFloat(inputs['d (мнимая часть второго числа)']);
                                        
                                        if (isNaN(a) || isNaN(b) || isNaN(c) || isNaN(d)) return ["Введите все значения"];
                                        
                                        const real = a + c;
                                        const imag = b + d;
                                        return [
                                            `Шаг 1: Записываем числа: (${a} + ${b}i) и (${c} + ${d}i)`,
                                            `Шаг 2: Складываем действительные части: ${a} + ${c} = ${real}`,
                                            `Шаг 3: Складываем мнимые части: ${b} + ${d} = ${imag}`,
                                            `Шаг 4: Записываем результат: ${real} ${imag >= 0 ? '+' : ''}${imag}i`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Умножение комплексных чисел",
                                formula: "(a + bi) × (c + di) = (ac - bd) + (ad + bc)i",
                                explanation: "При умножении комплексных чисел используется правило умножения двучленов и учитывается, что i² = -1.",
                                calculator: {
                                    inputs: [
                                        { label: "a (действительная часть первого числа)", value: "" },
                                        { label: "b (мнимая часть первого числа)", value: "" },
                                        { label: "c (действительная часть второго числа)", value: "" },
                                        { label: "d (мнимая часть второго числа)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const a = parseFloat(inputs['a (действительная часть первого числа)']);
                                        const b = parseFloat(inputs['b (мнимая часть первого числа)']);
                                        const c = parseFloat(inputs['c (действительная часть второго числа)']);
                                        const d = parseFloat(inputs['d (мнимая часть второго числа)']);
                                        
                                        if (isNaN(a) || isNaN(b) || isNaN(c) || isNaN(d)) return "Введите все значения";
                                        
                                        const real = a*c - b*d;
                                        const imag = a*d + b*c;
                                        return `${real} ${imag >= 0 ? '+' : ''}${imag}i`;
                                    },
                                    steps: function(inputs) {
                                        const a = parseFloat(inputs['a (действительная часть первого числа)']);
                                        const b = parseFloat(inputs['b (мнимая часть первого числа)']);
                                        const c = parseFloat(inputs['c (действительная часть второго числа)']);
                                        const d = parseFloat(inputs['d (мнимая часть второго числа)']);
                                        
                                        if (isNaN(a) || isNaN(b) || isNaN(c) || isNaN(d)) return ["Введите все значения"];
                                        
                                        const real = a*c - b*d;
                                        const imag = a*d + b*c;
                                        return [
                                            `Шаг 1: Записываем числа: (${a} + ${b}i) и (${c} + ${d}i)`,
                                            `Шаг 2: Умножаем как двучлены: (${a} + ${b}i)(${c} + ${d}i) = ${a}*${c} + ${a}*${d}i + ${b}i*${c} + ${b}i*${d}i`,
                                            `Шаг 3: Упрощаем: ${a*c} + ${a*d}i + ${b*c}i + ${b*d}i²`,
                                            `Шаг 4: Учитываем, что i² = -1: ${a*c} + (${a*d} + ${b*c})i - ${b*d}`,
                                            `Шаг 5: Складываем действительные части: ${a*c} - ${b*d} = ${real}`,
                                            `Шаг 6: Складываем мнимые части: ${a*d} + ${b*c} = ${imag}`,
                                            `Шаг 7: Записываем результат: ${real} ${imag >= 0 ? '+' : ''}${imag}i`
                                        ];
                                    }
                                }
                            }
                        ]
                    }
                },
                11: {
                    derivatives: {
                        title: "Производные",
                        formulas: [
                            {
                                name: "Производная степенной функции",
                                formula: "(x<sup>n</sup>)' = n × x<sup>n-1</sup>",
                                explanation: "Производная степенной функции находится по правилу уменьшения показателя степени на 1 и умножения на исходный показатель.",
                                calculator: {
                                    inputs: [
                                        { label: "x", value: "" },
                                        { label: "n", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const x = parseFloat(inputs.x);
                                        const n = parseFloat(inputs.n);
                                        
                                        if (isNaN(x) || isNaN(n)) return "Введите значения";
                                        
                                        return n * Math.pow(x, n - 1);
                                    },
                                    steps: function(inputs) {
                                        const x = parseFloat(inputs.x);
                                        const n = parseFloat(inputs.n);
                                        
                                        if (isNaN(x) || isNaN(n)) return ["Введите значения"];
                                        
                                        return [
                                            `Шаг 1: Записываем функцию: x^${n}`,
                                            `Шаг 2: Применяем правило: (x^n)' = n × x^(n-1)`,
                                            `Шаг 3: Подставляем значения: ${n} × x^(${n}-1)`,
                                            `Шаг 4: Вычисляем: ${n} × ${Math.pow(x, n-1)}`,
                                            `Шаг 5: Получаем результат: ${n * Math.pow(x, n - 1)}`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Производная синуса",
                                formula: "(sin x)' = cos x",
                                explanation: "Производная синуса равна косинусу.",
                                calculator: {
                                    inputs: [
                                        { label: "x (в радианах)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const x = parseFloat(inputs['x (в радианах)']);
                                        
                                        if (isNaN(x)) return "Введите значение";
                                        
                                        return Math.cos(x);
                                    },
                                    steps: function(inputs) {
                                        const x = parseFloat(inputs['x (в радианах)']);
                                        
                                        if (isNaN(x)) return ["Введите значение"];
                                        
                                        return [
                                            `Шаг 1: Записываем функцию: sin(${x})`,
                                            `Шаг 2: Применяем правило: (sin x)' = cos x`,
                                            `Шаг 3: Подставляем значение: cos(${x})`,
                                            `Шаг 4: Вычисляем: ${Math.cos(x)}`,
                                            `Шаг 5: Получаем результат: ${Math.cos(x)}`
                                        ];
                                    }
                                }
                            }
                        ]
                    },
                    integrals: {
                        title: "Интегралы",
                        formulas: [
                            {
                                name: "Интеграл степенной функции",
                                formula: "∫x<sup>n</sup> dx = x<sup>n+1</sup>/(n+1) + C",
                                explanation: "Неопределенный интеграл степенной функции находится по правилу увеличения показателя степени на 1 и деления на новый показатель.",
                                calculator: {
                                    inputs: [
                                        { label: "x", value: "" },
                                        { label: "n", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const x = parseFloat(inputs.x);
                                        const n = parseFloat(inputs.n);
                                        
                                        if (isNaN(x) || isNaN(n)) return "Введите значения";
                                        
                                        if (n === -1) return "ln|x| + C";
                                        return Math.pow(x, n + 1) / (n + 1);
                                    },
                                    steps: function(inputs) {
                                        const x = parseFloat(inputs.x);
                                        const n = parseFloat(inputs.n);
                                        
                                        if (isNaN(x) || isNaN(n)) return ["Введите значения"];
                                        
                                        if (n === -1) return ["Интеграл: ln|x| + C"];
                                        
                                        return [
                                            `Шаг 1: Записываем функцию: x^${n}`,
                                            `Шаг 2: Применяем правило: ∫x^n dx = x^(n+1)/(n+1) + C`,
                                            `Шаг 3: Вычисляем степень: ${n} + 1 = ${n+1}`,
                                            `Шаг 4: Вычисляем: x^${n+1} / ${n+1}`,
                                            `Шаг 5: Подставляем x = ${x}: ${Math.pow(x, n+1)} / ${n+1}`,
                                            `Шаг 6: Получаем результат: ${Math.pow(x, n + 1) / (n + 1)}`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Интеграл синуса",
                                formula: "∫sin x dx = -cos x + C",
                                explanation: "Интеграл синуса равен минус косинус плюс константа.",
                                calculator: {
                                    inputs: [
                                        { label: "x₁ (нижний предел)", value: "" },
                                        { label: "x₂ (верхний предел)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const x1 = parseFloat(inputs['x₁ (нижний предел)']);
                                        const x2 = parseFloat(inputs['x₂ (верхний предел)']);
                                        
                                        if (isNaN(x1) || isNaN(x2)) return "Введите значения";
                                        
                                        return -Math.cos(x2) + Math.cos(x1);
                                    },
                                    steps: function(inputs) {
                                        const x1 = parseFloat(inputs['x₁ (нижний предел)']);
                                        const x2 = parseFloat(inputs['x₂ (верхний предел)']);
                                        
                                        if (isNaN(x1) || isNaN(x2)) return ["Введите значения"];
                                        
                                        return [
                                            `Шаг 1: Записываем интеграл: ∫sin x dx от ${x1} до ${x2}`,
                                            `Шаг 2: Находим первообразную: -cos x`,
                                            `Шаг 3: Подставляем верхний предел: -cos(${x2}) = ${-Math.cos(x2)}`,
                                            `Шаг 4: Подставляем нижний предел: -cos(${x1}) = ${-Math.cos(x1)}`,
                                            `Шаг 5: Вычисляем разность: (-cos(${x2})) - (-cos(${x1})) = ${-Math.cos(x2) + Math.cos(x1)}`,
                                            `Шаг 6: Получаем результат: ${-Math.cos(x2) + Math.cos(x1)}`
                                        ];
                                    }
                                }
                            }
                        ]
                    },
                    limits: {
                        title: "Пределы",
                        formulas: [
                            {
                                name: "Предел отношения при стремлении к нулю",
                                formula: "lim(x→0) sin(x)/x = 1",
                                explanation: "Первый замечательный предел: предел отношения синуса к аргументу при стремлении аргумента к нулю равен 1.",
                                calculator: {
                                    inputs: [
                                        { label: "x", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const x = parseFloat(inputs.x);
                                        
                                        if (isNaN(x)) return "Введите значение";
                                        
                                        if (x === 0) return "Неопределенность";
                                        return Math.sin(x) / x;
                                    },
                                    steps: function(inputs) {
                                        const x = parseFloat(inputs.x);
                                        
                                        if (isNaN(x)) return ["Введите значение"];
                                        
                                        if (x === 0) return ["Неопределенность 0/0"];
                                        
                                        return [
                                            `Шаг 1: Записываем предел: lim(x→0) sin(x)/x`,
                                            `Шаг 2: Подставляем x = ${x}`,
                                            `Шаг 3: Вычисляем sin(${x}) = ${Math.sin(x)}`,
                                            `Шаг 4: Делим: ${Math.sin(x)}/${x}`,
                                            `Шаг 5: Получаем результат: ${Math.sin(x)/x}`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Предел экспоненты",
                                formula: "lim(x→∞) (1 + 1/x)<sup>x</sup> = e",
                                explanation: "Второй замечательный предел: предел выражения (1 + 1/x)^x при стремлении x к бесконечности равен числу e.",
                                calculator: {
                                    inputs: [
                                        { label: "x", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const x = parseFloat(inputs.x);
                                        
                                        if (isNaN(x)) return "Введите значение";
                                        
                                        if (x === 0) return "x не может быть 0";
                                        return Math.pow(1 + 1/x, x);
                                    },
                                    steps: function(inputs) {
                                        const x = parseFloat(inputs.x);
                                        
                                        if (isNaN(x)) return ["Введите значение"];
                                        
                                        if (x === 0) return ["x не может быть 0"];
                                        
                                        return [
                                            `Шаг 1: Записываем предел: lim(x→∞) (1 + 1/x)^x`,
                                            `Шаг 2: Подставляем x = ${x}`,
                                            `Шаг 3: Вычисляем 1/x = 1/${x} = ${1/x}`,
                                            `Шаг 4: Вычисляем 1 + 1/x = 1 + ${1/x} = ${1 + 1/x}`,
                                            `Шаг 5: Возводим в степень x: (${1 + 1/x})^${x} = ${Math.pow(1 + 1/x, x)}`,
                                            `Шаг 6: Получаем результат: ${Math.pow(1 + 1/x, x)}`
                                        ];
                                    }
                                }
                            }
                        ]
                    }
                }
            },
            geometry: {
                "1-4": {
                    shapes: {
                        title: "Геометрические фигуры",
                        formulas: [
                            {
                                name: "Периметр прямоугольника",
                                formula: "P = 2(a + b)",
                                explanation: "Периметр прямоугольника равен удвоенной сумме его длины и ширины.",
                                calculator: {
                                    inputs: [
                                        { label: "a (длина)", value: "" },
                                        { label: "b (ширина)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const b = parseFloat(inputs.b);
                                        
                                        if (isNaN(a) || isNaN(b)) return "Введите значения";
                                        
                                        return 2 * (a + b);
                                    },
                                    steps: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const b = parseFloat(inputs.b);
                                        
                                        if (isNaN(a) || isNaN(b)) return ["Введите значения"];
                                        
                                        return [
                                            `Шаг 1: Записываем формулу: P = 2(a + b)`,
                                            `Шаг 2: Подставляем значения: P = 2(${a} + ${b})`,
                                            `Шаг 3: Вычисляем сумму: ${a} + ${b} = ${a+b}`,
                                            `Шаг 4: Умножаем на 2: 2 × ${a+b} = ${2*(a+b)}`,
                                            `Шаг 5: Получаем результат: P = ${2*(a+b)}`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Периметр квадрата",
                                formula: "P = 4a",
                                explanation: "Периметр квадрата равен четырем сторонам.",
                                calculator: {
                                    inputs: [
                                        { label: "a (сторона)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        
                                        if (isNaN(a)) return "Введите значение";
                                        
                                        return 4 * a;
                                    },
                                    steps: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        
                                        if (isNaN(a)) return ["Введите значение"];
                                        
                                        return [
                                            `Шаг 1: Записываем формулу: P = 4a`,
                                            `Шаг 2: Подставляем значение: P = 4 × ${a}`,
                                            `Шаг 3: Вычисляем: P = ${4 * a}`,
                                            `Шаг 4: Получаем результат: P = ${4 * a}`
                                        ];
                                    }
                                }
                            }
                        ]
                    },
                    perimeter: {
                        title: "Периметр",
                        formulas: [
                            {
                                name: "Периметр треугольника",
                                formula: "P = a + b + c",
                                explanation: "Периметр треугольника равен сумме длин его сторон.",
                                calculator: {
                                    inputs: [
                                        { label: "a", value: "" },
                                        { label: "b", value: "" },
                                        { label: "c", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const b = parseFloat(inputs.b);
                                        const c = parseFloat(inputs.c);
                                        
                                        if (isNaN(a) || isNaN(b) || isNaN(c)) return "Введите все стороны";
                                        
                                        return a + b + c;
                                    },
                                    steps: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const b = parseFloat(inputs.b);
                                        const c = parseFloat(inputs.c);
                                        
                                        if (isNaN(a) || isNaN(b) || isNaN(c)) return ["Введите все стороны"];
                                        
                                        return [
                                            `Шаг 1: Записываем формулу: P = a + b + c`,
                                            `Шаг 2: Подставляем значения: P = ${a} + ${b} + ${c}`,
                                            `Шаг 3: Вычисляем: ${a} + ${b} + ${c} = ${a+b+c}`,
                                            `Шаг 4: Получаем результат: P = ${a+b+c}`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Периметр круга (длина окружности)",
                                formula: "C = 2πr",
                                explanation: "Длина окружности равна удвоенному произведению числа π на радиус.",
                                calculator: {
                                    inputs: [
                                        { label: "r (радиус)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const r = parseFloat(inputs.r);
                                        
                                        if (isNaN(r)) return "Введите значение";
                                        
                                        return 2 * Math.PI * r;
                                    },
                                    steps: function(inputs) {
                                        const r = parseFloat(inputs.r);
                                        
                                        if (isNaN(r)) return ["Введите значение"];
                                        
                                        return [
                                            `Шаг 1: Записываем формулу: C = 2πr`,
                                            `Шаг 2: Подставляем значение: C = 2 × π × ${r}`,
                                            `Шаг 3: Вычисляем: C = 2 × 3.14 × ${r} = ${2 * Math.PI * r}`,
                                            `Шаг 4: Получаем результат: C = ${2 * Math.PI * r}`
                                        ];
                                    }
                                }
                            }
                        ]
                    },
                    area: {
                        title: "Площадь",
                        formulas: [
                            {
                                name: "Площадь прямоугольника",
                                formula: "S = a × b",
                                explanation: "Площадь прямоугольника равна произведению его длины и ширины.",
                                calculator: {
                                    inputs: [
                                        { label: "a (длина)", value: "" },
                                        { label: "b (ширина)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const b = parseFloat(inputs.b);
                                        
                                        if (isNaN(a) || isNaN(b)) return "Введите значения";
                                        
                                        return a * b;
                                    },
                                    steps: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const b = parseFloat(inputs.b);
                                        
                                        if (isNaN(a) || isNaN(b)) return ["Введите значения"];
                                        
                                        return [
                                            `Шаг 1: Записываем формулу: S = a × b`,
                                            `Шаг 2: Подставляем значения: S = ${a} × ${b}`,
                                            `Шаг 3: Вычисляем: S = ${a * b}`,
                                            `Шаг 4: Получаем результат: S = ${a * b}`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Площадь квадрата",
                                formula: "S = a<sup>2</sup>",
                                explanation: "Площадь квадрата равна квадрату его стороны.",
                                calculator: {
                                    inputs: [
                                        { label: "a (сторона)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        
                                        if (isNaN(a)) return "Введите значение";
                                        
                                        return a * a;
                                    },
                                    steps: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        
                                        if (isNaN(a)) return ["Введите значение"];
                                        
                                        return [
                                            `Шаг 1: Записываем формулу: S = a²`,
                                            `Шаг 2: Подставляем значение: S = ${a}²`,
                                            `Шаг 3: Вычисляем: S = ${a * a}`,
                                            `Шаг 4: Получаем результат: S = ${a * a}`
                                        ];
                                    }
                                }
                            }
                        ]
                    }
                },
                "5-6": {
                    angles: {
                        title: "Углы",
                        formulas: [
                            {
                                name: "Сумма углов треугольника",
                                formula: "∠A + ∠B + ∠C = 180°",
                                explanation: "Сумма внутренних углов треугольника всегда равна 180 градусов.",
                                calculator: {
                                    inputs: [
                                        { label: "∠A", value: "" },
                                        { label: "∠B", value: "" },
                                        { label: "∠C", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const A = parseFloat(inputs['∠A']);
                                        const B = parseFloat(inputs['∠B']);
                                        const C = parseFloat(inputs['∠C']);
                                        
                                        if (!isNaN(A) && !isNaN(B)) return 180 - A - B;
                                        if (!isNaN(A) && !isNaN(C)) return 180 - A - C;
                                        if (!isNaN(B) && !isNaN(C)) return 180 - B - C;
                                        return "Введите два известных угла";
                                    },
                                    steps: function(inputs) {
                                        const A = parseFloat(inputs['∠A']);
                                        const B = parseFloat(inputs['∠B']);
                                        const C = parseFloat(inputs['∠C']);
                                        
                                        if (!isNaN(A) && !isNaN(B)) {
                                            return [
                                                `Шаг 1: Записываем формулу: ∠A + ∠B + ∠C = 180°`,
                                                `Шаг 2: Подставляем известные углы: ∠A + ${B}° + ${C}° = 180°`,
                                                `Шаг 3: Вычисляем сумму известных углов: ${B}° + ${C}° = ${B+C}°`,
                                                `Шаг 4: Находим ∠A: ∠A = 180° - ${B+C}°`,
                                                `Шаг 5: Получаем результат: ∠A = ${180-B-C}°`
                                            ];
                                        }
                                        if (!isNaN(A) && !isNaN(C)) {
                                            return [
                                                `Шаг 1: Записываем формулу: ∠A + ∠B + ∠C = 180°`,
                                                `Шаг 2: Подставляем известные углы: ${A}° + ∠B + ${C}° = 180°`,
                                                `Шаг 3: Вычисляем сумму известных углов: ${A}° + ${C}° = ${A+C}°`,
                                                `Шаг 4: Находим ∠B: ∠B = 180° - ${A+C}°`,
                                                `Шаг 5: Получаем результат: ∠B = ${180-A-C}°`
                                            ];
                                        }
                                        if (!isNaN(B) && !isNaN(C)) {
                                            return [
                                                `Шаг 1: Записываем формулу: ∠A + ∠B + ∠C = 180°`,
                                                `Шаг 2: Подставляем известные углы: ${A}° + ${B}° + ∠C = 180°`,
                                                `Шаг 3: Вычисляем сумму известных углов: ${A}° + ${B}° = ${A+B}°`,
                                                `Шаг 4: Находим ∠C: ∠C = 180° - ${A+B}°`,
                                                `Шаг 5: Получаем результат: ∠C = ${180-A-B}°`
                                            ];
                                        }
                                        return ["Введите два известных угла"];
                                    }
                                }
                            },
                            {
                                name: "Сумма углов четырехугольника",
                                formula: "∠A + ∠B + ∠C + ∠D = 360°",
                                explanation: "Сумма внутренних углов четырехугольника всегда равна 360 градусов.",
                                calculator: {
                                    inputs: [
                                        { label: "∠A", value: "" },
                                        { label: "∠B", value: "" },
                                        { label: "∠C", value: "" },
                                        { label: "∠D", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const A = parseFloat(inputs['∠A']);
                                        const B = parseFloat(inputs['∠B']);
                                        const C = parseFloat(inputs['∠C']);
                                        const D = parseFloat(inputs['∠D']);
                                        
                                        if (!isNaN(A) && !isNaN(B) && !isNaN(C)) return 360 - A - B - C;
                                        if (!isNaN(A) && !isNaN(B) && !isNaN(D)) return 360 - A - B - D;
                                        if (!isNaN(A) && !isNaN(C) && !isNaN(D)) return 360 - A - C - D;
                                        if (!isNaN(B) && !isNaN(C) && !isNaN(D)) return 360 - B - C - D;
                                        return "Введите три известных угла";
                                    },
                                    steps: function(inputs) {
                                        const A = parseFloat(inputs['∠A']);
                                        const B = parseFloat(inputs['∠B']);
                                        const C = parseFloat(inputs['∠C']);
                                        const D = parseFloat(inputs['∠D']);
                                        
                                        if (!isNaN(A) && !isNaN(B) && !isNaN(C)) {
                                            return [
                                                `Шаг 1: Записываем формулу: ∠A + ∠B + ∠C + ∠D = 360°`,
                                                `Шаг 2: Подставляем известные углы: ∠A + ${B}° + ${C}° + ${D}° = 360°`,
                                                `Шаг 3: Вычисляем сумму известных углов: ${B}° + ${C}° + ${D}° = ${B+C+D}°`,
                                                `Шаг 4: Находим ∠A: ∠A = 360° - ${B+C+D}°`,
                                                `Шаг 5: Получаем результат: ∠A = ${360-B-C-D}°`
                                            ];
                                        }
                                        if (!isNaN(A) && !isNaN(B) && !isNaN(D)) {
                                            return [
                                                `Шаг 1: Записываем формулу: ∠A + ∠B + ∠C + ∠D = 360°`,
                                                `Шаг 2: Подставляем известные углы: ${A}° + ∠B + ${C}° + ${D}° = 360°`,
                                                `Шаг 3: Вычисляем сумму известных углов: ${A}° + ${C}° + ${D}° = ${A+C+D}°`,
                                                `Шаг 4: Находим ∠B: ∠B = 360° - ${A+C+D}°`,
                                                `Шаг 5: Получаем результат: ∠B = ${360-A-C-D}°`
                                            ];
                                        }
                                        if (!isNaN(A) && !isNaN(C) && !isNaN(D)) {
                                            return [
                                                `Шаг 1: Записываем формулу: ∠A + ∠B + ∠C + ∠D = 360°`,
                                                `Шаг 2: Подставляем известные углы: ${A}° + ${B}° + ∠C + ${D}° = 360°`,
                                                `Шаг 3: Вычисляем сумму известных углов: ${A}° + ${B}° + ${D}° = ${A+B+D}°`,
                                                `Шаг 4: Находим ∠C: ∠C = 360° - ${A+B+D}°`,
                                                `Шаг 5: Получаем результат: ∠C = ${360-A-B-D}°`
                                            ];
                                        }
                                        if (!isNaN(B) && !isNaN(C) && !isNaN(D)) {
                                            return [
                                                `Шаг 1: Записываем формулу: ∠A + ∠B + ∠C + ∠D = 360°`,
                                                `Шаг 2: Подставляем известные углы: ${A}° + ${B}° + ${C}° + ∠D = 360°`,
                                                `Шаг 3: Вычисляем сумму известных углов: ${A}° + ${B}° + ${C}° = ${A+B+C}°`,
                                                `Шаг 4: Находим ∠D: ∠D = 360° - ${A+B+C}°`,
                                                `Шаг 5: Получаем результат: ∠D = ${360-A-B-C}°`
                                            ];
                                        }
                                        return ["Введите три известных угла"];
                                    }
                                }
                            }
                        ]
                    },
                    symmetry: {
                        title: "Симметрия",
                        formulas: [
                            {
                                name: "Осевая симметрия",
                                formula: "S(x,y) → S'(x,-y)",
                                explanation: "При осевой симметрии относительно оси OX координата y меняет знак.",
                                calculator: {
                                    inputs: [
                                        { label: "x", value: "" },
                                        { label: "y", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const x = parseFloat(inputs.x);
                                        const y = parseFloat(inputs.y);
                                        
                                        if (isNaN(x) || isNaN(y)) return "Введите координаты";
                                        
                                        return `(${x}, ${-y})`;
                                    },
                                    steps: function(inputs) {
                                        const x = parseFloat(inputs.x);
                                        const y = parseFloat(inputs.y);
                                        
                                        if (isNaN(x) || isNaN(y)) return ["Введите координаты"];
                                        
                                        return [
                                            `Шаг 1: Записываем координаты точки: (${x}, ${y})`,
                                            `Шаг 2: Применяем осевую симметрию относительно оси OX`,
                                            `Шаг 3: Координата x остается неизменной: ${x}`,
                                            `Шаг 4: Координата y меняет знак: ${y} → ${-y}`,
                                            `Шаг 5: Получаем координаты симметричной точки: (${x}, ${-y})`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Центральная симметрия",
                                formula: "S(x,y) → S'(-x,-y)",
                                explanation: "При центральной симметрии относительно начала координат обе координаты меняют знак.",
                                calculator: {
                                    inputs: [
                                        { label: "x", value: "" },
                                        { label: "y", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const x = parseFloat(inputs.x);
                                        const y = parseFloat(inputs.y);
                                        
                                        if (isNaN(x) || isNaN(y)) return "Введите координаты";
                                        
                                        return `(${-x}, ${-y})`;
                                    },
                                    steps: function(inputs) {
                                        const x = parseFloat(inputs.x);
                                        const y = parseFloat(inputs.y);
                                        
                                        if (isNaN(x) || isNaN(y)) return ["Введите координаты"];
                                        
                                        return [
                                            `Шаг 1: Записываем координаты точки: (${x}, ${y})`,
                                            `Шаг 2: Применяем центральную симметрию относительно начала координат`,
                                            `Шаг 3: Координата x меняет знак: ${x} → ${-x}`,
                                            `Шаг 4: Координата y меняет знак: ${y} → ${-y}`,
                                            `Шаг 5: Получаем координаты симметричной точки: (${-x}, ${-y})`
                                        ];
                                    }
                                }
                            }
                        ]
                    },
                    circles: {
                        title: "Окружность",
                        formulas: [
                            {
                                name: "Длина окружности",
                                formula: "C = 2πr",
                                explanation: "Длина окружности равна удвоенному произведению числа π на радиус.",
                                calculator: {
                                    inputs: [
                                        { label: "r (радиус)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const r = parseFloat(inputs.r);
                                        
                                        if (isNaN(r)) return "Введите значение";
                                        
                                        return 2 * Math.PI * r;
                                    },
                                    steps: function(inputs) {
                                        const r = parseFloat(inputs.r);
                                        
                                        if (isNaN(r)) return ["Введите значение"];
                                        
                                        return [
                                            `Шаг 1: Записываем формулу: C = 2πr`,
                                            `Шаг 2: Подставляем значение: C = 2 × π × ${r}`,
                                            `Шаг 3: Вычисляем: C = 2 × 3.14 × ${r} = ${2 * Math.PI * r}`,
                                            `Шаг 4: Получаем результат: C = ${2 * Math.PI * r}`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Площадь круга",
                                formula: "S = πr<sup>2</sup>",
                                explanation: "Площадь круга равна числу π, умноженному на квадрат радиуса.",
                                calculator: {
                                    inputs: [
                                        { label: "r (радиус)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const r = parseFloat(inputs.r);
                                        
                                        if (isNaN(r)) return "Введите значение";
                                        
                                        return Math.PI * r * r;
                                    },
                                    steps: function(inputs) {
                                        const r = parseFloat(inputs.r);
                                        
                                        if (isNaN(r)) return ["Введите значение"];
                                        
                                        return [
                                            `Шаг 1: Записываем формулу: S = πr²`,
                                            `Шаг 2: Подставляем значение: S = π × ${r}²`,
                                            `Шаг 3: Вычисляем квадрат радиуса: ${r}² = ${r * r}`,
                                            `Шаг 4: Умножаем на π: S = 3.14 × ${r * r} = ${Math.PI * r * r}`,
                                            `Шаг 5: Получаем результат: S = ${Math.PI * r * r}`
                                        ];
                                    }
                                }
                            }
                        ]
                    }
                },
                7: {
                    triangles: {
                        title: "Треугольники",
                        formulas: [
                            {
                                name: "Теорема Пифагора",
                                formula: "c<sup>2</sup> = a<sup>2</sup> + b<sup>2</sup>",
                                explanation: "В прямоугольном треугольнике квадрат гипотенузы равен сумме квадратов катетов.",
                                calculator: {
                                    inputs: [
                                        { label: "a", value: "" },
                                        { label: "b", value: "" },
                                        { label: "c", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const b = parseFloat(inputs.b);
                                        const c = parseFloat(inputs.c);
                                        
                                        if (!isNaN(a) && !isNaN(b)) {
                                            return Math.sqrt(a*a + b*b);
                                        } else if (!isNaN(a) && !isNaN(c)) {
                                            return Math.sqrt(c*c - a*a);
                                        } else if (!isNaN(b) && !isNaN(c)) {
                                            return Math.sqrt(c*c - b*b);
                                        }
                                        
                                        return "Введите две известные величины";
                                    },
                                    steps: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const b = parseFloat(inputs.b);
                                        const c = parseFloat(inputs.c);
                                        
                                        if (!isNaN(a) && !isNaN(b)) {
                                            return [
                                                `Шаг 1: Записываем теорему Пифагора: c² = a² + b²`,
                                                `Шаг 2: Подставляем значения: c² = ${a}² + ${b}²`,
                                                `Шаг 3: Вычисляем квадраты: c² = ${a*a} + ${b*b}`,
                                                `Шаг 4: Складываем: c² = ${a*a + b*b}`,
                                                `Шаг 5: Извлекаем квадратный корень: c = √${a*a + b*b}`,
                                                `Шаг 6: Получаем результат: c = ${Math.sqrt(a*a + b*b)}`
                                            ];
                                        } else if (!isNaN(a) && !isNaN(c)) {
                                            return [
                                                `Шаг 1: Записываем теорему Пифагора: c² = a² + b²`,
                                                `Шаг 2: Выражаем b²: b² = c² - a²`,
                                                `Шаг 3: Подставляем значения: b² = ${c}² - ${a}²`,
                                                `Шаг 4: Вычисляем квадраты: b² = ${c*c} - ${a*a}`,
                                                `Шаг 5: Вычитаем: b² = ${c*c - a*a}`,
                                                `Шаг 6: Извлекаем квадратный корень: b = √${c*c - a*a}`,
                                                `Шаг 7: Получаем результат: b = ${Math.sqrt(c*c - a*a)}`
                                            ];
                                        } else if (!isNaN(b) && !isNaN(c)) {
                                            return [
                                                `Шаг 1: Записываем теорему Пифагора: c² = a² + b²`,
                                                `Шаг 2: Выражаем a²: a² = c² - b²`,
                                                `Шаг 3: Подставляем значения: a² = ${c}² - ${b}²`,
                                                `Шаг 4: Вычисляем квадраты: a² = ${c*c} - ${b*b}`,
                                                `Шаг 5: Вычитаем: a² = ${c*c - b*b}`,
                                                `Шаг 6: Извлекаем квадратный корень: a = √${c*c - b*b}`,
                                                `Шаг 7: Получаем результат: a = ${Math.sqrt(c*c - b*b)}`
                                            ];
                                        }
                                        
                                        return ["Введите две известные величины"];
                                    }
                                }
                            },
                            {
                                name: "Площадь треугольника",
                                formula: "S = (a × h)/2",
                                explanation: "Площадь треугольника равна половине произведения основания на высоту.",
                                calculator: {
                                    inputs: [
                                        { label: "a (основание)", value: "" },
                                        { label: "h (высота)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const h = parseFloat(inputs.h);
                                        
                                        if (isNaN(a) || isNaN(h)) return "Введите значения";
                                        
                                        return (a * h) / 2;
                                    },
                                    steps: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const h = parseFloat(inputs.h);
                                        
                                        if (isNaN(a) || isNaN(h)) return ["Введите значения"];
                                        
                                        return [
                                            `Шаг 1: Записываем формулу: S = (a × h)/2`,
                                            `Шаг 2: Подставляем значения: S = (${a} × ${h})/2`,
                                            `Шаг 3: Вычисляем произведение: ${a} × ${h} = ${a * h}`,
                                            `Шаг 4: Делим на 2: ${a * h}/2 = ${a * h / 2}`,
                                            `Шаг 5: Получаем результат: S = ${a * h / 2}`
                                        ];
                                    }
                                }
                            }
                        ]
                    },
                    quadrilaterals: {
                        title: "Четырехугольники",
                        formulas: [
                            {
                                name: "Площадь параллелограмма",
                                formula: "S = a × h",
                                explanation: "Площадь параллелограмма равна произведению основания на высоту.",
                                calculator: {
                                    inputs: [
                                        { label: "a (основание)", value: "" },
                                        { label: "h (высота)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const h = parseFloat(inputs.h);
                                        
                                        if (isNaN(a) || isNaN(h)) return "Введите значения";
                                        
                                        return a * h;
                                    },
                                    steps: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const h = parseFloat(inputs.h);
                                        
                                        if (isNaN(a) || isNaN(h)) return ["Введите значения"];
                                        
                                        return [
                                            `Шаг 1: Записываем формулу: S = a × h`,
                                            `Шаг 2: Подставляем значения: S = ${a} × ${h}`,
                                            `Шаг 3: Вычисляем: S = ${a * h}`,
                                            `Шаг 4: Получаем результат: S = ${a * h}`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Площадь трапеции",
                                formula: "S = (a + b) × h / 2",
                                explanation: "Площадь трапеции равна произведению полусуммы оснований на высоту.",
                                calculator: {
                                    inputs: [
                                        { label: "a (верхнее основание)", value: "" },
                                        { label: "b (нижнее основание)", value: "" },
                                        { label: "h (высота)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const b = parseFloat(inputs.b);
                                        const h = parseFloat(inputs.h);
                                        
                                        if (isNaN(a) || isNaN(b) || isNaN(h)) return "Введите значения";
                                        
                                        return (a + b) * h / 2;
                                    },
                                    steps: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const b = parseFloat(inputs.b);
                                        const h = parseFloat(inputs.h);
                                        
                                        if (isNaN(a) || isNaN(b) || isNaN(h)) return ["Введите значения"];
                                        
                                        return [
                                            `Шаг 1: Записываем формулу: S = (a + b) × h / 2`,
                                            `Шаг 2: Подставляем значения: S = (${a} + ${b}) × ${h} / 2`,
                                            `Шаг 3: Вычисляем сумму оснований: ${a} + ${b} = ${a + b}`,
                                            `Шаг 4: Умножаем на высоту: ${a + b} × ${h} = ${(a + b) * h}`,
                                            `Шаг 5: Делим на 2: ${(a + b) * h} / 2 = ${(a + b) * h / 2}`,
                                            `Шаг 6: Получаем результат: S = ${(a + b) * h / 2}`
                                        ];
                                    }
                                }
                            }
                        ]
                    },
                    vectors: {
                        title: "Векторы",
                        formulas: [
                            {
                                name: "Длина вектора",
                                formula: "|a| = √(x<sup>2</sup> + y<sup>2</sup>)",
                                explanation: "Длина вектора на плоскости равна квадратному корню из суммы квадратов его координат.",
                                calculator: {
                                    inputs: [
                                        { label: "x (координата x)", value: "" },
                                        { label: "y (координата y)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const x = parseFloat(inputs.x);
                                        const y = parseFloat(inputs.y);
                                        
                                        if (isNaN(x) || isNaN(y)) return "Введите координаты";
                                        
                                        return Math.sqrt(x*x + y*y);
                                    },
                                    steps: function(inputs) {
                                        const x = parseFloat(inputs.x);
                                        const y = parseFloat(inputs.y);
                                        
                                        if (isNaN(x) || isNaN(y)) return ["Введите координаты"];
                                        
                                        return [
                                            `Шаг 1: Записываем формулу: |a| = √(x² + y²)`,
                                            `Шаг 2: Подставляем значения: |a| = √(${x}² + ${y}²)`,
                                            `Шаг 3: Вычисляем квадраты: |a| = √(${x*x} + ${y*y})`,
                                            `Шаг 4: Складываем: |a| = √${x*x + y*y}`,
                                            `Шаг 5: Извлекаем квадратный корень: |a| = ${Math.sqrt(x*x + y*y)}`,
                                            `Шаг 6: Получаем результат: |a| = ${Math.sqrt(x*x + y*y)}`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Скалярное произведение векторов",
                                formula: "a · b = x<sub>1</sub>x<sub>2</sub> + y<sub>1</sub>y<sub>2</sub>",
                                explanation: "Скалярное произведение векторов равно сумме произведений соответствующих координат.",
                                calculator: {
                                    inputs: [
                                        { label: "x₁", value: "" },
                                        { label: "y₁", value: "" },
                                        { label: "x₂", value: "" },
                                        { label: "y₂", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const x1 = parseFloat(inputs.x1);
                                        const y1 = parseFloat(inputs.y1);
                                        const x2 = parseFloat(inputs.x2);
                                        const y2 = parseFloat(inputs.y2);
                                        
                                        if (isNaN(x1) || isNaN(y1) || isNaN(x2) || isNaN(y2)) return "Введите координаты";
                                        
                                        return x1*x2 + y1*y2;
                                    },
                                    steps: function(inputs) {
                                        const x1 = parseFloat(inputs.x1);
                                        const y1 = parseFloat(inputs.y1);
                                        const x2 = parseFloat(inputs.x2);
                                        const y2 = parseFloat(inputs.y2);
                                        
                                        if (isNaN(x1) || isNaN(y1) || isNaN(x2) || isNaN(y2)) return ["Введите координаты"];
                                        
                                        return [
                                            `Шаг 1: Записываем формулу: a · b = x₁x₂ + y₁y₂`,
                                            `Шаг 2: Подставляем значения: a · b = ${x1}×${x2} + ${y1}×${y2}`,
                                            `Шаг 3: Вычисляем произведения: ${x1}×${x2} = ${x1*x2}, ${y1}×${y2} = ${y1*y2}`,
                                            `Шаг 4: Складываем: ${x1*x2} + ${y1*y2} = ${x1*x2 + y1*y2}`,
                                            `Шаг 5: Получаем результат: a · b = ${x1*x2 + y1*y2}`
                                        ];
                                    }
                                }
                            }
                        ]
                    }
                },
                8: {
                    "similar-figures": {
                        title: "Подобные фигуры",
                        formulas: [
                            {
                                name: "Коэффициент подобия",
                                formula: "k = a<sub>1</sub>/a<sub>2</sub> = b<sub>1</sub>/b<sub>2</sub> = ...",
                                explanation: "Коэффициент подобия равен отношению соответствующих линейных размеров подобных фигур.",
                                calculator: {
                                    inputs: [
                                        { label: "a₁ (размер первой фигуры)", value: "" },
                                        { label: "a₂ (размер второй фигуры)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const a1 = parseFloat(inputs.a1);
                                        const a2 = parseFloat(inputs.a2);
                                        
                                        if (isNaN(a1) || isNaN(a2)) return "Введите значения";
                                        
                                        return a1 / a2;
                                    },
                                    steps: function(inputs) {
                                        const a1 = parseFloat(inputs.a1);
                                        const a2 = parseFloat(inputs.a2);
                                        
                                        if (isNaN(a1) || isNaN(a2)) return ["Введите значения"];
                                        
                                        return [
                                            `Шаг 1: Записываем формулу: k = a₁/a₂`,
                                            `Шаг 2: Подставляем значения: k = ${a1}/${a2}`,
                                            `Шаг 3: Вычисляем: k = ${a1 / a2}`,
                                            `Шаг 4: Получаем результат: k = ${a1 / a2}`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Отношение площадей подобных фигур",
                                formula: "S<sub>1</sub>/S<sub>2</sub> = k<sup>2</sup>",
                                explanation: "Отношение площадей подобных фигур равно квадрату коэффициента подобия.",
                                calculator: {
                                    inputs: [
                                        { label: "k (коэффициент подобия)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const k = parseFloat(inputs.k);
                                        
                                        if (isNaN(k)) return "Введите значение";
                                        
                                        return k * k;
                                    },
                                    steps: function(inputs) {
                                        const k = parseFloat(inputs.k);
                                        
                                        if (isNaN(k)) return ["Введите значение"];
                                        
                                        return [
                                            `Шаг 1: Записываем формулу: S₁/S₂ = k²`,
                                            `Шаг 2: Подставляем значение: S₁/S₂ = ${k}²`,
                                            `Шаг 3: Вычисляем: S₁/S₂ = ${k * k}`,
                                            `Шаг 4: Получаем результат: S₁/S₂ = ${k * k}`
                                        ];
                                    }
                                }
                            }
                        ]
                    },
                    "circle-theorems": {
                        title: "Теоремы об окружности",
                        formulas: [
                            {
                                name: "Теорема о вписанном угле",
                                formula: "∠ABC = 1/2 ∪AC",
                                explanation: "Вписанный угол равен половине дуги, на которую он опирается.",
                                calculator: {
                                    inputs: [
                                        { label: "∪AC (дуга в градусах)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const arc = parseFloat(inputs['∪AC (дуга в градусах)']);
                                        
                                        if (isNaN(arc)) return "Введите значение";
                                        
                                        return arc / 2;
                                    },
                                    steps: function(inputs) {
                                        const arc = parseFloat(inputs['∪AC (дуга в градусах)']);
                                        
                                        if (isNaN(arc)) return ["Введите значение"];
                                        
                                        return [
                                            `Шаг 1: Записываем теорему: ∠ABC = 1/2 ∪AC`,
                                            `Шаг 2: Подставляем значение дуги: ∠ABC = 1/2 × ${arc}`,
                                            `Шаг 3: Вычисляем: ∠ABC = ${arc / 2}`,
                                            `Шаг 4: Получаем результат: ∠ABC = ${arc / 2}°`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Теорема о центральном угле",
                                formula: "∠AOC = ∪AC",
                                explanation: "Центральный угол равен дуге, на которую он опирается.",
                                calculator: {
                                    inputs: [
                                        { label: "∪AC (дуга в градусах)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const arc = parseFloat(inputs['∪AC (дуга в градусах)']);
                                        
                                        if (isNaN(arc)) return "Введите значение";
                                        
                                        return arc;
                                    },
                                    steps: function(inputs) {
                                        const arc = parseFloat(inputs['∪AC (дуга в градусах)']);
                                        
                                        if (isNaN(arc)) return ["Введите значение"];
                                        
                                        return [
                                            `Шаг 1: Записываем теорему: ∠AOC = ∪AC`,
                                            `Шаг 2: Подставляем значение дуги: ∠AOC = ${arc}`,
                                            `Шаг 3: Получаем результат: ∠AOC = ${arc}°`
                                        ];
                                    }
                                }
                            }
                        ]
                    },
                    "area-volume": {
                        title: "Площади и объемы",
                        formulas: [
                            {
                                name: "Площадь поверхности куба",
                                formula: "S = 6a<sup>2</sup>",
                                explanation: "Площадь поверхности куба равна шести квадратам его ребра.",
                                calculator: {
                                    inputs: [
                                        { label: "a (ребро)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        
                                        if (isNaN(a)) return "Введите значение";
                                        
                                        return 6 * a * a;
                                    },
                                    steps: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        
                                        if (isNaN(a)) return ["Введите значение"];
                                        
                                        return [
                                            `Шаг 1: Записываем формулу: S = 6a²`,
                                            `Шаг 2: Подставляем значение: S = 6 × ${a}²`,
                                            `Шаг 3: Вычисляем квадрат: ${a}² = ${a * a}`,
                                            `Шаг 4: Умножаем на 6: S = 6 × ${a * a} = ${6 * a * a}`,
                                            `Шаг 5: Получаем результат: S = ${6 * a * a}`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Объем куба",
                                formula: "V = a<sup>3</sup>",
                                explanation: "Объем куба равен кубу его ребра.",
                                calculator: {
                                    inputs: [
                                        { label: "a (ребро)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        
                                        if (isNaN(a)) return "Введите значение";
                                        
                                        return a * a * a;
                                    },
                                    steps: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        
                                        if (isNaN(a)) return ["Введите значение"];
                                        
                                        return [
                                            `Шаг 1: Записываем формулу: V = a³`,
                                            `Шаг 2: Подставляем значение: V = ${a}³`,
                                            `Шаг 3: Вычисляем: V = ${a} × ${a} × ${a} = ${a * a * a}`,
                                            `Шаг 4: Получаем результат: V = ${a * a * a}`
                                        ];
                                    }
                                }
                            }
                        ]
                    }
                },
                9: {
                    "coordinate-geometry": {
                        title: "Координатная геометрия",
                        formulas: [
                            {
                                name: "Расстояние между точками",
                                formula: "d = √((x<sub>2</sub> - x<sub>1</sub>)<sup>2</sup> + (y<sub>2</sub> - y<sub>1</sub>)<sup>2</sup>)",
                                explanation: "Расстояние между двумя точками на плоскости вычисляется по формуле, аналогичной теореме Пифагора.",
                                calculator: {
                                    inputs: [
                                        { label: "x₁", value: "" },
                                        { label: "y₁", value: "" },
                                        { label: "x₂", value: "" },
                                        { label: "y₂", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const x1 = parseFloat(inputs.x1);
                                        const y1 = parseFloat(inputs.y1);
                                        const x2 = parseFloat(inputs.x2);
                                        const y2 = parseFloat(inputs.y2);
                                        
                                        if (isNaN(x1) || isNaN(y1) || isNaN(x2) || isNaN(y2)) return "Введите координаты";
                                        
                                        return Math.sqrt((x2 - x1) * (x2 - x1) + (y2 - y1) * (y2 - y1));
                                    },
                                    steps: function(inputs) {
                                        const x1 = parseFloat(inputs.x1);
                                        const y1 = parseFloat(inputs.y1);
                                        const x2 = parseFloat(inputs.x2);
                                        const y2 = parseFloat(inputs.y2);
                                        
                                        if (isNaN(x1) || isNaN(y1) || isNaN(x2) || isNaN(y2)) return ["Введите координаты"];
                                        
                                        return [
                                            `Шаг 1: Записываем формулу: d = √((x₂ - x₁)² + (y₂ - y₁)²)`,
                                            `Шаг 2: Подставляем значения: d = √((${x2} - ${x1})² + (${y2} - ${y1})²)`,
                                            `Шаг 3: Вычисляем разности: x₂ - x₁ = ${x2 - x1}, y₂ - y₁ = ${y2 - y1}`,
                                            `Шаг 4: Возводим в квадрат: (${x2 - x1})² = ${(x2 - x1) * (x2 - x1)}, (${y2 - y1})² = ${(y2 - y1) * (y2 - y1)}`,
                                            `Шаг 5: Складываем: ${(x2 - x1) * (x2 - x1)} + ${(y2 - y1) * (y2 - y1)} = ${(x2 - x1) * (x2 - x1) + (y2 - y1) * (y2 - y1)}`,
                                            `Шаг 6: Извлекаем квадратный корень: d = √${(x2 - x1) * (x2 - x1) + (y2 - y1) * (y2 - y1)}`,
                                            `Шаг 7: Получаем результат: d = ${Math.sqrt((x2 - x1) * (x2 - x1) + (y2 - y1) * (y2 - y1))}`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Уравнение прямой",
                                formula: "y = kx + b",
                                explanation: "Уравнение прямой в декартовой системе координат.",
                                calculator: {
                                    inputs: [
                                        { label: "k (угловой коэффициент)", value: "" },
                                        { label: "b", value: "" },
                                        { label: "x", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const k = parseFloat(inputs.k);
                                        const b = parseFloat(inputs.b);
                                        const x = parseFloat(inputs.x);
                                        
                                        if (isNaN(k) || isNaN(b) || isNaN(x)) return "Введите значения";
                                        
                                        return k * x + b;
                                    },
                                    steps: function(inputs) {
                                        const k = parseFloat(inputs.k);
                                        const b = parseFloat(inputs.b);
                                        const x = parseFloat(inputs.x);
                                        
                                        if (isNaN(k) || isNaN(b) || isNaN(x)) return ["Введите значения"];
                                        
                                        return [
                                            `Шаг 1: Записываем уравнение: y = ${k}x + ${b}`,
                                            `Шаг 2: Подставляем x = ${x}: y = ${k} × ${x} + ${b}`,
                                            `Шаг 3: Вычисляем: y = ${k * x} + ${b}`,
                                            `Шаг 4: Получаем результат: y = ${k * x + b}`
                                        ];
                                    }
                                }
                            }
                        ]
                    },
                    transformations: {
                        title: "Преобразования",
                        formulas: [
                            {
                                name: "Параллельный перенос",
                                formula: "(x, y) → (x + a, y + b)",
                                explanation: "При параллельном переносе каждая точка смещается на заданный вектор.",
                                calculator: {
                                    inputs: [
                                        { label: "x", value: "" },
                                        { label: "y", value: "" },
                                        { label: "a (смещение по x)", value: "" },
                                        { label: "b (смещение по y)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const x = parseFloat(inputs.x);
                                        const y = parseFloat(inputs.y);
                                        const a = parseFloat(inputs.a);
                                        const b = parseFloat(inputs.b);
                                        
                                        if (isNaN(x) || isNaN(y) || isNaN(a) || isNaN(b)) return "Введите значения";
                                        
                                        return `(${x + a}, ${y + b})`;
                                    },
                                    steps: function(inputs) {
                                        const x = parseFloat(inputs.x);
                                        const y = parseFloat(inputs.y);
                                        const a = parseFloat(inputs.a);
                                        const b = parseFloat(inputs.b);
                                        
                                        if (isNaN(x) || isNaN(y) || isNaN(a) || isNaN(b)) return ["Введите значения"];
                                        
                                        return [
                                            `Шаг 1: Записываем формулу: (x, y) → (x + a, y + b)`,
                                            `Шаг 2: Подставляем значения: (${x}, ${y}) → (${x} + ${a}, ${y} + ${b})`,
                                            `Шаг 3: Вычисляем: (${x + a}, ${y + b})`,
                                            `Шаг 4: Получаем результат: (${x + a}, ${y + b})`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Поворот вокруг начала координат",
                                formula: "x' = x·cosθ - y·sinθ, y' = x·sinθ + y·cosθ",
                                explanation: "При повороте точки вокруг начала координат на угол θ новые координаты вычисляются по этим формулам.",
                                calculator: {
                                    inputs: [
                                        { label: "x", value: "" },
                                        { label: "y", value: "" },
                                        { label: "θ (угол в градусах)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const x = parseFloat(inputs.x);
                                        const y = parseFloat(inputs.y);
                                        const theta_deg = parseFloat(inputs['θ (угол в градусах)']);
                                        const theta_rad = theta_deg * Math.PI / 180;
                                        const x_new = x * Math.cos(theta_rad) - y * Math.sin(theta_rad);
                                        const y_new = x * Math.sin(theta_rad) + y * Math.cos(theta_rad);
                                        
                                        if (isNaN(x) || isNaN(y) || isNaN(theta_deg)) return "Введите значения";
                                        
                                        return `(${x_new.toFixed(2)}, ${y_new.toFixed(2)})`;
                                    },
                                    steps: function(inputs) {
                                        const x = parseFloat(inputs.x);
                                        const y = parseFloat(inputs.y);
                                        const theta_deg = parseFloat(inputs['θ (угол в градусах)']);
                                        
                                        if (isNaN(x) || isNaN(y) || isNaN(theta_deg)) return ["Введите значения"];
                                        
                                        const theta_rad = theta_deg * Math.PI / 180;
                                        const x_new = x * Math.cos(theta_rad) - y * Math.sin(theta_rad);
                                        const y_new = x * Math.sin(theta_rad) + y * Math.cos(theta_rad);
                                        
                                        return [
                                            `Шаг 1: Записываем формулы: x' = x·cosθ - y·sinθ, y' = x·sinθ + y·cosθ`,
                                            `Шаг 2: Переводим угол в радианы: θ = ${theta_deg}° × π/180 = ${theta_rad.toFixed(4)} рад`,
                                            `Шаг 3: Вычисляем cosθ = cos(${theta_deg}°) = ${Math.cos(theta_rad).toFixed(4)}`,
                                            `Шаг 4: Вычисляем sinθ = sin(${theta_deg}°) = ${Math.sin(theta_rad).toFixed(4)}`,
                                            `Шаг 5: Вычисляем x' = ${x} × ${Math.cos(theta_rad).toFixed(4)} - ${y} × ${Math.sin(theta_rad).toFixed(4)} = ${x_new.toFixed(2)}`,
                                            `Шаг 6: Вычисляем y' = ${x} × ${Math.sin(theta_rad).toFixed(4)} + ${y} × ${Math.cos(theta_rad).toFixed(4)} = ${y_new.toFixed(2)}`,
                                            `Шаг 7: Получаем результат: (${x_new.toFixed(2)}, ${y_new.toFixed(2)})`
                                        ];
                                    }
                                }
                            }
                        ]
                    },
                    trigonometry: {
                        title: "Тригонометрия в геометрии",
                        formulas: [
                            {
                                name: "Теорема синусов",
                                formula: "a/sin α = b/sin β = c/sin γ = 2R",
                                explanation: "Стороны треугольника пропорциональны синусам противолежащих углов.",
                                calculator: {
                                    inputs: [
                                        { label: "a", value: "" },
                                        { label: "α (в градусах)", value: "" },
                                        { label: "β (в градусах)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const alpha_deg = parseFloat(inputs['α (в градусах)']);
                                        const beta_deg = parseFloat(inputs['β (в градусах)']);
                                        
                                        if (isNaN(a) || isNaN(alpha_deg) || isNaN(beta_deg)) return "Введите значения";
                                        
                                        const alpha_rad = alpha_deg * Math.PI / 180;
                                        const beta_rad = beta_deg * Math.PI / 180;
                                        return a * Math.sin(beta_rad) / Math.sin(alpha_rad);
                                    },
                                    steps: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const alpha_deg = parseFloat(inputs['α (в градусах)']);
                                        const beta_deg = parseFloat(inputs['β (в градусах)']);
                                        
                                        if (isNaN(a) || isNaN(alpha_deg) || isNaN(beta_deg)) return ["Введите значения"];
                                        
                                        const alpha_rad = alpha_deg * Math.PI / 180;
                                        const beta_rad = beta_deg * Math.PI / 180;
                                        const b = a * Math.sin(beta_rad) / Math.sin(alpha_rad);
                                        
                                        return [
                                            `Шаг 1: Записываем теорему: a/sin α = b/sin β`,
                                            `Шаг 2: Выражаем b: b = a × sin β / sin α`,
                                            `Шаг 3: Переводим углы в радианы: α = ${alpha_deg}° = ${alpha_rad.toFixed(4)} рад, β = ${beta_deg}° = ${beta_rad.toFixed(4)} рад`,
                                            `Шаг 4: Вычисляем sin α = sin(${alpha_deg}°) = ${Math.sin(alpha_rad).toFixed(4)}`,
                                            `Шаг 5: Вычисляем sin β = sin(${beta_deg}°) = ${Math.sin(beta_rad).toFixed(4)}`,
                                            `Шаг 6: Вычисляем b = ${a} × ${Math.sin(beta_rad).toFixed(4)} / ${Math.sin(alpha_rad).toFixed(4)} = ${b.toFixed(4)}`,
                                            `Шаг 7: Получаем результат: b = ${b.toFixed(4)}`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Теорема косинусов",
                                formula: "c<sup>2</sup> = a<sup>2</sup> + b<sup>2</sup> - 2ab·cos γ",
                                explanation: "Квадрат стороны треугольника равен сумме квадратов двух других сторон минус удвоенное произведение этих сторон на косинус угла между ними.",
                                calculator: {
                                    inputs: [
                                        { label: "a", value: "" },
                                        { label: "b", value: "" },
                                        { label: "γ (в градусах)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const b = parseFloat(inputs.b);
                                        const gamma_deg = parseFloat(inputs['γ (в градусах)']);
                                        
                                        if (isNaN(a) || isNaN(b) || isNaN(gamma_deg)) return "Введите значения";
                                        
                                        const gamma_rad = gamma_deg * Math.PI / 180;
                                        return Math.sqrt(a*a + b*b - 2*a*b*Math.cos(gamma_rad));
                                    },
                                    steps: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const b = parseFloat(inputs.b);
                                        const gamma_deg = parseFloat(inputs['γ (в градусах)']);
                                        
                                        if (isNaN(a) || isNaN(b) || isNaN(gamma_deg)) return ["Введите значения"];
                                        
                                        const gamma_rad = gamma_deg * Math.PI / 180;
                                        const c = Math.sqrt(a*a + b*b - 2*a*b*Math.cos(gamma_rad));
                                        
                                        return [
                                            `Шаг 1: Записываем теорему: c² = a² + b² - 2ab·cos γ`,
                                            `Шаг 2: Переводим угол в радианы: γ = ${gamma_deg}° = ${gamma_rad.toFixed(4)} рад`,
                                            `Шаг 3: Вычисляем cos γ = cos(${gamma_deg}°) = ${Math.cos(gamma_rad).toFixed(4)}`,
                                            `Шаг 4: Вычисляем 2ab·cos γ = 2 × ${a} × ${b} × ${Math.cos(gamma_rad).toFixed(4)} = ${2*a*b*Math.cos(gamma_rad).toFixed(4)}`,
                                            `Шаг 5: Вычисляем a² + b² = ${a*a} + ${b*b} = ${a*a + b*b}`,
                                            `Шаг 6: Вычисляем c² = ${a*a + b*b} - ${2*a*b*Math.cos(gamma_rad).toFixed(4)} = ${a*a + b*b - 2*a*b*Math.cos(gamma_rad).toFixed(4)}`,
                                            `Шаг 7: Извлекаем квадратный корень: c = √${(a*a + b*b - 2*a*b*Math.cos(gamma_rad)).toFixed(4)} = ${c.toFixed(4)}`,
                                            `Шаг 8: Получаем результат: c = ${c.toFixed(4)}`
                                        ];
                                    }
                                }
                            }
                        ]
                    }
                },
                "10-11": {
                    stereometry: {
                        title: "Стереометрия",
                        formulas: [
                            {
                                name: "Объем призмы",
                                formula: "V = S<sub>осн</sub> × h",
                                explanation: "Объем призмы равен произведению площади основания на высоту.",
                                calculator: {
                                    inputs: [
                                        { label: "S<sub>осн</sub> (площадь основания)", value: "" },
                                        { label: "h (высота)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const S = parseFloat(inputs['S<sub>осн</sub> (площадь основания)']);
                                        const h = parseFloat(inputs.h);
                                        
                                        if (isNaN(S) || isNaN(h)) return "Введите значения";
                                        
                                        return S * h;
                                    },
                                    steps: function(inputs) {
                                        const S = parseFloat(inputs['S<sub>осн</sub> (площадь основания)']);
                                        const h = parseFloat(inputs.h);
                                        
                                        if (isNaN(S) || isNaN(h)) return ["Введите значения"];
                                        
                                        return [
                                            `Шаг 1: Записываем формулу: V = S<sub>осн</sub> × h`,
                                            `Шаг 2: Подставляем значения: V = ${S} × ${h}`,
                                            `Шаг 3: Вычисляем: V = ${S * h}`,
                                            `Шаг 4: Получаем результат: V = ${S * h}`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Объем пирамиды",
                                formula: "V = (1/3) × S<sub>осн</sub> × h",
                                explanation: "Объем пирамиды равен одной трети произведения площади основания на высоту.",
                                calculator: {
                                    inputs: [
                                        { label: "S<sub>осн</sub> (площадь основания)", value: "" },
                                        { label: "h (высота)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const S = parseFloat(inputs['S<sub>осн</sub> (площадь основания)']);
                                        const h = parseFloat(inputs.h);
                                        
                                        if (isNaN(S) || isNaN(h)) return "Введите значения";
                                        
                                        return (1/3) * S * h;
                                    },
                                    steps: function(inputs) {
                                        const S = parseFloat(inputs['S<sub>осн</sub> (площадь основания)']);
                                        const h = parseFloat(inputs.h);
                                        
                                        if (isNaN(S) || isNaN(h)) return ["Введите значения"];
                                        
                                        return [
                                            `Шаг 1: Записываем формулу: V = (1/3) × S<sub>осн</sub> × h`,
                                            `Шаг 2: Подставляем значения: V = (1/3) × ${S} × ${h}`,
                                            `Шаг 3: Вычисляем произведение: ${S} × ${h} = ${S * h}`,
                                            `Шаг 4: Умножаем на 1/3: V = (1/3) × ${S * h} = ${(1/3) * S * h}`,
                                            `Шаг 5: Получаем результат: V = ${(1/3) * S * h}`
                                        ];
                                    }
                                }
                            }
                        ]
                    },
                    "vector-geometry": {
                        title: "Векторная геометрия",
                        formulas: [
                            {
                                name: "Векторное произведение",
                                formula: "a × b = |a||b|sinθ · n",
                                explanation: "Векторное произведение двух векторов - это вектор, перпендикулярный обоим исходным векторам.",
                                calculator: {
                                    inputs: [
                                        { label: "|a| (длина вектора a)", value: "" },
                                        { label: "|b| (длина вектора b)", value: "" },
                                        { label: "θ (угол в градусах)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const a = parseFloat(inputs['|a| (длина вектора a)']);
                                        const b = parseFloat(inputs['|b| (длина вектора b)']);
                                        const theta_deg = parseFloat(inputs['θ (угол в градусах)']);
                                        
                                        if (isNaN(a) || isNaN(b) || isNaN(theta_deg)) return "Введите значения";
                                        
                                        const theta_rad = theta_deg * Math.PI / 180;
                                        return a * b * Math.sin(theta_rad);
                                    },
                                    steps: function(inputs) {
                                        const a = parseFloat(inputs['|a| (длина вектора a)']);
                                        const b = parseFloat(inputs['|b| (длина вектора b)']);
                                        const theta_deg = parseFloat(inputs['θ (угол в градусах)']);
                                        
                                        if (isNaN(a) || isNaN(b) || isNaN(theta_deg)) return ["Введите значения"];
                                        
                                        const theta_rad = theta_deg * Math.PI / 180;
                                        const result = a * b * Math.sin(theta_rad);
                                        
                                        return [
                                            `Шаг 1: Записываем формулу: |a × b| = |a||b|sinθ`,
                                            `Шаг 2: Переводим угол в радианы: θ = ${theta_deg}° = ${theta_rad.toFixed(4)} рад`,
                                            `Шаг 3: Вычисляем sinθ = sin(${theta_deg}°) = ${Math.sin(theta_rad).toFixed(4)}`,
                                            `Шаг 4: Вычисляем |a × b| = ${a} × ${b} × ${Math.sin(theta_rad).toFixed(4)} = ${result.toFixed(4)}`,
                                            `Шаг 5: Получаем результат: |a × b| = ${result.toFixed(4)}`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Уравнение плоскости",
                                formula: "Ax + By + Cz + D = 0",
                                explanation: "Общее уравнение плоскости в трехмерном пространстве.",
                                calculator: {
                                    inputs: [
                                        { label: "A", value: "" },
                                        { label: "B", value: "" },
                                        { label: "C", value: "" },
                                        { label: "D", value: "" },
                                        { label: "x", value: "" },
                                        { label: "y", value: "" },
                                        { label: "z", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const A = parseFloat(inputs.A);
                                        const B = parseFloat(inputs.B);
                                        const C = parseFloat(inputs.C);
                                        const D = parseFloat(inputs.D);
                                        const x = parseFloat(inputs.x);
                                        const y = parseFloat(inputs.y);
                                        const z = parseFloat(inputs.z);
                                        
                                        if (isNaN(A) || isNaN(B) || isNaN(C) || isNaN(D) || isNaN(x) || isNaN(y) || isNaN(z)) return "Введите значения";
                                        
                                        return A*x + B*y + C*z + D;
                                    },
                                    steps: function(inputs) {
                                        const A = parseFloat(inputs.A);
                                        const B = parseFloat(inputs.B);
                                        const C = parseFloat(inputs.C);
                                        const D = parseFloat(inputs.D);
                                        const x = parseFloat(inputs.x);
                                        const y = parseFloat(inputs.y);
                                        const z = parseFloat(inputs.z);
                                        
                                        if (isNaN(A) || isNaN(B) || isNaN(C) || isNaN(D) || isNaN(x) || isNaN(y) || isNaN(z)) return ["Введите значения"];
                                        
                                        const result = A*x + B*y + C*z + D;
                                        
                                        return [
                                            `Шаг 1: Записываем уравнение: ${A}x + ${B}y + ${C}z + ${D} = 0`,
                                            `Шаг 2: Подставляем значения: ${A}×${x} + ${B}×${y} + ${C}×${z} + ${D}`,
                                            `Шаг 3: Вычисляем: ${A*x} + ${B*y} + ${C*z} + ${D} = ${result}`,
                                            `Шаг 4: Получаем результат: ${result}`
                                        ];
                                    }
                                }
                            }
                        ]
                    },
                    "analytic-geometry": {
                        title: "Аналитическая геометрия",
                        formulas: [
                            {
                                name: "Уравнение окружности",
                                formula: "(x - a)<sup>2</sup> + (y - b)<sup>2</sup> = r<sup>2</sup>",
                                explanation: "Уравнение окружности с центром в точке (a, b) и радиусом r.",
                                calculator: {
                                    inputs: [
                                        { label: "a (x-координата центра)", value: "" },
                                        { label: "b (y-координата центра)", value: "" },
                                        { label: "r (радиус)", value: "" },
                                        { label: "x", value: "" },
                                        { label: "y", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const b = parseFloat(inputs.b);
                                        const r = parseFloat(inputs.r);
                                        const x = parseFloat(inputs.x);
                                        const y = parseFloat(inputs.y);
                                        
                                        if (isNaN(a) || isNaN(b) || isNaN(r) || isNaN(x) || isNaN(y)) return "Введите значения";
                                        
                                        return Math.pow(x - a, 2) + Math.pow(y - b, 2) - Math.pow(r, 2);
                                    },
                                    steps: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const b = parseFloat(inputs.b);
                                        const r = parseFloat(inputs.r);
                                        const x = parseFloat(inputs.x);
                                        const y = parseFloat(inputs.y);
                                        
                                        if (isNaN(a) || isNaN(b) || isNaN(r) || isNaN(x) || isNaN(y)) return ["Введите значения"];
                                        
                                        const result = Math.pow(x - a, 2) + Math.pow(y - b, 2) - Math.pow(r, 2);
                                        
                                        return [
                                            `Шаг 1: Записываем уравнение: (x - ${a})² + (y - ${b})² = ${r}²`,
                                            `Шаг 2: Подставляем значения: (${x} - ${a})² + (${y} - ${b})² = ${r}²`,
                                            `Шаг 3: Вычисляем разности: x - a = ${x - a}, y - b = ${y - b}`,
                                            `Шаг 4: Возводим в квадрат: (${x - a})² = ${Math.pow(x - a, 2)}, (${y - b})² = ${Math.pow(y - b, 2)}`,
                                            `Шаг 5: Складываем: ${Math.pow(x - a, 2)} + ${Math.pow(y - b, 2)} = ${Math.pow(x - a, 2) + Math.pow(y - b, 2)}`,
                                            `Шаг 6: Сравниваем с r² = ${Math.pow(r, 2)}`,
                                            `Шаг 7: Получаем результат: ${Math.pow(x - a, 2) + Math.pow(y - b, 2) - Math.pow(r, 2)}`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Уравнение эллипса",
                                formula: "(x<sup>2</sup>/a<sup>2</sup>) + (y<sup>2</sup>/b<sup>2</sup>) = 1",
                                explanation: "Каноническое уравнение эллипса с полуосями a и b.",
                                calculator: {
                                    inputs: [
                                        { label: "a (большая полуось)", value: "" },
                                        { label: "b (малая полуось)", value: "" },
                                        { label: "x", value: "" },
                                        { label: "y", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const b = parseFloat(inputs.b);
                                        const x = parseFloat(inputs.x);
                                        const y = parseFloat(inputs.y);
                                        
                                        if (isNaN(a) || isNaN(b) || isNaN(x) || isNaN(y)) return "Введите значения";
                                        
                                        return Math.pow(x, 2)/Math.pow(a, 2) + Math.pow(y, 2)/Math.pow(b, 2);
                                    },
                                    steps: function(inputs) {
                                        const a = parseFloat(inputs.a);
                                        const b = parseFloat(inputs.b);
                                        const x = parseFloat(inputs.x);
                                        const y = parseFloat(inputs.y);
                                        
                                        if (isNaN(a) || isNaN(b) || isNaN(x) || isNaN(y)) return ["Введите значения"];
                                        
                                        const result = Math.pow(x, 2)/Math.pow(a, 2) + Math.pow(y, 2)/Math.pow(b, 2);
                                        
                                        return [
                                            `Шаг 1: Записываем уравнение: x²/${a}² + y²/${b}² = 1`,
                                            `Шаг 2: Подставляем значения: ${x}²/${a}² + ${y}²/${b}²`,
                                            `Шаг 3: Вычисляем квадраты: x² = ${Math.pow(x, 2)}, y² = ${Math.pow(y, 2)}`,
                                            `Шаг 4: Вычисляем знаменатели: a² = ${Math.pow(a, 2)}, b² = ${Math.pow(b, 2)}`,
                                            `Шаг 5: Делим: x²/a² = ${Math.pow(x, 2)/Math.pow(a, 2)}, y²/b² = ${Math.pow(y, 2)/Math.pow(b, 2)}`,
                                            `Шаг 6: Складываем: ${Math.pow(x, 2)/Math.pow(a, 2)} + ${Math.pow(y, 2)/Math.pow(b, 2)} = ${result}`,
                                            `Шаг 7: Получаем результат: ${result}`
                                        ];
                                    }
                                }
                            }
                        ]
                    }
                }
            },
            physics: {
                7: {
                    mechanics: {
                        title: "Механика",
                        formulas: [
                            {
                                name: "Скорость",
                                formula: "v = s / t",
                                explanation: "Скорость равна расстоянию, деленному на время.",
                                calculator: {
                                    inputs: [
                                        { label: "s (расстояние, м)", value: "" },
                                        { label: "t (время, с)", value: "" },
                                        { label: "v (скорость, м/с)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const s = inputs.s ? parseFloat(inputs.s) : null;
                                        const t = inputs.t ? parseFloat(inputs.t) : null;
                                        const v = inputs.v ? parseFloat(inputs.v) : null;
                                        
                                        if (s !== null && t !== null) return s / t;
                                        if (s !== null && v !== null) return s / v;
                                        if (t !== null && v !== null) return t * v;
                                        
                                        return "Введите две известные величины";
                                    },
                                    steps: function(inputs) {
                                        const s = inputs.s ? parseFloat(inputs.s) : null;
                                        const t = inputs.t ? parseFloat(inputs.t) : null;
                                        const v = inputs.v ? parseFloat(inputs.v) : null;
                                        
                                        if (s !== null && t !== null) {
                                            return [
                                                `Шаг 1: Записываем формулу: v = s / t`,
                                                `Шаг 2: Подставляем значения: v = ${s} / ${t}`,
                                                `Шаг 3: Вычисляем: v = ${s / t} м/с`
                                            ];
                                        }
                                        
                                        if (s !== null && v !== null) {
                                            return [
                                                `Шаг 1: Записываем формулу: t = s / v`,
                                                `Шаг 2: Подставляем значения: t = ${s} / ${v}`,
                                                `Шаг 3: Вычисляем: t = ${s / v} с`
                                            ];
                                        }
                                        
                                        if (t !== null && v !== null) {
                                            return [
                                                `Шаг 1: Записываем формулу: s = v × t`,
                                                `Шаг 2: Подставляем значения: s = ${v} × ${t}`,
                                                `Шаг 3: Вычисляем: s = ${v * t} м`
                                            ];
                                        }
                                        
                                        return ["Введите две известные величины"];
                                    }
                                }
                            },
                            {
                                name: "Плотность",
                                formula: "ρ = m / V",
                                explanation: "Плотность вещества равна массе, деленной на объем.",
                                calculator: {
                                    inputs: [
                                        { label: "m (масса, кг)", value: "" },
                                        { label: "V (объем, м³)", value: "" },
                                        { label: "ρ (плотность, кг/м³)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const m = inputs.m ? parseFloat(inputs.m) : null;
                                        const V = inputs.V ? parseFloat(inputs.V) : null;
                                        const ρ = inputs.ρ ? parseFloat(inputs.ρ) : null;
                                        
                                        if (m !== null && V !== null) return m / V;
                                        if (m !== null && ρ !== null) return m / ρ;
                                        if (V !== null && ρ !== null) return V * ρ;
                                        
                                        return "Введите две известные величины";
                                    },
                                    steps: function(inputs) {
                                        const m = inputs.m ? parseFloat(inputs.m) : null;
                                        const V = inputs.V ? parseFloat(inputs.V) : null;
                                        const ρ = inputs.ρ ? parseFloat(inputs.ρ) : null;
                                        
                                        if (m !== null && V !== null) {
                                            return [
                                                `Шаг 1: Записываем формулу: ρ = m / V`,
                                                `Шаг 2: Подставляем значения: ρ = ${m} / ${V}`,
                                                `Шаг 3: Вычисляем: ρ = ${m / V} кг/м³`
                                            ];
                                        }
                                        
                                        if (m !== null && ρ !== null) {
                                            return [
                                                `Шаг 1: Записываем формулу: V = m / ρ`,
                                                `Шаг 2: Подставляем значения: V = ${m} / ${ρ}`,
                                                `Шаг 3: Вычисляем: V = ${m / ρ} м³`
                                            ];
                                        }
                                        
                                        if (V !== null && ρ !== null) {
                                            return [
                                                `Шаг 1: Записываем формулу: m = ρ × V`,
                                                `Шаг 2: Подставляем значения: m = ${ρ} × ${V}`,
                                                `Шаг 3: Вычисляем: m = ${ρ * V} кг`
                                            ];
                                        }
                                        
                                        return ["Введите две известные величины"];
                                    }
                                }
                            }
                        ]
                    },
                    thermal: {
                        title: "Тепловые явления",
                        formulas: [
                            {
                                name: "Количество теплоты при нагревании",
                                formula: "Q = cm(t<sub>к</sub> - t<sub>н</sub>)",
                                explanation: "Количество теплоты, необходимое для нагревания тела, равно произведению удельной теплоемкости, массы и разности температур.",
                                calculator: {
                                    inputs: [
                                        { label: "c (удельная теплоемкость, Дж/(кг·°C))", value: "" },
                                        { label: "m (масса, кг)", value: "" },
                                        { label: "t<sub>н</sub> (начальная температура, °C)", value: "" },
                                        { label: "t<sub>к</sub> (конечная температура, °C)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const c = parseFloat(inputs['c (удельная теплоемкость, Дж/(кг·°C))']);
                                        const m = parseFloat(inputs['m (масса, кг)']);
                                        const tн = parseFloat(inputs['t<sub>н</sub> (начальная температура, °C)']);
                                        const tк = parseFloat(inputs['t<sub>к</sub> (конечная температура, °C)']);
                                        
                                        if (isNaN(c) || isNaN(m) || isNaN(tн) || isNaN(tк)) return "Введите значения";
                                        
                                        return c * m * (tк - tн);
                                    },
                                    steps: function(inputs) {
                                        const c = parseFloat(inputs['c (удельная теплоемкость, Дж/(кг·°C))']);
                                        const m = parseFloat(inputs['m (масса, кг)']);
                                        const tн = parseFloat(inputs['t<sub>н</sub> (начальная температура, °C)']);
                                        const tк = parseFloat(inputs['t<sub>к</sub> (конечная температура, °C)']);
                                        
                                        if (isNaN(c) || isNaN(m) || isNaN(tн) || isNaN(tк)) return ["Введите значения"];
                                        
                                        const Q = c * m * (tк - tн);
                                        
                                        return [
                                            `Шаг 1: Записываем формулу: Q = cm(tк - tн)`,
                                            `Шаг 2: Подставляем значения: Q = ${c} × ${m} × (${tк} - ${tн})`,
                                            `Шаг 3: Вычисляем разность температур: ${tк} - ${tн} = ${tк - tн} °C`,
                                            `Шаг 4: Вычисляем: Q = ${c} × ${m} × ${tк - tн} = ${Q} Дж`,
                                            `Шаг 5: Получаем результат: Q = ${Q} Дж`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Количество теплоты при плавлении",
                                formula: "Q = λm",
                                explanation: "Количество теплоты, необходимое для плавления тела, равно произведению удельной теплоты плавления на массу.",
                                calculator: {
                                    inputs: [
                                        { label: "λ (удельная теплота плавления, Дж/кг)", value: "" },
                                        { label: "m (масса, кг)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const λ = parseFloat(inputs['λ (удельная теплота плавления, Дж/кг)']);
                                        const m = parseFloat(inputs['m (масса, кг)']);
                                        
                                        if (isNaN(λ) || isNaN(m)) return "Введите значения";
                                        
                                        return λ * m;
                                    },
                                    steps: function(inputs) {
                                        const λ = parseFloat(inputs['λ (удельная теплота плавления, Дж/кг)']);
                                        const m = parseFloat(inputs['m (масса, кг)']);
                                        
                                        if (isNaN(λ) || isNaN(m)) return ["Введите значения"];
                                        
                                        const Q = λ * m;
                                        
                                        return [
                                            `Шаг 1: Записываем формулу: Q = λm`,
                                            `Шаг 2: Подставляем значения: Q = ${λ} × ${m}`,
                                            `Шаг 3: Вычисляем: Q = ${Q} Дж`,
                                            `Шаг 4: Получаем результат: Q = ${Q} Дж`
                                        ];
                                    }
                                }
                            }
                        ]
                    },
                    optics: {
                        title: "Оптика",
                        formulas: [
                            {
                                name: "Закон отражения",
                                formula: "α = γ",
                                explanation: "Угол падения равен углу отражения.",
                                calculator: {
                                    inputs: [
                                        { label: "α (угол падения, °)", value: "" },
                                        { label: "γ (угол отражения, °)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const α = parseFloat(inputs['α (угол падения, °)']);
                                        const γ = parseFloat(inputs['γ (угол отражения, °)']);
                                        
                                        if (!isNaN(α)) return α;
                                        if (!isNaN(γ)) return γ;
                                        
                                        return "Введите угол падения или угол отражения";
                                    },
                                    steps: function(inputs) {
                                        const α = parseFloat(inputs['α (угол падения, °)']);
                                        const γ = parseFloat(inputs['γ (угол отражения, °)']);
                                        
                                        if (!isNaN(α)) {
                                            return [
                                                `Шаг 1: Записываем закон отражения: α = γ`,
                                                `Шаг 2: Подставляем угол падения: α = ${α}°`,
                                                `Шаг 3: Угол отражения равен углу падения: γ = ${α}°`,
                                                `Шаг 4: Получаем результат: γ = ${α}°`
                                            ];
                                        }
                                        
                                        if (!isNaN(γ)) {
                                            return [
                                                `Шаг 1: Записываем закон отражения: α = γ`,
                                                `Шаг 2: Подставляем угол отражения: γ = ${γ}°`,
                                                `Шаг 3: Угол падения равен углу отражения: α = ${γ}°`,
                                                `Шаг 4: Получаем результат: α = ${γ}°`
                                            ];
                                        }
                                        
                                        return ["Введите угол падения или угол отражения"];
                                    }
                                }
                            },
                            {
                                name: "Закон преломления (закон Снеллиуса)",
                                formula: "n<sub>1</sub>sin α = n<sub>2</sub>sin β",
                                explanation: "Произведение показателя преломления на синус угла падения равно произведению показателя преломления второй среды на синус угла преломления.",
                                calculator: {
                                    inputs: [
                                        { label: "n₁ (показатель преломления первой среды)", value: "" },
                                        { label: "n₂ (показатель преломления второй среды)", value: "" },
                                        { label: "α (угол падения, °)", value: "" },
                                        { label: "β (угол преломления, °)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const n1 = parseFloat(inputs['n₁ (показатель преломления первой среды)']);
                                        const n2 = parseFloat(inputs['n₂ (показатель преломления второй среды)']);
                                        const α_deg = parseFloat(inputs['α (угол падения, °)']);
                                        const β_deg = parseFloat(inputs['β (угол преломления, °)']);
                                        
                                        if (isNaN(n1) || isNaN(n2) || isNaN(α_deg) || isNaN(β_deg)) return "Введите значения";
                                        
                                        if (!isNaN(n1) && !isNaN(n2) && !isNaN(α_deg)) return Math.asin(n1 * Math.sin(α_deg * Math.PI / 180) / n2) * 180 / Math.PI;
                                        if (!isNaN(n1) && !isNaN(n2) && !isNaN(β_deg)) return Math.asin(n2 * Math.sin(β_deg * Math.PI / 180) / n1) * 180 / Math.PI;
                                        
                                        return "Введите три известные величины";
                                    },
                                    steps: function(inputs) {
                                        const n1 = parseFloat(inputs['n₁ (показатель преломления первой среды)']);
                                        const n2 = parseFloat(inputs['n₂ (показатель преломления второй среды)']);
                                        const α_deg = parseFloat(inputs['α (угол падения, °)']);
                                        const β_deg = parseFloat(inputs['β (угол преломления, °)']);
                                        
                                        if (isNaN(n1) || isNaN(n2) || isNaN(α_deg) || isNaN(β_deg)) return ["Введите значения"];
                                        
                                        if (!isNaN(n1) && !isNaN(n2) && !isNaN(α_deg)) {
                                            const α_rad = α_deg * Math.PI / 180;
                                            const β_rad = Math.asin(n1 * Math.sin(α_rad) / n2);
                                            const β_result = β_rad * 180 / Math.PI;
                                            
                                            return [
                                                `Шаг 1: Записываем закон преломления: n₁sin α = n₂sin β`,
                                                `Шаг 2: Выражаем sin β: sin β = (n₁/n₂) × sin α`,
                                                `Шаг 3: Подставляем значения: sin β = (${n1}/${n2}) × sin(${α_deg}°)`,
                                                `Шаг 4: Вычисляем sin α = sin(${α_deg}°) = ${Math.sin(α_rad).toFixed(4)}`,
                                                `Шаг 5: Вычисляем: sin β = (${n1}/${n2}) × ${Math.sin(α_rad).toFixed(4)} = ${(n1/n2) * Math.sin(α_rad).toFixed(4)}`,
                                                `Шаг 6: Находим β = arcsin(${(n1/n2) * Math.sin(α_rad).toFixed(4)}) = ${β_result.toFixed(2)}°`,
                                                `Шаг 7: Получаем результат: β = ${β_result.toFixed(2)}°`
                                            ];
                                        }
                                        
                                        if (!isNaN(n1) && !isNaN(n2) && !isNaN(β_deg)) {
                                            const β_rad = β_deg * Math.PI / 180;
                                            const α_rad = Math.asin(n2 * Math.sin(β_rad) / n1);
                                            const α_result = α_rad * 180 / Math.PI;
                                            
                                            return [
                                                `Шаг 1: Записываем закон преломления: n₁sin α = n₂sin β`,
                                                `Шаг 2: Выражаем sin α: sin α = (n₂/n₁) × sin β`,
                                                `Шаг 3: Подставляем значения: sin α = (${n2}/${n1}) × sin(${β_deg}°)`,
                                                `Шаг 4: Вычисляем sin β = sin(${β_deg}°) = ${Math.sin(β_rad).toFixed(4)}`,
                                                `Шаг 5: Вычисляем: sin α = (${n2}/${n1}) × ${Math.sin(β_rad).toFixed(4)} = ${(n2/n1) * Math.sin(β_rad).toFixed(4)}`,
                                                `Шаг 6: Находим α = arcsin(${(n2/n1) * Math.sin(β_rad).toFixed(4)}) = ${α_result.toFixed(2)}°`,
                                                `Шаг 7: Получаем результат: α = ${α_result.toFixed(2)}°`
                                            ];
                                        }
                                        
                                        return ["Введите три известные величины"];
                                    }
                                }
                            }
                        ]
                    }
                },
                8: {
                    electromagnetism: {
                        title: "Электромагнетизм",
                        formulas: [
                            {
                                name: "Сила тока",
                                formula: "I = q / t",
                                explanation: "Сила тока равна заряду, прошедшему через поперечное сечение проводника, деленному на время.",
                                calculator: {
                                    inputs: [
                                        { label: "q (заряд, Кл)", value: "" },
                                        { label: "t (время, с)", value: "" },
                                        { label: "I (сила тока, А)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const q = inputs.q ? parseFloat(inputs.q) : null;
                                        const t = inputs.t ? parseFloat(inputs.t) : null;
                                        const I = inputs.I ? parseFloat(inputs.I) : null;
                                        
                                        if (q !== null && t !== null) return q / t;
                                        if (q !== null && I !== null) return q / I;
                                        if (t !== null && I !== null) return t * I;
                                        
                                        return "Введите две известные величины";
                                    },
                                    steps: function(inputs) {
                                        const q = inputs.q ? parseFloat(inputs.q) : null;
                                        const t = inputs.t ? parseFloat(inputs.t) : null;
                                        const I = inputs.I ? parseFloat(inputs.I) : null;
                                        
                                        if (q !== null && t !== null) {
                                            return [
                                                `Шаг 1: Записываем формулу: I = q / t`,
                                                `Шаг 2: Подставляем значения: I = ${q} / ${t}`,
                                                `Шаг 3: Вычисляем: I = ${q / t} А`
                                            ];
                                        }
                                        
                                        if (q !== null && I !== null) {
                                            return [
                                                `Шаг 1: Записываем формулу: t = q / I`,
                                                `Шаг 2: Подставляем значения: t = ${q} / ${I}`,
                                                `Шаг 3: Вычисляем: t = ${q / I} с`
                                            ];
                                        }
                                        
                                        if (t !== null && I !== null) {
                                            return [
                                                `Шаг 1: Записываем формулу: q = I × t`,
                                                `Шаг 2: Подставляем значения: q = ${I} × ${t}`,
                                                `Шаг 3: Вычисляем: q = ${I * t} Кл`
                                            ];
                                        }
                                        
                                        return ["Введите две известные величины"];
                                    }
                                }
                            },
                            {
                                name: "Закон Ома",
                                formula: "I = U / R",
                                explanation: "Сила тока в участке цепи прямо пропорциональна напряжению на этом участке и обратно пропорциональна его сопротивлению.",
                                calculator: {
                                    inputs: [
                                        { label: "U (напряжение, В)", value: "" },
                                        { label: "R (сопротивление, Ом)", value: "" },
                                        { label: "I (сила тока, А)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const U = inputs.U ? parseFloat(inputs.U) : null;
                                        const R = inputs.R ? parseFloat(inputs.R) : null;
                                        const I = inputs.I ? parseFloat(inputs.I) : null;
                                        
                                        if (U !== null && R !== null) return U / R;
                                        if (U !== null && I !== null) return U / I;
                                        if (R !== null && I !== null) return R * I;
                                        
                                        return "Введите две известные величины";
                                    },
                                    steps: function(inputs) {
                                        const U = inputs.U ? parseFloat(inputs.U) : null;
                                        const R = inputs.R ? parseFloat(inputs.R) : null;
                                        const I = inputs.I ? parseFloat(inputs.I) : null;
                                        
                                        if (U !== null && R !== null) {
                                            return [
                                                `Шаг 1: Записываем закон Ома: I = U / R`,
                                                `Шаг 2: Подставляем значения: I = ${U} / ${R}`,
                                                `Шаг 3: Вычисляем: I = ${U / R} А`
                                            ];
                                        }
                                        
                                        if (U !== null && I !== null) {
                                            return [
                                                `Шаг 1: Записываем закон Ома: R = U / I`,
                                                `Шаг 2: Подставляем значения: R = ${U} / ${I}`,
                                                `Шаг 3: Вычисляем: R = ${U / I} Ом`
                                            ];
                                        }
                                        
                                        if (R !== null && I !== null) {
                                            return [
                                                `Шаг 1: Записываем закон Ома: U = I × R`,
                                                `Шаг 2: Подставляем значения: U = ${I} × ${R}`,
                                                `Шаг 3: Вычисляем: U = ${I * R} В`
                                            ];
                                        }
                                        
                                        return ["Введите две известные величины"];
                                    }
                                }
                            }
                        ]
                    },
                    energy: {
                        title: "Энергия",
                        formulas: [
                            {
                                name: "Кинетическая энергия",
                                formula: "E<sub>к</sub> = mv<sup>2</sup>/2",
                                explanation: "Кинетическая энергия тела равна половине произведения массы тела на квадрат его скорости.",
                                calculator: {
                                    inputs: [
                                        { label: "m (масса, кг)", value: "" },
                                        { label: "v (скорость, м/с)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const m = parseFloat(inputs['m (масса, кг)']);
                                        const v = parseFloat(inputs['v (скорость, м/с)']);
                                        
                                        if (isNaN(m) || isNaN(v)) return "Введите значения";
                                        
                                        return m * v * v / 2;
                                    },
                                    steps: function(inputs) {
                                        const m = parseFloat(inputs['m (масса, кг)']);
                                        const v = parseFloat(inputs['v (скорость, м/с)']);
                                        
                                        if (isNaN(m) || isNaN(v)) return ["Введите значения"];
                                        
                                        const E = m * v * v / 2;
                                        
                                        return [
                                            `Шаг 1: Записываем формулу: Eк = mv²/2`,
                                            `Шаг 2: Подставляем значения: Eк = ${m} × ${v}² / 2`,
                                            `Шаг 3: Вычисляем квадрат скорости: ${v}² = ${v * v}`,
                                            `Шаг 4: Вычисляем: Eк = ${m} × ${v * v} / 2 = ${E} Дж`,
                                            `Шаг 5: Получаем результат: Eк = ${E} Дж`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Потенциальная энергия",
                                formula: "E<sub>п</sub> = mgh",
                                explanation: "Потенциальная энергия тела, поднятого над землей, равна произведению массы тела, ускорения свободного падения и высоты.",
                                calculator: {
                                    inputs: [
                                        { label: "m (масса, кг)", value: "" },
                                        { label: "g (ускорение свободного падения, м/с²)", value: "" },
                                        { label: "h (высота, м)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const m = parseFloat(inputs['m (масса, кг)']);
                                        const g = parseFloat(inputs['g (ускорение свободного падения, м/с²)']);
                                        const h = parseFloat(inputs['h (высота, м)']);
                                        
                                        if (isNaN(m) || isNaN(g) || isNaN(h)) return "Введите значения";
                                        
                                        return m * g * h;
                                    },
                                    steps: function(inputs) {
                                        const m = parseFloat(inputs['m (масса, кг)']);
                                        const g = parseFloat(inputs['g (ускорение свободного падения, м/с²)']);
                                        const h = parseFloat(inputs['h (высота, м)']);
                                        
                                        if (isNaN(m) || isNaN(g) || isNaN(h)) return ["Введите значения"];
                                        
                                        const E = m * g * h;
                                        
                                        return [
                                            `Шаг 1: Записываем формулу: Eп = mgh`,
                                            `Шаг 2: Подставляем значения: Eп = ${m} × ${g} × ${h}`,
                                            `Шаг 3: Вычисляем: Eп = ${m * g * h} Дж`,
                                            `Шаг 4: Получаем результат: Eп = ${E} Дж`
                                        ];
                                    }
                                }
                            }
                        ]
                    },
                    waves: {
                        title: "Волны",
                        formulas: [
                            {
                                name: "Скорость волны",
                                formula: "v = λf",
                                explanation: "Скорость волны равна произведению длины волны на частоту.",
                                calculator: {
                                    inputs: [
                                        { label: "λ (длина волны, м)", value: "" },
                                        { label: "f (частота, Гц)", value: "" },
                                        { label: "v (скорость, м/с)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const λ = inputs.λ ? parseFloat(inputs.λ) : null;
                                        const f = inputs.f ? parseFloat(inputs.f) : null;
                                        const v = inputs.v ? parseFloat(inputs.v) : null;
                                        
                                        if (λ !== null && f !== null) return λ * f;
                                        if (λ !== null && v !== null) return v / λ;
                                        if (f !== null && v !== null) return v / f;
                                        
                                        return "Введите две известные величины";
                                    },
                                    steps: function(inputs) {
                                        const λ = inputs.λ ? parseFloat(inputs.λ) : null;
                                        const f = inputs.f ? parseFloat(inputs.f) : null;
                                        const v = inputs.v ? parseFloat(inputs.v) : null;
                                        
                                        if (λ !== null && f !== null) {
                                            return [
                                                `Шаг 1: Записываем формулу: v = λf`,
                                                `Шаг 2: Подставляем значения: v = ${λ} × ${f}`,
                                                `Шаг 3: Вычисляем: v = ${λ * f} м/с`
                                            ];
                                        }
                                        
                                        if (λ !== null && v !== null) {
                                            return [
                                                `Шаг 1: Записываем формулу: f = v / λ`,
                                                `Шаг 2: Подставляем значения: f = ${v} / ${λ}`,
                                                `Шаг 3: Вычисляем: f = ${v / λ} Гц`
                                            ];
                                        }
                                        
                                        if (f !== null && v !== null) {
                                            return [
                                                `Шаг 1: Записываем формулу: λ = v / f`,
                                                `Шаг 2: Подставляем значения: λ = ${v} / ${f}`,
                                                `Шаг 3: Вычисляем: λ = ${v / f} м`
                                            ];
                                        }
                                        
                                        return ["Введите две известные величины"];
                                    }
                                }
                            },
                            {
                                name: "Период колебаний",
                                formula: "T = 1 / f",
                                explanation: "Период колебаний равен обратной величине частоты.",
                                calculator: {
                                    inputs: [
                                        { label: "f (частота, Гц)", value: "" },
                                        { label: "T (период, с)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const f = inputs.f ? parseFloat(inputs.f) : null;
                                        const T = inputs.T ? parseFloat(inputs.T) : null;
                                        
                                        if (f !== null) return 1 / f;
                                        if (T !== null) return 1 / T;
                                        
                                        return "Введите частоту или период";
                                    },
                                    steps: function(inputs) {
                                        const f = inputs.f ? parseFloat(inputs.f) : null;
                                        const T = inputs.T ? parseFloat(inputs.T) : null;
                                        
                                        if (f !== null) {
                                            return [
                                                `Шаг 1: Записываем формулу: T = 1 / f`,
                                                `Шаг 2: Подставляем значение: T = 1 / ${f}`,
                                                `Шаг 3: Вычисляем: T = ${1 / f} с`
                                            ];
                                        }
                                        
                                        if (T !== null) {
                                            return [
                                                `Шаг 1: Записываем формулу: f = 1 / T`,
                                                `Шаг 2: Подставляем значение: f = 1 / ${T}`,
                                                `Шаг 3: Вычисляем: f = ${1 / T} Гц`
                                            ];
                                        }
                                        
                                        return ["Введите частоту или период"];
                                    }
                                }
                            }
                        ]
                    }
                },
                9: {
                    kinematics: {
                        title: "Кинематика",
                        formulas: [
                            {
                                name: "Равномерное прямолинейное движение",
                                formula: "s = vt",
                                explanation: "При равномерном прямолинейном движении пройденный путь равен произведению скорости на время.",
                                calculator: {
                                    inputs: [
                                        { label: "v (скорость, м/с)", value: "" },
                                        { label: "t (время, с)", value: "" },
                                        { label: "s (путь, м)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const v = inputs.v ? parseFloat(inputs.v) : null;
                                        const t = inputs.t ? parseFloat(inputs.t) : null;
                                        const s = inputs.s ? parseFloat(inputs.s) : null;
                                        
                                        if (v !== null && t !== null) return v * t;
                                        if (v !== null && s !== null) return s / v;
                                        if (t !== null && s !== null) return s / t;
                                        
                                        return "Введите две известные величины";
                                    },
                                    steps: function(inputs) {
                                        const v = inputs.v ? parseFloat(inputs.v) : null;
                                        const t = inputs.t ? parseFloat(inputs.t) : null;
                                        const s = inputs.s ? parseFloat(inputs.s) : null;
                                        
                                        if (v !== null && t !== null) {
                                            return [
                                                `Шаг 1: Записываем формулу: s = vt`,
                                                `Шаг 2: Подставляем значения: s = ${v} × ${t}`,
                                                `Шаг 3: Вычисляем: s = ${v * t} м`
                                            ];
                                        }
                                        
                                        if (v !== null && s !== null) {
                                            return [
                                                `Шаг 1: Записываем формулу: t = s / v`,
                                                `Шаг 2: Подставляем значения: t = ${s} / ${v}`,
                                                `Шаг 3: Вычисляем: t = ${s / v} с`
                                            ];
                                        }
                                        
                                        if (t !== null && s !== null) {
                                            return [
                                                `Шаг 1: Записываем формулу: v = s / t`,
                                                `Шаг 2: Подставляем значения: v = ${s} / ${t}`,
                                                `Шаг 3: Вычисляем: v = ${s / t} м/с`
                                            ];
                                        }
                                        
                                        return ["Введите две известные величины"];
                                    }
                                }
                            },
                            {
                                name: "Равноускоренное движение",
                                formula: "s = v<sub>0</sub>t + at<sup>2</sup>/2",
                                explanation: "При равноускоренном движении пройденный путь равен сумме произведения начальной скорости на время и половины произведения ускорения на квадрат времени.",
                                calculator: {
                                    inputs: [
                                        { label: "v₀ (начальная скорость, м/с)", value: "" },
                                        { label: "a (ускорение, м/с²)", value: "" },
                                        { label: "t (время, с)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const v0 = parseFloat(inputs['v₀ (начальная скорость, м/с)']);
                                        const a = parseFloat(inputs['a (ускорение, м/с²)']);
                                        const t = parseFloat(inputs['t (время, с)']);
                                        
                                        if (isNaN(v0) || isNaN(a) || isNaN(t)) return "Введите значения";
                                        
                                        return v0 * t + a * t * t / 2;
                                    },
                                    steps: function(inputs) {
                                        const v0 = parseFloat(inputs['v₀ (начальная скорость, м/с)']);
                                        const a = parseFloat(inputs['a (ускорение, м/с²)']);
                                        const t = parseFloat(inputs['t (время, с)']);
                                        
                                        if (isNaN(v0) || isNaN(a) || isNaN(t)) return ["Введите значения"];
                                        
                                        const s = v0 * t + a * t * t / 2;
                                        
                                        return [
                                            `Шаг 1: Записываем формулу: s = v₀t + at²/2`,
                                            `Шаг 2: Подставляем значения: s = ${v0} × ${t} + ${a} × ${t}² / 2`,
                                            `Шаг 3: Вычисляем квадрат времени: ${t}² = ${t * t}`,
                                            `Шаг 4: Вычисляем: at²/2 = ${a} × ${t * t} / 2 = ${a * t * t / 2}`,
                                            `Шаг 5: Вычисляем: v₀t = ${v0} × ${t} = ${v0 * t}`,
                                            `Шаг 6: Складываем: s = ${v0 * t} + ${a * t * t / 2} = ${s} м`,
                                            `Шаг 7: Получаем результат: s = ${s} м`
                                        ];
                                    }
                                }
                            }
                        ]
                    },
                    dynamics: {
                        title: "Динамика",
                        formulas: [
                            {
                                name: "Второй закон Ньютона",
                                formula: "F = ma",
                                explanation: "Сила, действующая на тело, равна произведению массы тела на его ускорение.",
                                calculator: {
                                    inputs: [
                                        { label: "m (масса, кг)", value: "" },
                                        { label: "a (ускорение, м/с²)", value: "" },
                                        { label: "F (сила, Н)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const m = inputs.m ? parseFloat(inputs.m) : null;
                                        const a = inputs.a ? parseFloat(inputs.a) : null;
                                        const F = inputs.F ? parseFloat(inputs.F) : null;
                                        
                                        if (m !== null && a !== null) return m * a;
                                        if (m !== null && F !== null) return F / m;
                                        if (a !== null && F !== null) return F / a;
                                        
                                        return "Введите две известные величины";
                                    },
                                    steps: function(inputs) {
                                        const m = inputs.m ? parseFloat(inputs.m) : null;
                                        const a = inputs.a ? parseFloat(inputs.a) : null;
                                        const F = inputs.F ? parseFloat(inputs.F) : null;
                                        
                                        if (m !== null && a !== null) {
                                            return [
                                                `Шаг 1: Записываем закон: F = ma`,
                                                `Шаг 2: Подставляем значения: F = ${m} × ${a}`,
                                                `Шаг 3: Вычисляем: F = ${m * a} Н`
                                            ];
                                        }
                                        
                                        if (m !== null && F !== null) {
                                            return [
                                                `Шаг 1: Записываем закон: a = F / m`,
                                                `Шаг 2: Подставляем значения: a = ${F} / ${m}`,
                                                `Шаг 3: Вычисляем: a = ${F / m} м/с²`
                                            ];
                                        }
                                        
                                        if (a !== null && F !== null) {
                                            return [
                                                `Шаг 1: Записываем закон: m = F / a`,
                                                `Шаг 2: Подставляем значения: m = ${F} / ${a}`,
                                                `Шаг 3: Вычисляем: m = ${F / a} кг`
                                            ];
                                        }
                                        
                                        return ["Введите две известные величины"];
                                    }
                                }
                            },
                            {
                                name: "Сила трения",
                                formula: "F<sub>тр</sub> = μN",
                                explanation: "Сила трения скольжения равна произведению коэффициента трения на силу нормального давления.",
                                calculator: {
                                    inputs: [
                                        { label: "μ (коэффициент трения)", value: "" },
                                        { label: "N (сила нормального давления, Н)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const μ = parseFloat(inputs['μ (коэффициент трения)']);
                                        const N = parseFloat(inputs['N (сила нормального давления, Н)']);
                                        
                                        if (isNaN(μ) || isNaN(N)) return "Введите значения";
                                        
                                        return μ * N;
                                    },
                                    steps: function(inputs) {
                                        const μ = parseFloat(inputs['μ (коэффициент трения)']);
                                        const N = parseFloat(inputs['N (сила нормального давления, Н)']);
                                        
                                        if (isNaN(μ) || isNaN(N)) return ["Введите значения"];
                                        
                                        const Fтр = μ * N;
                                        
                                        return [
                                            `Шаг 1: Записываем формулу: Fтр = μN`,
                                            `Шаг 2: Подставляем значения: Fтр = ${μ} × ${N}`,
                                            `Шаг 3: Вычисляем: Fтр = ${Fтр} Н`,
                                            `Шаг 4: Получаем результат: Fтр = ${Fтр} Н`
                                        ];
                                    }
                                }
                            }
                        ]
                    },
                    "electromagnetism": {
                        title: "Электромагнитные явления",
                        formulas: [
                            {
                                name: "Сила Ампера",
                                formula: "F = BIl sin α",
                                explanation: "Сила, с которой магнитное поле действует на проводник с током, равна произведению магнитной индукции, силы тока, длины проводника и синуса угла между проводником и вектором магнитной индукции.",
                                calculator: {
                                    inputs: [
                                        { label: "B (магнитная индукция, Тл)", value: "" },
                                        { label: "I (сила тока, А)", value: "" },
                                        { label: "l (длина проводника, м)", value: "" },
                                        { label: "α (угол, °)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const B = parseFloat(inputs['B (магнитная индукция, Тл)']);
                                        const I = parseFloat(inputs['I (сила тока, А)']);
                                        const l = parseFloat(inputs['l (длина проводника, м)']);
                                        const α_deg = parseFloat(inputs['α (угол, °)']);
                                        
                                        if (isNaN(B) || isNaN(I) || isNaN(l) || isNaN(α_deg)) return "Введите значения";
                                        
                                        const α_rad = α_deg * Math.PI / 180;
                                        return B * I * l * Math.sin(α_rad);
                                    },
                                    steps: function(inputs) {
                                        const B = parseFloat(inputs['B (магнитная индукция, Тл)']);
                                        const I = parseFloat(inputs['I (сила тока, А)']);
                                        const l = parseFloat(inputs['l (длина проводника, м)']);
                                        const α_deg = parseFloat(inputs['α (угол, °)']);
                                        
                                        if (isNaN(B) || isNaN(I) || isNaN(l) || isNaN(α_deg)) return ["Введите значения"];
                                        
                                        const α_rad = α_deg * Math.PI / 180;
                                        const F = B * I * l * Math.sin(α_rad);
                                        
                                        return [
                                            `Шаг 1: Записываем формулу: F = BIl sin α`,
                                            `Шаг 2: Подставляем значения: F = ${B} × ${I} × ${l} × sin(${α_deg}°)`,
                                            `Шаг 3: Переводим угол в радианы: α = ${α_deg}° = ${α_rad.toFixed(4)} рад`,
                                            `Шаг 4: Вычисляем sin α = sin(${α_deg}°) = ${Math.sin(α_rad).toFixed(4)}`,
                                            `Шаг 5: Вычисляем: F = ${B} × ${I} × ${l} × ${Math.sin(α_rad).toFixed(4)} = ${F} Н`,
                                            `Шаг 6: Получаем результат: F = ${F} Н`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Сила Лоренца",
                                formula: "F = qvB sin α",
                                explanation: "Сила, действующая на движущийся заряд в магнитном поле, равна произведению заряда, скорости, магнитной индукции и синуса угла между скоростью и вектором магнитной индукции.",
                                calculator: {
                                    inputs: [
                                        { label: "q (заряд, Кл)", value: "" },
                                        { label: "v (скорость, м/с)", value: "" },
                                        { label: "B (магнитная индукция, Тл)", value: "" },
                                        { label: "α (угол, °)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const q = parseFloat(inputs['q (заряд, Кл)']);
                                        const v = parseFloat(inputs['v (скорость, м/с)']);
                                        const B = parseFloat(inputs['B (магнитная индукция, Тл)']);
                                        const α_deg = parseFloat(inputs['α (угол, °)']);
                                        
                                        if (isNaN(q) || isNaN(v) || isNaN(B) || isNaN(α_deg)) return "Введите значения";
                                        
                                        const α_rad = α_deg * Math.PI / 180;
                                        return q * v * B * Math.sin(α_rad);
                                    },
                                    steps: function(inputs) {
                                        const q = parseFloat(inputs['q (заряд, Кл)']);
                                        const v = parseFloat(inputs['v (скорость, м/с)']);
                                        const B = parseFloat(inputs['B (магнитная индукция, Тл)']);
                                        const α_deg = parseFloat(inputs['α (угол, °)']);
                                        
                                        if (isNaN(q) || isNaN(v) || isNaN(B) || isNaN(α_deg)) return ["Введите значения"];
                                        
                                        const α_rad = α_deg * Math.PI / 180;
                                        const F = q * v * B * Math.sin(α_rad);
                                        
                                        return [
                                            `Шаг 1: Записываем формулу: F = qvB sin α`,
                                            `Шаг 2: Подставляем значения: F = ${q} × ${v} × ${B} × sin(${α_deg}°)`,
                                            `Шаг 3: Переводим угол в радианы: α = ${α_deg}° = ${α_rad.toFixed(4)} рад`,
                                            `Шаг 4: Вычисляем sin α = sin(${α_deg}°) = ${Math.sin(α_rad).toFixed(4)}`,
                                            `Шаг 5: Вычисляем: F = ${q} × ${v} × ${B} × ${Math.sin(α_rad).toFixed(4)} = ${F} Н`,
                                            `Шаг 6: Получаем результат: F = ${F} Н`
                                        ];
                                    }
                                }
                            }
                        ]
                    }
                },
                10: {
                    mechanics: {
                        title: "Механика",
                        formulas: [
                            {
                                name: "Закон всемирного тяготения",
                                formula: "F = G·(m<sub>1</sub>m<sub>2</sub>)/r<sup>2</sup>",
                                explanation: "Сила гравитационного притяжения между двумя телами прямо пропорциональна произведению их масс и обратно пропорциональна квадрату расстояния между ними.",
                                calculator: {
                                    inputs: [
                                        { label: "m₁ (масса первого тела, кг)", value: "" },
                                        { label: "m₂ (масса второго тела, кг)", value: "" },
                                        { label: "r (расстояние между центрами, м)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const G = 6.67430e-11; // Гравитационная постоянная
                                        const m1 = parseFloat(inputs['m₁ (масса первого тела, кг)']);
                                        const m2 = parseFloat(inputs['m₂ (масса второго тела, кг)']);
                                        const r = parseFloat(inputs['r (расстояние между центрами, м)']);
                                        
                                        if (isNaN(m1) || isNaN(m2) || isNaN(r)) return "Введите значения";
                                        
                                        return G * m1 * m2 / (r * r);
                                    },
                                    steps: function(inputs) {
                                        const G = 6.67430e-11; // Гравитационная постоянная
                                        const m1 = parseFloat(inputs['m₁ (масса первого тела, кг)']);
                                        const m2 = parseFloat(inputs['m₂ (масса второго тела, кг)']);
                                        const r = parseFloat(inputs['r (расстояние между центрами, м)']);
                                        
                                        if (isNaN(m1) || isNaN(m2) || isNaN(r)) return ["Введите значения"];
                                        
                                        const F = G * m1 * m2 / (r * r);
                                        
                                        return [
                                            `Шаг 1: Записываем закон: F = G·(m₁m₂)/r²`,
                                            `Шаг 2: Подставляем значения: F = 6.67430×10⁻¹¹ × (${m1} × ${m2}) / ${r}²`,
                                            `Шаг 3: Вычисляем произведение масс: m₁m₂ = ${m1} × ${m2} = ${m1 * m2}`,
                                            `Шаг 4: Вычисляем квадрат расстояния: r² = ${r} × ${r} = ${r * r}`,
                                            `Шаг 5: Вычисляем: F = 6.67430×10⁻¹¹ × ${m1 * m2} / ${r * r} = ${F} Н`,
                                            `Шаг 6: Получаем результат: F = ${F} Н`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Импульс тела",
                                formula: "p = mv",
                                explanation: "Импульс тела равен произведению массы тела на его скорость.",
                                calculator: {
                                    inputs: [
                                        { label: "m (масса, кг)", value: "" },
                                        { label: "v (скорость, м/с)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const m = parseFloat(inputs['m (масса, кг)']);
                                        const v = parseFloat(inputs['v (скорость, м/с)']);
                                        
                                        if (isNaN(m) || isNaN(v)) return "Введите значения";
                                        
                                        return m * v;
                                    },
                                    steps: function(inputs) {
                                        const m = parseFloat(inputs['m (масса, кг)']);
                                        const v = parseFloat(inputs['v (скорость, м/с)']);
                                        
                                        if (isNaN(m) || isNaN(v)) return ["Введите значения"];
                                        
                                        const p = m * v;
                                        
                                        return [
                                            `Шаг 1: Записываем формулу: p = mv`,
                                            `Шаг 2: Подставляем значения: p = ${m} × ${v}`,
                                            `Шаг 3: Вычисляем: p = ${p} кг·м/с`,
                                            `Шаг 4: Получаем результат: p = ${p} кг·м/с`
                                        ];
                                    }
                                }
                            }
                        ]
                    },
                    molecular: {
                        title: "Молекулярная физика",
                        formulas: [
                            {
                                name: "Уравнение состояния идеального газа",
                                formula: "pV = νRT",
                                explanation: "Уравнение состояния идеального газа связывает давление, объем, количество вещества и температуру газа.",
                                calculator: {
                                    inputs: [
                                        { label: "p (давление, Па)", value: "" },
                                        { label: "V (объем, м³)", value: "" },
                                        { label: "ν (количество вещества, моль)", value: "" },
                                        { label: "T (температура, К)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const R = 8.31; // Универсальная газовая постоянная
                                        const p = inputs.p ? parseFloat(inputs.p) : null;
                                        const V = inputs.V ? parseFloat(inputs.V) : null;
                                        const ν = inputs.ν ? parseFloat(inputs.ν) : null;
                                        const T = inputs.T ? parseFloat(inputs.T) : null;
                                        
                                        if (p !== null && V !== null && ν !== null) return (p * V) / (ν * R);
                                        if (p !== null && V !== null && T !== null) return (p * V) / (R * T);
                                        if (p !== null && ν !== null && T !== null) return (ν * R * T) / p;
                                        if (V !== null && ν !== null && T !== null) return (ν * R * T) / V;
                                        
                                        return "Введите три известные величины";
                                    },
                                    steps: function(inputs) {
                                        const R = 8.31; // Универсальная газовая постоянная
                                        const p = inputs.p ? parseFloat(inputs.p) : null;
                                        const V = inputs.V ? parseFloat(inputs.V) : null;
                                        const ν = inputs.ν ? parseFloat(inputs.ν) : null;
                                        const T = inputs.T ? parseFloat(inputs.T) : null;
                                        
                                        if (p !== null && V !== null && ν !== null) {
                                            const T_result = (p * V) / (ν * R);
                                            return [
                                                `Шаг 1: Записываем уравнение: pV = νRT`,
                                                `Шаг 2: Выражаем T: T = pV / (νR)`,
                                                `Шаг 3: Подставляем значения: T = ${p} × ${V} / (${ν} × 8.31)`,
                                                `Шаг 4: Вычисляем: T = ${p * V} / ${ν * R} = ${T_result} К`,
                                                `Шаг 5: Получаем результат: T = ${T_result} К`
                                            ];
                                        }
                                        
                                        if (p !== null && V !== null && T !== null) {
                                            const ν_result = (p * V) / (R * T);
                                            return [
                                                `Шаг 1: Записываем уравнение: pV = νRT`,
                                                `Шаг 2: Выражаем ν: ν = pV / (RT)`,
                                                `Шаг 3: Подставляем значения: ν = ${p} × ${V} / (8.31 × ${T})`,
                                                `Шаг 4: Вычисляем: ν = ${p * V} / ${R * T} = ${ν_result} моль`,
                                                `Шаг 5: Получаем результат: ν = ${ν_result} моль`
                                            ];
                                        }
                                        
                                        if (p !== null && ν !== null && T !== null) {
                                            const V_result = (ν * R * T) / p;
                                            return [
                                                `Шаг 1: Записываем уравнение: pV = νRT`,
                                                `Шаг 2: Выражаем V: V = νRT / p`,
                                                `Шаг 3: Подставляем значения: V = ${ν} × 8.31 × ${T} / ${p}`,
                                                `Шаг 4: Вычисляем: V = ${ν * R * T} / ${p} = ${V_result} м³`,
                                                `Шаг 5: Получаем результат: V = ${V_result} м³`
                                            ];
                                        }
                                        
                                        if (V !== null && ν !== null && T !== null) {
                                            const p_result = (ν * R * T) / V;
                                            return [
                                                `Шаг 1: Записываем уравнение: pV = νRT`,
                                                `Шаг 2: Выражаем p: p = νRT / V`,
                                                `Шаг 3: Подставляем значения: p = ${ν} × 8.31 × ${T} / ${V}`,
                                                `Шаг 4: Вычисляем: p = ${ν * R * T} / ${V} = ${p_result} Па`,
                                                `Шаг 5: Получаем результат: p = ${p_result} Па`
                                            ];
                                        }
                                        
                                        return ["Введите три известные величины"];
                                    }
                                }
                            },
                            {
                                name: "Основное уравнение МКТ",
                                formula: "p = (1/3)nm<sub>0</sub>v<sup>2</sup>",
                                explanation: "Давление идеального газа определяется концентрацией молекул, их массой и средней квадратичной скоростью.",
                                calculator: {
                                    inputs: [
                                        { label: "n (концентрация молекул, 1/м³)", value: "" },
                                        { label: "m₀ (масса молекулы, кг)", value: "" },
                                        { label: "v (средняя квадратичная скорость, м/с)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const n = parseFloat(inputs['n (концентрация молекул, 1/м³)']);
                                        const m0 = parseFloat(inputs['m₀ (масса молекулы, кг)']);
                                        const v = parseFloat(inputs['v (средняя квадратичная скорость, м/с)']);
                                        
                                        if (isNaN(n) || isNaN(m0) || isNaN(v)) return "Введите значения";
                                        
                                        return (1/3) * n * m0 * v * v;
                                    },
                                    steps: function(inputs) {
                                        const n = parseFloat(inputs['n (концентрация молекул, 1/м³)']);
                                        const m0 = parseFloat(inputs['m₀ (масса молекулы, кг)']);
                                        const v = parseFloat(inputs['v (средняя квадратичная скорость, м/с)']);
                                        
                                        if (isNaN(n) || isNaN(m0) || isNaN(v)) return ["Введите значения"];
                                        
                                        const p = (1/3) * n * m0 * v * v;
                                        
                                        return [
                                            `Шаг 1: Записываем уравнение: p = (1/3)nm₀v²`,
                                            `Шаг 2: Подставляем значения: p = (1/3) × ${n} × ${m0} × ${v}²`,
                                            `Шаг 3: Вычисляем квадрат скорости: v² = ${v} × ${v} = ${v * v}`,
                                            `Шаг 4: Вычисляем: p = (1/3) × ${n} × ${m0} × ${v * v} = ${p} Па`,
                                            `Шаг 5: Получаем результат: p = ${p} Па`
                                        ];
                                    }
                                }
                            }
                        ]
                    },
                    electricity: {
                        title: "Электричество",
                        formulas: [
                            {
                                name: "Работа электрического тока",
                                formula: "A = UIt",
                                explanation: "Работа электрического тока на участке цепи равна произведению напряжения, силы тока и времени.",
                                calculator: {
                                    inputs: [
                                        { label: "U (напряжение, В)", value: "" },
                                        { label: "I (сила тока, А)", value: "" },
                                        { label: "t (время, с)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const U = parseFloat(inputs['U (напряжение, В)']);
                                        const I = parseFloat(inputs['I (сила тока, А)']);
                                        const t = parseFloat(inputs['t (время, с)']);
                                        
                                        if (isNaN(U) || isNaN(I) || isNaN(t)) return "Введите значения";
                                        
                                        return U * I * t;
                                    },
                                    steps: function(inputs) {
                                        const U = parseFloat(inputs['U (напряжение, В)']);
                                        const I = parseFloat(inputs['I (сила тока, А)']);
                                        const t = parseFloat(inputs['t (время, с)']);
                                        
                                        if (isNaN(U) || isNaN(I) || isNaN(t)) return ["Введите значения"];
                                        
                                        const A = U * I * t;
                                        
                                        return [
                                            `Шаг 1: Записываем формулу: A = UIt`,
                                            `Шаг 2: Подставляем значения: A = ${U} × ${I} × ${t}`,
                                            `Шаг 3: Вычисляем: A = ${A} Дж`,
                                            `Шаг 4: Получаем результат: A = ${A} Дж`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Мощность электрического тока",
                                formula: "P = UI",
                                explanation: "Мощность электрического тока на участке цепи равна произведению напряжения и силы тока.",
                                calculator: {
                                    inputs: [
                                        { label: "U (напряжение, В)", value: "" },
                                        { label: "I (сила тока, А)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const U = parseFloat(inputs['U (напряжение, В)']);
                                        const I = parseFloat(inputs['I (сила тока, А)']);
                                        
                                        if (isNaN(U) || isNaN(I)) return "Введите значения";
                                        
                                        return U * I;
                                    },
                                    steps: function(inputs) {
                                        const U = parseFloat(inputs['U (напряжение, В)']);
                                        const I = parseFloat(inputs['I (сила тока, А)']);
                                        
                                        if (isNaN(U) || isNaN(I)) return ["Введите значения"];
                                        
                                        const P = U * I;
                                        
                                        return [
                                            `Шаг 1: Записываем формулу: P = UI`,
                                            `Шаг 2: Подставляем значения: P = ${U} × ${I}`,
                                            `Шаг 3: Вычисляем: P = ${P} Вт`,
                                            `Шаг 4: Получаем результат: P = ${P} Вт`
                                        ];
                                    }
                                }
                            }
                        ]
                    }
                },
                11: {
                    electrodynamics: {
                        title: "Электродинамика",
                        formulas: [
                            {
                                name: "ЭДС индукции",
                                formula: "ε = -ΔΦ/Δt",
                                explanation: "ЭДС индукции в замкнутом контуре равна скорости изменения магнитного потока через поверхность, ограниченную контуром.",
                                calculator: {
                                    inputs: [
                                        { label: "ΔΦ (изменение магнитного потока, Вб)", value: "" },
                                        { label: "Δt (время изменения, с)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const ΔΦ = parseFloat(inputs['ΔΦ (изменение магнитного потока, Вб)']);
                                        const Δt = parseFloat(inputs['Δt (время изменения, с)']);
                                        
                                        if (isNaN(ΔΦ) || isNaN(Δt)) return "Введите значения";
                                        
                                        return -ΔΦ / Δt;
                                    },
                                    steps: function(inputs) {
                                        const ΔΦ = parseFloat(inputs['ΔΦ (изменение магнитного потока, Вб)']);
                                        const Δt = parseFloat(inputs['Δt (время изменения, с)']);
                                        
                                        if (isNaN(ΔΦ) || isNaN(Δt)) return ["Введите значения"];
                                        
                                        const ε = -ΔΦ / Δt;
                                        
                                        return [
                                            `Шаг 1: Записываем формулу: ε = -ΔΦ/Δt`,
                                            `Шаг 2: Подставляем значения: ε = -${ΔΦ} / ${Δt}`,
                                            `Шаг 3: Вычисляем: ε = ${ε} В`,
                                            `Шаг 4: Получаем результат: ε = ${ε} В`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Ёмкость конденсатора",
                                formula: "C = q / U",
                                explanation: "Ёмкость конденсатора равна отношению заряда на одной из обкладок к напряжению между обкладками.",
                                calculator: {
                                    inputs: [
                                        { label: "q (заряд, Кл)", value: "" },
                                        { label: "U (напряжение, В)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const q = parseFloat(inputs['q (заряд, Кл)']);
                                        const U = parseFloat(inputs['U (напряжение, В)']);
                                        
                                        if (isNaN(q) || isNaN(U)) return "Введите значения";
                                        
                                        return q / U;
                                    },
                                    steps: function(inputs) {
                                        const q = parseFloat(inputs['q (заряд, Кл)']);
                                        const U = parseFloat(inputs['U (напряжение, В)']);
                                        
                                        if (isNaN(q) || isNaN(U)) return ["Введите значения"];
                                        
                                        const C = q / U;
                                        
                                        return [
                                            `Шаг 1: Записываем формулу: C = q / U`,
                                            `Шаг 2: Подставляем значения: C = ${q} / ${U}`,
                                            `Шаг 3: Вычисляем: C = ${C} Ф`,
                                            `Шаг 4: Получаем результат: C = ${C} Ф`
                                        ];
                                    }
                                }
                            }
                        ]
                    },
                    quantum: {
                        title: "Квантовая физика",
                        formulas: [
                            {
                                name: "Энергия кванта",
                                formula: "E = hν",
                                explanation: "Энергия кванта электромагнитного излучения равна произведению постоянной Планка на частоту излучения.",
                                calculator: {
                                    inputs: [
                                        { label: "ν (частота, Гц)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const h = 6.626e-34; // Постоянная Планка
                                        const ν = parseFloat(inputs['ν (частота, Гц)']);
                                        
                                        if (isNaN(ν)) return "Введите значение";
                                        
                                        return h * ν;
                                    },
                                    steps: function(inputs) {
                                        const h = 6.626e-34; // Постоянная Планка
                                        const ν = parseFloat(inputs['ν (частота, Гц)']);
                                        
                                        if (isNaN(ν)) return ["Введите значение"];
                                        
                                        const E = h * ν;
                                        
                                        return [
                                            `Шаг 1: Записываем формулу: E = hν`,
                                            `Шаг 2: Подставляем значения: E = 6.626×10⁻³⁴ × ${ν}`,
                                            `Шаг 3: Вычисляем: E = ${E} Дж`,
                                            `Шаг 4: Получаем результат: E = ${E} Дж`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Фотоэффект",
                                formula: "hν = A + (mv<sup>2</sup>)/2",
                                explanation: "Энергия кванта света расходуется на работу выхода и кинетическую энергию фотоэлектрона.",
                                calculator: {
                                    inputs: [
                                        { label: "ν (частота, Гц)", value: "" },
                                        { label: "A (работа выхода, Дж)", value: "" },
                                        { label: "m (масса электрона, кг)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const h = 6.626e-34; // Постоянная Планка
                                        const ν = parseFloat(inputs['ν (частота, Гц)']);
                                        const A = parseFloat(inputs['A (работа выхода, Дж)']);
                                        const m = parseFloat(inputs['m (масса электрона, кг)']);
                                        
                                        if (isNaN(ν) || isNaN(A) || isNaN(m)) return "Введите значения";
                                        
                                        const Ek = h * ν - A;
                                        return Math.sqrt(2 * Ek / m);
                                    },
                                    steps: function(inputs) {
                                        const h = 6.626e-34; // Постоянная Планка
                                        const ν = parseFloat(inputs['ν (частота, Гц)']);
                                        const A = parseFloat(inputs['A (работа выхода, Дж)']);
                                        const m = parseFloat(inputs['m (масса электрона, кг)']);
                                        
                                        if (isNaN(ν) || isNaN(A) || isNaN(m)) return ["Введите значения"];
                                        
                                        const Ek = h * ν - A;
                                        const v = Math.sqrt(2 * Ek / m);
                                        
                                        return [
                                            `Шаг 1: Записываем уравнение: hν = A + (mv²)/2`,
                                            `Шаг 2: Выражаем кинетическую энергию: Ek = hν - A`,
                                            `Шаг 3: Подставляем значения: Ek = 6.626×10⁻³⁴ × ${ν} - ${A}`,
                                            `Шаг 4: Вычисляем: Ek = ${Ek} Дж`,
                                            `Шаг 5: Выражаем скорость: v = √(2Ek/m)`,
                                            `Шаг 6: Подставляем значения: v = √(2 × ${Ek} / ${m})`,
                                            `Шаг 7: Вычисляем: v = ${v} м/с`,
                                            `Шаг 8: Получаем результат: v = ${v} м/с`
                                        ];
                                    }
                                }
                            }
                        ]
                    },
                    nuclear: {
                        title: "Ядерная физика",
                        formulas: [
                            {
                                name: "Энергия связи",
                                formula: "E = Δmc<sup>2</sup>",
                                explanation: "Энергия связи ядра равна произведению дефекта массы на квадрат скорости света.",
                                calculator: {
                                    inputs: [
                                        { label: "Δm (дефект массы, кг)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const c = 3e8; // Скорость света
                                        const Δm = parseFloat(inputs['Δm (дефект массы, кг)']);
                                        
                                        if (isNaN(Δm)) return "Введите значение";
                                        
                                        return Δm * c * c;
                                    },
                                    steps: function(inputs) {
                                        const c = 3e8; // Скорость света
                                        const Δm = parseFloat(inputs['Δm (дефект массы, кг)']);
                                        
                                        if (isNaN(Δm)) return ["Введите значение"];
                                        
                                        const E = Δm * c * c;
                                        
                                        return [
                                            `Шаг 1: Записываем формулу: E = Δmc²`,
                                            `Шаг 2: Подставляем значения: E = ${Δm} × (3×10⁸)²`,
                                            `Шаг 3: Вычисляем квадрат скорости света: c² = (3×10⁸)² = 9×10¹⁶`,
                                            `Шаг 4: Вычисляем: E = ${Δm} × 9×10¹⁶ = ${E} Дж`,
                                            `Шаг 5: Получаем результат: E = ${E} Дж`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Период полураспада",
                                formula: "N = N<sub>0</sub>·(1/2)<sup>t/T</sup>",
                                explanation: "Количество оставшихся радиоактивных ядер определяется начальным количеством и периодом полураспада.",
                                calculator: {
                                    inputs: [
                                        { label: "N₀ (начальное количество ядер)", value: "" },
                                        { label: "t (время, с)", value: "" },
                                        { label: "T (период полураспада, с)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const N0 = parseFloat(inputs['N₀ (начальное количество ядер)']);
                                        const t = parseFloat(inputs['t (время, с)']);
                                        const T = parseFloat(inputs['T (период полураспада, с)']);
                                        
                                        if (isNaN(N0) || isNaN(t) || isNaN(T)) return "Введите значения";
                                        
                                        return N0 * Math.pow(0.5, t / T);
                                    },
                                    steps: function(inputs) {
                                        const N0 = parseFloat(inputs['N₀ (начальное количество ядер)']);
                                        const t = parseFloat(inputs['t (время, с)']);
                                        const T = parseFloat(inputs['T (период полураспада, с)']);
                                        
                                        if (isNaN(N0) || isNaN(t) || isNaN(T)) return ["Введите значения"];
                                        
                                        const N = N0 * Math.pow(0.5, t / T);
                                        
                                        return [
                                            `Шаг 1: Записываем формулу: N = N₀·(1/2)^(t/T)`,
                                            `Шаг 2: Подставляем значения: N = ${N0} × (1/2)^(${t}/${T})`,
                                            `Шаг 3: Вычисляем показатель степени: t/T = ${t} / ${T} = ${t / T}`,
                                            `Шаг 4: Вычисляем: (1/2)^(${t / T}) = ${Math.pow(0.5, t / T)}`,
                                            `Шаг 5: Вычисляем: N = ${N0} × ${Math.pow(0.5, t / T)} = ${N} ядер`,
                                            `Шаг 6: Получаем результат: N = ${N} ядер`
                                        ];
                                    }
                                }
                            }
                        ]
                    }
                }
            },
            chemistry: {
                8: {
                    basics: {
                        title: "Основы химии",
                        formulas: [
                            {
                                name: "Количество вещества",
                                formula: "ν = m / M",
                                explanation: "Количество вещества равно массе вещества, деленной на его молярную массу.",
                                calculator: {
                                    inputs: [
                                        { label: "m (масса вещества, г)", value: "" },
                                        { label: "M (молярная масса, г/моль)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const m = parseFloat(inputs['m (масса вещества, г)']);
                                        const M = parseFloat(inputs['M (молярная масса, г/моль)']);
                                        
                                        if (isNaN(m) || isNaN(M)) return "Введите значения";
                                        
                                        return m / M;
                                    },
                                    steps: function(inputs) {
                                        const m = parseFloat(inputs['m (масса вещества, г)']);
                                        const M = parseFloat(inputs['M (молярная масса, г/моль)']);
                                        
                                        if (isNaN(m) || isNaN(M)) return ["Введите значения"];
                                        
                                        const ν = m / M;
                                        
                                        return [
                                            `Шаг 1: Записываем формулу: ν = m / M`,
                                            `Шаг 2: Подставляем значения: ν = ${m} / ${M}`,
                                            `Шаг 3: Вычисляем: ν = ${ν} моль`,
                                            `Шаг 4: Получаем результат: ν = ${ν} моль`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Массовая доля элемента",
                                formula: "ω = (n·Ar) / Mr",
                                explanation: "Массовая доля элемента в веществе равна отношению произведения числа атомов элемента на его относительную атомную массу к молекулярной массе вещества.",
                                calculator: {
                                    inputs: [
                                        { label: "n (число атомов элемента)", value: "" },
                                        { label: "Ar (относительная атомная масса)", value: "" },
                                        { label: "Mr (молекулярная масса вещества)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const n = parseFloat(inputs['n (число атомов элемента)']);
                                        const Ar = parseFloat(inputs['Ar (относительная атомная масса)']);
                                        const Mr = parseFloat(inputs['Mr (молекулярная масса вещества)']);
                                        
                                        if (isNaN(n) || isNaN(Ar) || isNaN(Mr)) return "Введите значения";
                                        
                                        return (n * Ar) / Mr;
                                    },
                                    steps: function(inputs) {
                                        const n = parseFloat(inputs['n (число атомов элемента)']);
                                        const Ar = parseFloat(inputs['Ar (относительная атомная масса)']);
                                        const Mr = parseFloat(inputs['Mr (молекулярная масса вещества)']);
                                        
                                        if (isNaN(n) || isNaN(Ar) || isNaN(Mr)) return ["Введите значения"];
                                        
                                        const ω = (n * Ar) / Mr;
                                        
                                        return [
                                            `Шаг 1: Записываем формулу: ω = (n·Ar) / Mr`,
                                            `Шаг 2: Подставляем значения: ω = (${n} × ${Ar}) / ${Mr}`,
                                            `Шаг 3: Вычисляем числитель: ${n} × ${Ar} = ${n * Ar}`,
                                            `Шаг 4: Вычисляем: ω = ${n * Ar} / ${Mr} = ${ω}`,
                                            `Шаг 5: Получаем результат: ω = ${ω}`
                                        ];
                                    }
                                }
                            }
                        ]
                    },
                    "periodic-table": {
                        title: "Периодическая таблица",
                        formulas: [
                            {
                                name: "Относительная атомная масса",
                                formula: "Ar = m<sub>атома</sub> / (1/12)m<sub>C-12</sub>",
                                explanation: "Относительная атомная масса элемента - это отношение массы атома элемента к 1/12 массы атома углерода-12.",
                                calculator: {
                                    inputs: [
                                        { label: "m<sub>атома</sub> (масса атома, кг)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const m_atom = parseFloat(inputs['m<sub>атома</sub> (масса атома, кг)']);
                                        const m_C12 = 1.9927e-26; // Масса атома углерода-12
                                        
                                        if (isNaN(m_atom)) return "Введите значение";
                                        
                                        return m_atom / (m_C12 / 12);
                                    },
                                    steps: function(inputs) {
                                        const m_atom = parseFloat(inputs['m<sub>атома</sub> (масса атома, кг)']);
                                        const m_C12 = 1.9927e-26; // Масса атома углерода-12
                                        
                                        if (isNaN(m_atom)) return ["Введите значение"];
                                        
                                        const Ar = m_atom / (m_C12 / 12);
                                        
                                        return [
                                            `Шаг 1: Записываем формулу: Ar = m_атома / (1/12)m_C-12`,
                                            `Шаг 2: Подставляем значения: Ar = ${m_atom} / (1/12 × 1.9927×10⁻²⁶)`,
                                            `Шаг 3: Вычисляем знаменатель: (1/12) × 1.9927×10⁻²⁶ = ${m_C12 / 12}`,
                                            `Шаг 4: Вычисляем: Ar = ${m_atom} / ${m_C12 / 12} = ${Ar}`,
                                            `Шаг 5: Получаем результат: Ar = ${Ar}`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Электронная конфигурация",
                                formula: "1s² 2s² 2p⁶ 3s² 3p⁶...",
                                explanation: "Электронная конфигурация показывает распределение электронов по энергетическим уровням и подуровням.",
                                calculator: {
                                    inputs: [
                                        { label: "Z (атомный номер)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const Z = parseInt(inputs['Z (атомный номер)']);
                                        let config = "";
                                        let remaining = Z;
                                        const levels = [
                                            {name: "1s", max: 2},
                                            {name: "2s", max: 2},
                                            {name: "2p", max: 6},
                                            {name: "3s", max: 2},
                                            {name: "3p", max: 6},
                                            {name: "4s", max: 2},
                                            {name: "3d", max: 10},
                                            {name: "4p", max: 6},
                                            {name: "5s", max: 2},
                                            {name: "4d", max: 10},
                                            {name: "5p", max: 6},
                                            {name: "6s", max: 2},
                                            {name: "4f", max: 14},
                                            {name: "5d", max: 10},
                                            {name: "6p", max: 6},
                                            {name: "7s", max: 2},
                                            {name: "5f", max: 14},
                                            {name: "6d", max: 10},
                                            {name: "7p", max: 6}
                                        ];
                                        
                                        for (const level of levels) {
                                            if (remaining <= 0) break;
                                            const electrons = Math.min(remaining, level.max);
                                            if (electrons > 0) {
                                                config += ` ${level.name}^${electrons}`;
                                            }
                                            remaining -= electrons;
                                        }
                                        
                                        return config.trim();
                                    },
                                    steps: function(inputs) {
                                        const Z = parseInt(inputs['Z (атомный номер)']);
                                        let config = "";
                                        let remaining = Z;
                                        const levels = [
                                            {name: "1s", max: 2},
                                            {name: "2s", max: 2},
                                            {name: "2p", max: 6},
                                            {name: "3s", max: 2},
                                            {name: "3p", max: 6},
                                            {name: "4s", max: 2},
                                            {name: "3d", max: 10},
                                            {name: "4p", max: 6},
                                            {name: "5s", max: 2},
                                            {name: "4d", max: 10},
                                            {name: "5p", max: 6},
                                            {name: "6s", max: 2},
                                            {name: "4f", max: 14},
                                            {name: "5d", max: 10},
                                            {name: "6p", max: 6},
                                            {name: "7s", max: 2},
                                            {name: "5f", max: 14},
                                            {name: "6d", max: 10},
                                            {name: "7p", max: 6}
                                        ];
                                        
                                        const steps = [
                                            `Шаг 1: Записываем атомный номер: Z = ${Z}`,
                                            `Шаг 2: Распределяем электроны по энергетическим уровням:`
                                        ];
                                        
                                        for (const level of levels) {
                                            if (remaining <= 0) break;
                                            const electrons = Math.min(remaining, level.max);
                                            if (electrons > 0) {
                                                config += ` ${level.name}^${electrons}`;
                                                steps.push(`  - Уровень ${level.name}: ${electrons} электрона(ов)`);
                                            }
                                            remaining -= electrons;
                                        }
                                        
                                        steps.push(`Шаг 3: Получаем электронную конфигурацию: ${config.trim()}`);
                                        
                                        return steps;
                                    }
                                }
                            }
                        ]
                    },
                    "chemical-reactions": {
                        title: "Химические реакции",
                        formulas: [
                            {
                                name: "Закон сохранения массы",
                                formula: "m<sub>реагентов</sub> = m<sub>продуктов</sub>",
                                explanation: "Масса веществ, вступивших в реакцию, равна массе веществ, образовавшихся в результате реакции.",
                                calculator: {
                                    inputs: [
                                        { label: "m₁ (масса первого реагента, г)", value: "" },
                                        { label: "m₂ (масса второго реагента, г)", value: "" },
                                        { label: "m<sub>прод</sub> (масса продуктов, г)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const m1 = inputs['m₁ (масса первого реагента, г)'] ? parseFloat(inputs['m₁ (масса первого реагента, г)']) : null;
                                        const m2 = inputs['m₂ (масса второго реагента, г)'] ? parseFloat(inputs['m₂ (масса второго реагента, г)']) : null;
                                        const m_prod = inputs['m<sub>прод</sub> (масса продуктов, г)'] ? parseFloat(inputs['m<sub>прод</sub> (масса продуктов, г)']) : null;
                                        
                                        if (m1 !== null && m2 !== null) return m1 + m2;
                                        if (m1 !== null && m_prod !== null) return m_prod - m1;
                                        if (m2 !== null && m_prod !== null) return m_prod - m2;
                                        
                                        return "Введите две известные величины";
                                    },
                                    steps: function(inputs) {
                                        const m1 = inputs['m₁ (масса первого реагента, г)'] ? parseFloat(inputs['m₁ (масса первого реагента, г)']) : null;
                                        const m2 = inputs['m₂ (масса второго реагента, г)'] ? parseFloat(inputs['m₂ (масса второго реагента, г)']) : null;
                                        const m_prod = inputs['m<sub>прод</sub> (масса продуктов, г)'] ? parseFloat(inputs['m<sub>прод</sub> (масса продуктов, г)']) : null;
                                        
                                        if (m1 !== null && m2 !== null) {
                                            return [
                                                `Шаг 1: Записываем закон: m_реагентов = m_продуктов`,
                                                `Шаг 2: Подставляем значения: m_продуктов = ${m1} + ${m2}`,
                                                `Шаг 3: Вычисляем: m_продуктов = ${m1 + m2} г`,
                                                `Шаг 4: Получаем результат: m_продуктов = ${m1 + m2} г`
                                            ];
                                        }
                                        
                                        if (m1 !== null && m_prod !== null) {
                                            return [
                                                `Шаг 1: Записываем закон: m_реагентов = m_продуктов`,
                                                `Шаг 2: Подставляем значения: m2 = ${m_prod} - ${m1}`,
                                                `Шаг 3: Вычисляем: m2 = ${m_prod - m1} г`,
                                                `Шаг 4: Получаем результат: m2 = ${m_prod - m1} г`
                                            ];
                                        }
                                        
                                        if (m2 !== null && m_prod !== null) {
                                            return [
                                                `Шаг 1: Записываем закон: m_реагентов = m_продуктов`,
                                                `Шаг 2: Подставляем значения: m1 = ${m_prod} - ${m2}`,
                                                `Шаг 3: Вычисляем: m1 = ${m_prod - m2} г`,
                                                `Шаг 4: Получаем результат: m1 = ${m_prod - m2} г`
                                            ];
                                        }
                                        
                                        return ["Введите две известные величины"];
                                    }
                                }
                            },
                            {
                                name: "Термохимическое уравнение",
                                formula: "Q = n·ΔH",
                                explanation: "Количество теплоты, выделяющееся или поглощающееся в ходе реакции, равно произведению количества вещества на тепловой эффект реакции.",
                                calculator: {
                                    inputs: [
                                        { label: "n (количество вещества, моль)", value: "" },
                                        { label: "ΔH (тепловой эффект, кДж/моль)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const n = parseFloat(inputs['n (количество вещества, моль)']);
                                        const ΔH = parseFloat(inputs['ΔH (тепловой эффект, кДж/моль)']);
                                        
                                        if (isNaN(n) || isNaN(ΔH)) return "Введите значения";
                                        
                                        return n * ΔH;
                                    },
                                    steps: function(inputs) {
                                        const n = parseFloat(inputs['n (количество вещества, моль)']);
                                        const ΔH = parseFloat(inputs['ΔH (тепловой эффект, кДж/моль)']);
                                        
                                        if (isNaN(n) || isNaN(ΔH)) return ["Введите значения"];
                                        
                                        const Q = n * ΔH;
                                        
                                        return [
                                            `Шаг 1: Записываем формулу: Q = n·ΔH`,
                                            `Шаг 2: Подставляем значения: Q = ${n} × ${ΔH}`,
                                            `Шаг 3: Вычисляем: Q = ${Q} кДж`,
                                            `Шаг 4: Получаем результат: Q = ${Q} кДж`
                                        ];
                                    }
                                }
                            }
                        ]
                    }
                },
                9: {
                    inorganic: {
                        title: "Неорганическая химия",
                        formulas: [
                            {
                                name: "Растворимость",
                                formula: "S = (m<sub>вещ</sub> / m<sub>р-ля</sub>) × 100",
                                explanation: "Растворимость вещества показывает, сколько граммов вещества может раствориться в 100 г растворителя.",
                                calculator: {
                                    inputs: [
                                        { label: "m<sub>вещ</sub> (масса вещества, г)", value: "" },
                                        { label: "m<sub>р-ля</sub> (масса растворителя, г)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const m_вещ = parseFloat(inputs['m<sub>вещ</sub> (масса вещества, г)']);
                                        const m_рля = parseFloat(inputs['m<sub>р-ля</sub> (масса растворителя, г)']);
                                        
                                        if (isNaN(m_вещ) || isNaN(m_рля)) return "Введите значения";
                                        
                                        return (m_вещ / m_рля) * 100;
                                    },
                                    steps: function(inputs) {
                                        const m_вещ = parseFloat(inputs['m<sub>вещ</sub> (масса вещества, г)']);
                                        const m_рля = parseFloat(inputs['m<sub>р-ля</sub> (масса растворителя, г)']);
                                        
                                        if (isNaN(m_вещ) || isNaN(m_рля)) return ["Введите значения"];
                                        
                                        const S = (m_вещ / m_рля) * 100;
                                        
                                        return [
                                            `Шаг 1: Записываем формулу: S = (m_вещ / m_р-ля) × 100`,
                                            `Шаг 2: Подставляем значения: S = (${m_вещ} / ${m_рля}) × 100`,
                                            `Шаг 3: Вычисляем отношение: ${m_вещ} / ${m_рля} = ${m_вещ / m_рля}`,
                                            `Шаг 4: Умножаем на 100: S = ${m_вещ / m_рля} × 100 = ${S}`,
                                            `Шаг 5: Получаем результат: S = ${S} г/100г`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Степень диссоциации",
                                formula: "α = n<sub>дисс</sub> / n<sub>общ</sub>",
                                explanation: "Степень диссоциации показывает, какая часть молекул электролита распадается на ионы.",
                                calculator: {
                                    inputs: [
                                        { label: "n<sub>дисс</sub> (число диссоциированных молекул)", value: "" },
                                        { label: "n<sub>общ</sub> (общее число молекул)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const n_дисс = parseFloat(inputs['n<sub>дисс</sub> (число диссоциированных молекул)']);
                                        const n_общ = parseFloat(inputs['n<sub>общ</sub> (общее число молекул)']);
                                        
                                        if (isNaN(n_дисс) || isNaN(n_общ)) return "Введите значения";
                                        
                                        return n_дисс / n_общ;
                                    },
                                    steps: function(inputs) {
                                        const n_дисс = parseFloat(inputs['n<sub>дисс</sub> (число диссоциированных молекул)']);
                                        const n_общ = parseFloat(inputs['n<sub>общ</sub> (общее число молекул)']);
                                        
                                        if (isNaN(n_дисс) || isNaN(n_общ)) return ["Введите значения"];
                                        
                                        const α = n_дисс / n_общ;
                                        
                                        return [
                                            `Шаг 1: Записываем формулу: α = n_дисс / n_общ`,
                                            `Шаг 2: Подставляем значения: α = ${n_дисс} / ${n_общ}`,
                                            `Шаг 3: Вычисляем: α = ${α}`,
                                            `Шаг 4: Получаем результат: α = ${α}`
                                        ];
                                    }
                                }
                            }
                        ]
                    },
                    solutions: {
                        title: "Растворы",
                        formulas: [
                            {
                                name: "Массовая доля вещества в растворе",
                                formula: "ω = (m<sub>вещ</sub> / m<sub>р-ра</sub>) × 100%",
                                explanation: "Массовая доля вещества показывает, сколько процентов от массы раствора составляет масса растворенного вещества.",
                                calculator: {
                                    inputs: [
                                        { label: "m<sub>вещ</sub> (масса вещества, г)", value: "" },
                                        { label: "m<sub>р-ра</sub> (масса раствора, г)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const m_вещ = parseFloat(inputs['m<sub>вещ</sub> (масса вещества, г)']);
                                        const m_рра = parseFloat(inputs['m<sub>р-ра</sub> (масса раствора, г)']);
                                        
                                        if (isNaN(m_вещ) || isNaN(m_рра)) return "Введите значения";
                                        
                                        return (m_вещ / m_рра) * 100;
                                    },
                                    steps: function(inputs) {
                                        const m_вещ = parseFloat(inputs['m<sub>вещ</sub> (масса вещества, г)']);
                                        const m_рра = parseFloat(inputs['m<sub>р-ра</sub> (масса раствора, г)']);
                                        
                                        if (isNaN(m_вещ) || isNaN(m_рра)) return ["Введите значения"];
                                        
                                        const ω = (m_вещ / m_рра) * 100;
                                        
                                        return [
                                            `Шаг 1: Записываем формулу: ω = (m_вещ / m_р-ра) × 100%`,
                                            `Шаг 2: Подставляем значения: ω = (${m_вещ} / ${m_рра}) × 100%`,
                                            `Шаг 3: Вычисляем отношение: ${m_вещ} / ${m_рра} = ${m_вещ / m_рра}`,
                                            `Шаг 4: Умножаем на 100: ω = ${m_вещ / m_рра} × 100 = ${ω}%`,
                                            `Шаг 5: Получаем результат: ω = ${ω}%`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Молярная концентрация",
                                formula: "C = ν / V",
                                explanation: "Молярная концентрация показывает, сколько молей вещества содержится в одном литре раствора.",
                                calculator: {
                                    inputs: [
                                        { label: "ν (количество вещества, моль)", value: "" },
                                        { label: "V (объем раствора, л)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const ν = parseFloat(inputs['ν (количество вещества, моль)']);
                                        const V = parseFloat(inputs['V (объем раствора, л)']);
                                        
                                        if (isNaN(ν) || isNaN(V)) return "Введите значения";
                                        
                                        return ν / V;
                                    },
                                    steps: function(inputs) {
                                        const ν = parseFloat(inputs['ν (количество вещества, моль)']);
                                        const V = parseFloat(inputs['V (объем раствора, л)']);
                                        
                                        if (isNaN(ν) || isNaN(V)) return ["Введите значения"];
                                        
                                        const C = ν / V;
                                        
                                        return [
                                            `Шаг 1: Записываем формулу: C = ν / V`,
                                            `Шаг 2: Подставляем значения: C = ${ν} / ${V}`,
                                            `Шаг 3: Вычисляем: C = ${C} моль/л`,
                                            `Шаг 4: Получаем результат: C = ${C} моль/л`
                                        ];
                                    }
                                }
                            }
                        ]
                    },
                    electrochemistry: {
                        title: "Электрохимия",
                        formulas: [
                            {
                                name: "Закон Фарадея",
                                formula: "m = (MIt) / (nF)",
                                explanation: "Масса вещества, выделившегося на электроде, пропорциональна силе тока, времени и электрохимическому эквиваленту вещества.",
                                calculator: {
                                    inputs: [
                                        { label: "M (молярная масса, г/моль)", value: "" },
                                        { label: "I (сила тока, А)", value: "" },
                                        { label: "t (время, с)", value: "" },
                                        { label: "n (валентность)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const F = 96500; // Постоянная Фарадея
                                        const M = parseFloat(inputs['M (молярная масса, г/моль)']);
                                        const I = parseFloat(inputs['I (сила тока, А)']);
                                        const t = parseFloat(inputs['t (время, с)']);
                                        const n = parseFloat(inputs['n (валентность)']);
                                        
                                        if (isNaN(M) || isNaN(I) || isNaN(t) || isNaN(n)) return "Введите значения";
                                        
                                        return (M * I * t) / (n * F);
                                    },
                                    steps: function(inputs) {
                                        const F = 96500; // Постоянная Фарадея
                                        const M = parseFloat(inputs['M (молярная масса, г/моль)']);
                                        const I = parseFloat(inputs['I (сила тока, А)']);
                                        const t = parseFloat(inputs['t (время, с)']);
                                        const n = parseFloat(inputs['n (валентность)']);
                                        
                                        if (isNaN(M) || isNaN(I) || isNaN(t) || isNaN(n)) return ["Введите значения"];
                                        
                                        const m = (M * I * t) / (n * F);
                                        
                                        return [
                                            `Шаг 1: Записываем закон Фарадея: m = (MIt) / (nF)`,
                                            `Шаг 2: Подставляем значения: m = (${M} × ${I} × ${t}) / (${n} × 96500)`,
                                            `Шаг 3: Вычисляем числитель: ${M} × ${I} × ${t} = ${M * I * t}`,
                                            `Шаг 4: Вычисляем знаменатель: ${n} × 96500 = ${n * F}`,
                                            `Шаг 5: Вычисляем: m = ${M * I * t} / ${n * F} = ${m} г`,
                                            `Шаг 6: Получаем результат: m = ${m} г`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "ЭДС гальванического элемента",
                                formula: "E = E<sub>кат</sub> - E<sub>ан</sub>",
                                explanation: "ЭДС гальванического элемента равна разности стандартных электродных потенциалов катода и анода.",
                                calculator: {
                                    inputs: [
                                        { label: "E<sub>кат</sub> (потенциал катода, В)", value: "" },
                                        { label: "E<sub>ан</sub> (потенциал анода, В)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const Eкат = parseFloat(inputs['E<sub>кат</sub> (потенциал катода, В)']);
                                        const Eан = parseFloat(inputs['E<sub>ан</sub> (потенциал анода, В)']);
                                        
                                        if (isNaN(Eкат) || isNaN(Eан)) return "Введите значения";
                                        
                                        return Eкат - Eан;
                                    },
                                    steps: function(inputs) {
                                        const Eкат = parseFloat(inputs['E<sub>кат</sub> (потенциал катода, В)']);
                                        const Eан = parseFloat(inputs['E<sub>ан</sub> (потенциал анода, В)']);
                                        
                                        if (isNaN(Eкат) || isNaN(Eан)) return ["Введите значения"];
                                        
                                        const E = Eкат - Eан;
                                        
                                        return [
                                            `Шаг 1: Записываем формулу: E = E_кат - E_ан`,
                                            `Шаг 2: Подставляем значения: E = ${Eкат} - ${Eан}`,
                                            `Шаг 3: Вычисляем: E = ${E} В`,
                                            `Шаг 4: Получаем результат: E = ${E} В`
                                        ];
                                    }
                                }
                            }
                        ]
                    }
                },
                10: {
                    organic: {
                        title: "Органическая химия",
                        formulas: [
                            {
                                name: "Общая формула алканов",
                                formula: "C<sub>n</sub>H<sub>2n+2</sub>",
                                explanation: "Общая формула насыщенных углеводородов (алканов).",
                                calculator: {
                                    inputs: [
                                        { label: "n (число атомов углерода)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const n = parseInt(inputs['n (число атомов углерода)']);
                                        
                                        if (isNaN(n)) return "Введите значение";
                                        
                                        return `C${n}H${2*n + 2}`;
                                    },
                                    steps: function(inputs) {
                                        const n = parseInt(inputs['n (число атомов углерода)']);
                                        
                                        if (isNaN(n)) return ["Введите значение"];
                                        
                                        return [
                                            `Шаг 1: Записываем общую формулу алканов: CnH2n+2`,
                                            `Шаг 2: Подставляем значение n = ${n}`,
                                            `Шаг 3: Вычисляем число атомов водорода: 2n + 2 = 2×${n} + 2 = ${2*n + 2}`,
                                            `Шаг 4: Получаем формулу: C${n}H${2*n + 2}`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Общая формула алкенов",
                                formula: "C<sub>n</sub>H<sub>2n</sub>",
                                explanation: "Общая формула ненасыщенных углеводородов с одной двойной связью (алкенов).",
                                calculator: {
                                    inputs: [
                                        { label: "n (число атомов углерода)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const n = parseInt(inputs['n (число атомов углерода)']);
                                        
                                        if (isNaN(n)) return "Введите значение";
                                        
                                        return `C${n}H${2*n}`;
                                    },
                                    steps: function(inputs) {
                                        const n = parseInt(inputs['n (число атомов углерода)']);
                                        
                                        if (isNaN(n)) return ["Введите значение"];
                                        
                                        return [
                                            `Шаг 1: Записываем общую формулу алкенов: CnH2n`,
                                            `Шаг 2: Подставляем значение n = ${n}`,
                                            `Шаг 3: Вычисляем число атомов водорода: 2n = 2×${n} = ${2*n}`,
                                            `Шаг 4: Получаем формулу: C${n}H${2*n}`
                                        ];
                                    }
                                }
                            }
                        ]
                    },
                    thermodynamics: {
                        title: "Термодинамика",
                        formulas: [
                            {
                                name: "Первый закон термодинамики",
                                formula: "ΔU = Q + A",
                                explanation: "Изменение внутренней энергии системы равно сумме количества теплоты, переданного системе, и работы, совершенной над системой.",
                                calculator: {
                                    inputs: [
                                        { label: "Q (количество теплоты, Дж)", value: "" },
                                        { label: "A (работа, Дж)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const Q = parseFloat(inputs['Q (количество теплоты, Дж)']);
                                        const A = parseFloat(inputs['A (работа, Дж)']);
                                        
                                        if (isNaN(Q) || isNaN(A)) return "Введите значения";
                                        
                                        return Q + A;
                                    },
                                    steps: function(inputs) {
                                        const Q = parseFloat(inputs['Q (количество теплоты, Дж)']);
                                        const A = parseFloat(inputs['A (работа, Дж)']);
                                        
                                        if (isNaN(Q) || isNaN(A)) return ["Введите значения"];
                                        
                                        const ΔU = Q + A;
                                        
                                        return [
                                            `Шаг 1: Записываем закон: ΔU = Q + A`,
                                            `Шаг 2: Подставляем значения: ΔU = ${Q} + ${A}`,
                                            `Шаг 3: Вычисляем: ΔU = ${ΔU} Дж`,
                                            `Шаг 4: Получаем результат: ΔU = ${ΔU} Дж`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Энтропия",
                                formula: "ΔS = Q / T",
                                explanation: "Изменение энтропии равно количеству теплоты, переданному системе, деленному на температуру.",
                                calculator: {
                                    inputs: [
                                        { label: "Q (количество теплоты, Дж)", value: "" },
                                        { label: "T (температура, К)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const Q = parseFloat(inputs['Q (количество теплоты, Дж)']);
                                        const T = parseFloat(inputs['T (температура, К)']);
                                        
                                        if (isNaN(Q) || isNaN(T)) return "Введите значения";
                                        
                                        return Q / T;
                                    },
                                    steps: function(inputs) {
                                        const Q = parseFloat(inputs['Q (количество теплоты, Дж)']);
                                        const T = parseFloat(inputs['T (температура, К)']);
                                        
                                        if (isNaN(Q) || isNaN(T)) return ["Введите значения"];
                                        
                                        const ΔS = Q / T;
                                        
                                        return [
                                            `Шаг 1: Записываем формулу: ΔS = Q / T`,
                                            `Шаг 2: Подставляем значения: ΔS = ${Q} / ${T}`,
                                            `Шаг 3: Вычисляем: ΔS = ${ΔS} Дж/К`,
                                            `Шаг 4: Получаем результат: ΔS = ${ΔS} Дж/К`
                                        ];
                                    }
                                }
                            }
                        ]
                    },
                    kinetics: {
                        title: "Кинетика",
                        formulas: [
                            {
                                name: "Скорость химической реакции",
                                formula: "v = ±Δc / Δt",
                                explanation: "Скорость химической реакции определяется изменением концентрации реагента или продукта за единицу времени.",
                                calculator: {
                                    inputs: [
                                        { label: "c<sub>1</sub> (начальная концентрация, моль/л)", value: "" },
                                        { label: "c<sub>2</sub> (конечная концентрация, моль/л)", value: "" },
                                        { label: "t (время, с)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const c1 = parseFloat(inputs['c<sub>1</sub> (начальная концентрация, моль/л)']);
                                        const c2 = parseFloat(inputs['c<sub>2</sub> (конечная концентрация, моль/л)']);
                                        const t = parseFloat(inputs['t (время, с)']);
                                        
                                        if (isNaN(c1) || isNaN(c2) || isNaN(t)) return "Введите значения";
                                        
                                        return Math.abs(c2 - c1) / t;
                                    },
                                    steps: function(inputs) {
                                        const c1 = parseFloat(inputs['c<sub>1</sub> (начальная концентрация, моль/л)']);
                                        const c2 = parseFloat(inputs['c<sub>2</sub> (конечная концентрация, моль/л)']);
                                        const t = parseFloat(inputs['t (время, с)']);
                                        
                                        if (isNaN(c1) || isNaN(c2) || isNaN(t)) return ["Введите значения"];
                                        
                                        const v = Math.abs(c2 - c1) / t;
                                        
                                        return [
                                            `Шаг 1: Записываем формулу: v = |Δc| / Δt`,
                                            `Шаг 2: Вычисляем изменение концентрации: |Δc| = |${c2} - ${c1}| = ${Math.abs(c2 - c1)}`,
                                            `Шаг 3: Подставляем значения: v = ${Math.abs(c2 - c1)} / ${t}`,
                                            `Шаг 4: Вычисляем: v = ${v} моль/(л·с)`,
                                            `Шаг 5: Получаем результат: v = ${v} моль/(л·с)`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Закон действия масс",
                                formula: "v = k·[A]<sup>m</sup>·[B]<sup>n</sup>",
                                explanation: "Скорость химической реакции пропорциональна произведению концентраций реагентов в степенях, равных их стехиометрическим коэффициентам.",
                                calculator: {
                                    inputs: [
                                        { label: "k (константа скорости)", value: "" },
                                        { label: "[A] (концентрация A, моль/л)", value: "" },
                                        { label: "m (порядок по A)", value: "" },
                                        { label: "[B] (концентрация B, моль/л)", value: "" },
                                        { label: "n (порядок по B)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const k = parseFloat(inputs['k (константа скорости)']);
                                        const A = parseFloat(inputs['[A] (концентрация A, моль/л)']);
                                        const m = parseFloat(inputs['m (порядок по A)']);
                                        const B = parseFloat(inputs['[B] (концентрация B, моль/л)']);
                                        const n = parseFloat(inputs['n (порядок по B)']);
                                        
                                        if (isNaN(k) || isNaN(A) || isNaN(m) || isNaN(B) || isNaN(n)) return "Введите значения";
                                        
                                        return k * Math.pow(A, m) * Math.pow(B, n);
                                    },
                                    steps: function(inputs) {
                                        const k = parseFloat(inputs['k (константа скорости)']);
                                        const A = parseFloat(inputs['[A] (концентрация A, моль/л)']);
                                        const m = parseFloat(inputs['m (порядок по A)']);
                                        const B = parseFloat(inputs['[B] (концентрация B, моль/л)']);
                                        const n = parseFloat(inputs['n (порядок по B)']);
                                        
                                        if (isNaN(k) || isNaN(A) || isNaN(m) || isNaN(B) || isNaN(n)) return ["Введите значения"];
                                        
                                        const v = k * Math.pow(A, m) * Math.pow(B, n);
                                        
                                        return [
                                            `Шаг 1: Записываем закон: v = k·[A]^m·[B]^n`,
                                            `Шаг 2: Подставляем значения: v = ${k} × [${A}]^${m} × [${B}]^${n}`,
                                            `Шаг 3: Вычисляем [A]^m = ${A}^${m} = ${Math.pow(A, m)}`,
                                            `Шаг 4: Вычисляем [B]^n = ${B}^${n} = ${Math.pow(B, n)}`,
                                            `Шаг 5: Вычисляем: v = ${k} × ${Math.pow(A, m)} × ${Math.pow(B, n)} = ${v} моль/(л·с)`,
                                            `Шаг 6: Получаем результат: v = ${v} моль/(л·с)`
                                        ];
                                    }
                                }
                            }
                        ]
                    }
                },
                11: {
                    "advanced-organic": {
                        title: "Продвинутая органическая химия",
                        formulas: [
                            {
                                name: "Реакция Вюрца",
                                formula: "2R-X + 2Na → R-R + 2NaX",
                                explanation: "Реакция Вюрца позволяет удвоить углеводородную цепь алкилгалогенидов с образованием алканов.",
                                calculator: {
                                    inputs: [
                                        { label: "R (углеводородный радикал)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const R = inputs['R (углеводородный радикал)'];
                                        
                                        if (!R) return "Введите радикал";
                                        
                                        return `${R}-${R}`;
                                    },
                                    steps: function(inputs) {
                                        const R = inputs['R (углеводородный радикал)'];
                                        
                                        if (!R) return ["Введите радикал"];
                                        
                                        return [
                                            `Шаг 1: Записываем реакцию Вюрца: 2R-X + 2Na → R-R + 2NaX`,
                                            `Шаг 2: Подставляем радикал R = ${R}`,
                                            `Шаг 3: Получаем продукт: ${R}-${R}`,
                                            `Шаг 4: Реакция: 2${R}-X + 2Na → ${R}-${R} + 2NaX`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Реакция Кучерова",
                                formula: "C<sub>2</sub>H<sub>2</sub> + H<sub>2</sub>O → CH<sub>3</sub>CHO",
                                explanation: "Гидратация ацетилена приводит к образованию ацетальдегида.",
                                calculator: {
                                    inputs: [],
                                    calculate: function(inputs) {
                                        return "CH₃CHO";
                                    },
                                    steps: function(inputs) {
                                        return [
                                            `Шаг 1: Записываем реакцию Кучерова: C₂H₂ + H₂O → CH₃CHO`,
                                            `Шаг 2: Ацетилен взаимодействует с водой в присутствии катализатора Hg²⁺`,
                                            `Шаг 3: Образуется промежуточный продукт - виниловый спирт`,
                                            `Шаг 4: Виниловый спирт изомеризуется в ацетальдегид`,
                                            `Шаг 5: Получаем конечный продукт: CH₃CHO`
                                        ];
                                    }
                                }
                            }
                        ]
                    },
                    biochemistry: {
                        title: "Биохимия",
                        formulas: [
                            {
                                name: "Уравнение гидролиза крахмала",
                                formula: "(C<sub>6</sub>H<sub>10</sub>O<sub>5</sub>)<sub>n</sub> + nH<sub>2</sub>O → nC<sub>6</sub>H<sub>12</sub>O<sub>6</sub>",
                                explanation: "Гидролиз крахмала приводит к образованию глюкозы.",
                                calculator: {
                                    inputs: [
                                        { label: "n (число звеньев)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const n = parseInt(inputs['n (число звеньев)']);
                                        
                                        if (isNaN(n)) return "Введите значение";
                                        
                                        return `${n}C₆H₁₂O₆`;
                                    },
                                    steps: function(inputs) {
                                        const n = parseInt(inputs['n (число звеньев)']);
                                        
                                        if (isNaN(n)) return ["Введите значение"];
                                        
                                        return [
                                            `Шаг 1: Записываем уравнение: (C₆H₁₀O₅)n + nH₂O → nC₆H₁₂O₆`,
                                            `Шаг 2: Подставляем значение n = ${n}`,
                                            `Шаг 3: Получаем ${n} молекул глюкозы`,
                                            `Шаг 4: Уравнение: (C₆H₁₀O₅)${n} + ${n}H₂O → ${n}C₆H₁₂O₆`
                                        ];
                                    }
                                }
                            },
                            {
                                name: "Уравнение дыхания",
                                formula: "C<sub>6</sub>H<sub>12</sub>O<sub>6</sub> + 6O<sub>2</sub> → 6CO<sub>2</sub> + 6H<sub>2</sub>O + энергия",
                                explanation: "Процесс клеточного дыхания, в ходе которого глюкоза окисляется с выделением энергии.",
                                calculator: {
                                    inputs: [
                                        { label: "m (масса глюкозы, г)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const m = parseFloat(inputs['m (масса глюкозы, г)']);
                                        const M_glucose = 180; // Молярная масса глюкозы
                                        
                                        if (isNaN(m)) return "Введите значение";
                                        
                                        const moles = m / M_glucose;
                                        const energy = moles * 2870; // кДж/моль
                                        return energy.toFixed(2);
                                    },
                                    steps: function(inputs) {
                                        const m = parseFloat(inputs['m (масса глюкозы, г)']);
                                        const M_glucose = 180; // Молярная масса глюкозы
                                        
                                        if (isNaN(m)) return ["Введите значение"];
                                        
                                        const moles = m / M_glucose;
                                        const energy = moles * 2870; // кДж/моль
                                        
                                        return [
                                            `Шаг 1: Записываем уравнение: C₆H₁₂O₆ + 6O₂ → 6CO₂ + 6H₂O + энергия`,
                                            `Шаг 2: Молярная масса глюкозы: 180 г/моль`,
                                            `Шаг 3: Количество вещества глюкозы: ${m} / 180 = ${moles.toFixed(2)} моль`,
                                            `Шаг 4: Энергия, выделяющаяся при окислении 1 моль глюкозы: 2870 кДж`,
                                            `Шаг 5: Общая энергия: ${moles.toFixed(2)} × 2870 = ${energy.toFixed(2)} кДж`,
                                            `Шаг 6: Получаем результат: ${energy.toFixed(2)} кДж`
                                        ];
                                    }
                                }
                            }
                        ]
                    },
                    analytical: {
                        title: "Аналитическая химия",
                        formulas: [
                            {
                                name: "Титрование",
                                formula: "C<sub>1</sub>V<sub>1</sub> = C<sub>2</sub>V<sub>2</sub>",
                                explanation: "При титровании произведение концентрации на объем одного раствора равно произведению концентрации на объем другого раствора.",
                                calculator: {
                                    inputs: [
                                        { label: "C₁ (концентрация первого раствора, моль/л)", value: "" },
                                        { label: "V₁ (объем первого раствора, л)", value: "" },
                                        { label: "C₂ (концентрация второго раствора, моль/л)", value: "" },
                                        { label: "V₂ (объем второго раствора, л)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const C1 = inputs['C₁ (концентрация первого раствора, моль/л)'] ? parseFloat(inputs['C₁ (концентрация первого раствора, моль/л)']) : null;
                                        const V1 = inputs['V₁ (объем первого раствора, л)'] ? parseFloat(inputs['V₁ (объем первого раствора, л)']) : null;
                                        const C2 = inputs['C₂ (концентрация второго раствора, моль/л)'] ? parseFloat(inputs['C₂ (концентрация второго раствора, моль/л)']) : null;
                                        const V2 = inputs['V₂ (объем второго раствора, л)'] ? parseFloat(inputs['V₂ (объем второго раствора, л)']) : null;
                                        
                                        if (C1 !== null && V1 !== null && C2 !== null) return (C1 * V1) / C2;
                                        if (C1 !== null && V1 !== null && V2 !== null) return (C1 * V1) / V2;
                                        if (C1 !== null && C2 !== null && V2 !== null) return (C2 * V2) / C1;
                                        if (V1 !== null && C2 !== null && V2 !== null) return (C2 * V2) / V1;
                                        
                                        return "Введите три известные величины";
                                    },
                                    steps: function(inputs) {
                                        const C1 = inputs['C₁ (концентрация первого раствора, моль/л)'] ? parseFloat(inputs['C₁ (концентрация первого раствора, моль/л)']) : null;
                                        const V1 = inputs['V₁ (объем первого раствора, л)'] ? parseFloat(inputs['V₁ (объем первого раствора, л)']) : null;
                                        const C2 = inputs['C₂ (концентрация второго раствора, моль/л)'] ? parseFloat(inputs['C₂ (концентрация второго раствора, моль/л)']) : null;
                                        const V2 = inputs['V₂ (объем второго раствора, л)'] ? parseFloat(inputs['V₂ (объем второго раствора, л)']) : null;
                                        
                                        if (C1 !== null && V1 !== null && C2 !== null) {
                                            const V2_result = (C1 * V1) / C2;
                                            return [
                                                `Шаг 1: Записываем формулу: C₁V₁ = C₂V₂`,
                                                `Шаг 2: Выражаем V₂: V₂ = C₁V₁ / C₂`,
                                                `Шаг 3: Подставляем значения: V₂ = ${C1} × ${V1} / ${C2}`,
                                                `Шаг 4: Вычисляем: V₂ = ${C1 * V1} / ${C2} = ${V2_result} л`,
                                                `Шаг 5: Получаем результат: V₂ = ${V2_result} л`
                                            ];
                                        }
                                        
                                        if (C1 !== null && V1 !== null && V2 !== null) {
                                            const C2_result = (C1 * V1) / V2;
                                            return [
                                                `Шаг 1: Записываем формулу: C₁V₁ = C₂V₂`,
                                                `Шаг 2: Выражаем C₂: C₂ = C₁V₁ / V₂`,
                                                `Шаг 3: Подставляем значения: C₂ = ${C1} × ${V1} / ${V2}`,
                                                `Шаг 4: Вычисляем: C₂ = ${C1 * V1} / ${V2} = ${C2_result} моль/л`,
                                                `Шаг 5: Получаем результат: C₂ = ${C2_result} моль/л`
                                            ];
                                        }
                                        
                                        if (C1 !== null && C2 !== null && V2 !== null) {
                                            const V1_result = (C2 * V2) / C1;
                                            return [
                                                `Шаг 1: Записываем формулу: C₁V₁ = C₂V₂`,
                                                `Шаг 2: Выражаем V₁: V₁ = C₂V₂ / C₁`,
                                                `Шаг 3: Подставляем значения: V₁ = ${C2} × ${V2} / ${C1}`,
                                                `Шаг 4: Вычисляем: V₁ = ${C2 * V2} / ${C1} = ${V1_result} л`,
                                                `Шаг 5: Получаем результат: V₁ = ${V1_result} л`
                                            ];
                                        }
                                        
                                        if (V1 !== null && C2 !== null && V2 !== null) {
                                            const C1_result = (C2 * V2) / V1;
                                            return [
                                                `Шаг 1: Записываем формулу: C₁V₁ = C₂V₂`,
                                                `Шаг 2: Выражаем C₁: C₁ = C₂V₂ / V₁`,
                                                `Шаг 3: Подставляем значения: C₁ = ${C2} × ${V2} / ${V1}`,
                                                `Шаг 4: Вычисляем: C₁ = ${C2 * V2} / ${V1} = ${C1_result} моль/л`,
                                                `Шаг 5: Получаем результат: C₁ = ${C1_result} моль/л`
                                            ];
                                        }
                                        
                                        return ["Введите три известные величины"];
                                    }
                                }
                            },
                            {
                                name: "pH раствора",
                                formula: "pH = -log[H<sup>+</sup>]",
                                explanation: "Водородный показатель pH определяется как отрицательный десятичный логарифм концентрации ионов водорода.",
                                calculator: {
                                    inputs: [
                                        { label: "[H⁺] (концентрация ионов водорода, моль/л)", value: "" }
                                    ],
                                    calculate: function(inputs) {
                                        const H = parseFloat(inputs['[H⁺] (концентрация ионов водорода, моль/л)']);
                                        
                                        if (isNaN(H)) return "Введите значение";
                                        
                                        return -Math.log10(H);
                                    },
                                    steps: function(inputs) {
                                        const H = parseFloat(inputs['[H⁺] (концентрация ионов водорода, моль/л)']);
                                        
                                        if (isNaN(H)) return ["Введите значение"];
                                        
                                        const pH = -Math.log10(H);
                                        
                                        return [
                                            `Шаг 1: Записываем формулу: pH = -log[H⁺]`,
                                            `Шаг 2: Подставляем значение: pH = -log(${H})`,
                                            `Шаг 3: Вычисляем десятичный логарифм: log(${H}) = ${Math.log10(H)}`,
                                            `Шаг 4: Берем отрицательное значение: pH = -${Math.log10(H)} = ${pH}`,
                                            `Шаг 5: Получаем результат: pH = ${pH}`
                                        ];
                                    }
                                }
                            }
                        ]
                    }
                }
            }
        };

        // Функции для работы с интерфейсом формул
        document.addEventListener('DOMContentLoaded', function() {
            // Инициализация калькулятора и блокнота
            const calculator = new EngineeringCalculator();
            const notebook = new Notebook();
            
            // Обработчики для вкладок
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // Убираем активный класс со всех вкладок и контента
                    tabs.forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    // Добавляем активный класс к текущей вкладке и контенту
                    this.classList.add('active');
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                    
                    // Инициализируем калькулятор при переходе на его вкладку
                    if (tabId === 'calculator') {
                        calculator.updateDisplay();
                    }
                });
            });
            
            // Обработчики для раскрытия/скрытия списков
            const subjectTitles = document.querySelectorAll('.subject-title');
            subjectTitles.forEach(title => {
                title.addEventListener('click', function() {
                    const classList = this.parentElement.querySelector('.class-list');
                    const arrow = this.querySelector('.arrow');
                    classList.classList.toggle('active');
                    arrow.classList.toggle('rotated');
                });
            });
            
            // Обработчики для классов
            const classTitles = document.querySelectorAll('.class-title');
            classTitles.forEach(title => {
                title.addEventListener('click', function() {
                    const topicList = this.parentElement.querySelector('.topic-list');
                    const arrow = this.querySelector('.arrow');
                    topicList.classList.toggle('active');
                    arrow.classList.toggle('rotated');
                });
            });
            
            // Обработчики для выбора темы
            const topicItems = document.querySelectorAll('.topic-item');
            topicItems.forEach(item => {
                item.addEventListener('click', function() {
                    const subject = this.dataset.subject;
                    const classNum = this.dataset.class;
                    const topic = this.dataset.topic;
                    
                    displayFormulas(subject, classNum, topic);
                    updateRecommendations(subject, classNum, topic);
                });
            });
            
            // Обработчик для кнопки "Решить"
            document.querySelector('.calculate-btn')?.addEventListener('click', function() {
                calculateFormula();
            });
            
            // Обработчик для кнопки "Показать шаги решения"
            document.querySelector('.show-steps-btn')?.addEventListener('click', function() {
                showSteps();
            });
            
            // Обработчик для поиска
            const searchBox = document.querySelector('.search-box');
            const searchSuggestions = document.querySelector('.search-suggestions');
            searchBox.addEventListener('input', function() {
                const query = this.value;
                if (query.length > 0) {
                    showSearchSuggestions(query);
                    searchSuggestions.style.display = 'block';
                } else {
                    searchSuggestions.style.display = 'none';
                }
            });
            
            // Закрытие подсказок при клике вне области поиска
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.search-container')) {
                    searchSuggestions.style.display = 'none';
                }
            });
            
            // Обработчики для фильтров
            document.getElementById('subject-filter')?.addEventListener('change', function() {
                applyFilters();
            });
            
            document.getElementById('class-filter')?.addEventListener('change', function() {
                applyFilters();
            });
        });
        
        // Функция отображения формул
        function displayFormulas(subject, classNum, topic) {
            const formulaData = formulasData[subject]?.[classNum]?.[topic];
            if (!formulaData) {
                // Если данные не найдены, показываем сообщение
                const formulaContainer = document.querySelector('.formula-container');
                formulaContainer.innerHTML = `
                    <h2 class="formula-title">Тема не найдена</h2>
                    <div class="formula-display">Информация по выбранной теме пока недоступна.</div>
                `;
                return;
            }
            
            const formulaContainer = document.querySelector('.formula-container');
            const formulaTitle = formulaContainer.querySelector('.formula-title');
            const formulaDisplay = formulaContainer.querySelector('.formula-display');
            const stepByStep = formulaContainer.querySelector('.step-by-step');
            const inputGroup = formulaContainer.querySelector('.input-group');
            const result = formulaContainer.querySelector('.result');
            
            // Очищаем контейнер
            formulaDisplay.innerHTML = '';
            stepByStep.style.display = 'none';
            inputGroup.innerHTML = '';
            result.style.display = 'none';
            
            // Устанавливаем заголовок
            formulaTitle.textContent = formulaData.title;
            
            // Создаем аккордеон для формул
            formulaData.formulas.forEach((formula, index) => {
                const formulaElement = document.createElement('div');
                formulaElement.className = 'formula-item';
                formulaElement.innerHTML = `
                    <h3>${formula.name}</h3>
                    <div class="formula">${formula.formula}</div>
                    <div class="explanation">${formula.explanation}</div>
                    <button class="use-formula-btn" data-index="${index}">Использовать формулу</button>
                `;
                formulaDisplay.appendChild(formulaElement);
                
                // Обработчик для кнопки "Использовать формулу"
                formulaElement.querySelector('.use-formula-btn').addEventListener('click', function() {
                    const formulaIndex = parseInt(this.dataset.index);
                    setupCalculator(formulaData.formulas[formulaIndex]);
                });
            });
        }
        
        // Функция настройки калькулятора
        function setupCalculator(formula) {
            const inputGroup = document.querySelector('.input-group');
            const result = document.querySelector('.result');
            const stepByStep = document.querySelector('.step-by-step');
            
            // Очищаем поля ввода
            inputGroup.innerHTML = '';
            result.style.display = 'none';
            stepByStep.style.display = 'none';
            
            // Создаем поля ввода
            formula.calculator.inputs.forEach(input => {
                const inputField = document.createElement('input');
                inputField.type = 'text';
                inputField.className = 'input-field';
                inputField.placeholder = input.label;
                inputField.dataset.label = input.label;
                inputField.value = input.value;
                inputGroup.appendChild(inputField);
            });
            
            // Сохраняем данные формулы для использования при нажатии кнопки
            inputGroup.dataset.formulaData = JSON.stringify(formula);
        }
        
        // Функция расчета формулы
        function calculateFormula() {
            const inputFields = document.querySelectorAll('.input-field');
            const result = document.querySelector('.result');
            const formulaDataString = document.querySelector('.input-group').dataset.formulaData;
            
            if (!formulaDataString) {
                result.textContent = "Сначала выберите формулу";
                result.style.display = 'block';
                return;
            }
            
            const formula = JSON.parse(formulaDataString);
            const inputs = {};
            
            inputFields.forEach(field => {
                inputs[field.dataset.label] = field.value;
            });
            
            try {
                const calculatedResult = formula.calculator.calculate(inputs);
                result.textContent = `Результат: ${calculatedResult}`;
                result.style.display = 'block';
            } catch (e) {
                result.textContent = `Ошибка: ${e.message}`;
                result.style.display = 'block';
            }
        }
        
        // Функция показа шагов решения
        function showSteps() {
            const inputFields = document.querySelectorAll('.input-field');
            const stepByStep = document.querySelector('.step-by-step');
            const stepsContainer = stepByStep.querySelector('.steps-container');
            const formulaDataString = document.querySelector('.input-group').dataset.formulaData;
            
            if (!formulaDataString) {
                alert("Сначала выберите формулу");
                return;
            }
            
            const formula = JSON.parse(formulaDataString);
            const inputs = {};
            
            inputFields.forEach(field => {
                inputs[field.dataset.label] = field.value;
            });
            
            try {
                const steps = formula.calculator.steps(inputs);
                
                stepsContainer.innerHTML = '';
                steps.forEach(step => {
                    const stepElement = document.createElement('div');
                    stepElement.className = 'step';
                    stepElement.textContent = step;
                    stepsContainer.appendChild(stepElement);
                });
                
                stepByStep.style.display = 'block';
            } catch (e) {
                alert(`Ошибка: ${e.message}`);
            }
        }
        
        // Функция показа подсказок поиска
        function showSearchSuggestions(query) {
            const suggestionsContainer = document.querySelector('.search-suggestions');
            suggestionsContainer.innerHTML = '';
            const lowerQuery = query.toLowerCase();
            let suggestions = [];
            
            // Ищем совпадения в названиях тем и формул
            for (const subject in formulasData) {
                for (const classNum in formulasData[subject]) {
                    for (const topic in formulasData[subject][classNum]) {
                        const topicData = formulasData[subject][classNum][topic];
                        
                        // Проверяем совпадение в названии темы
                        if (topicData.title.toLowerCase().includes(lowerQuery)) {
                            suggestions.push({
                                type: 'topic',
                                subject: subject,
                                class: classNum,
                                topic: topic,
                                name: topicData.title,
                                display: `Тема: ${topicData.title}`
                            });
                        }
                        
                        // Проверяем совпадение в названиях формул
                        if (topicData.formulas) {
                            topicData.formulas.forEach(formula => {
                                if (formula.name.toLowerCase().includes(lowerQuery) || 
                                    formula.formula.toLowerCase().includes(lowerQuery)) {
                                    suggestions.push({
                                        type: 'formula',
                                        subject: subject,
                                        class: classNum,
                                        topic: topic,
                                        name: formula.name,
                                        display: `Формула: ${formula.name} (${topicData.title})`
                                    });
                                }
                            });
                        }
                    }
                }
            }
            
            // Ограничиваем количество подсказок
            suggestions = suggestions.slice(0, 10);
            
            // Создаем элементы подсказок
            suggestions.forEach(suggestion => {
                const suggestionElement = document.createElement('div');
                suggestionElement.className = 'suggestion-item';
                suggestionElement.textContent = suggestion.display;
                
                suggestionElement.addEventListener('click', () => {
                    document.querySelector('.search-box').value = '';
                    document.querySelector('.search-suggestions').style.display = 'none';
                    
                    if (suggestion.type === 'topic') {
                        displayFormulas(suggestion.subject, suggestion.class, suggestion.topic);
                        updateRecommendations(suggestion.subject, suggestion.class, suggestion.topic);
                    } else {
                        displayFormulas(suggestion.subject, suggestion.class, suggestion.topic);
                        updateRecommendations(suggestion.subject, suggestion.class, suggestion.topic);
                        
                        // Находим индекс формулы и нажимаем кнопку "Использовать формулу"
                        setTimeout(() => {
                            const formulaItems = document.querySelectorAll('.formula-item');
                            formulaItems.forEach((item, index) => {
                                if (item.querySelector('h3').textContent === suggestion.name) {
                                    item.querySelector('.use-formula-btn').click();
                                }
                            });
                        }, 100);
                    }
                });
                
                suggestionsContainer.appendChild(suggestionElement);
            });
            
            if (suggestions.length === 0) {
                const noResults = document.createElement('div');
                noResults.className = 'suggestion-item';
                noResults.textContent = 'Ничего не найдено';
                suggestionsContainer.appendChild(noResults);
            }
        }
        
        // Функция применения фильтров
        function applyFilters() {
            const subjectFilter = document.getElementById('subject-filter').value;
            const classFilter = document.getElementById('class-filter').value;
            
            document.querySelectorAll('.topic-item').forEach(item => {
                const subject = item.dataset.subject;
                const classNum = item.dataset.class;
                
                const subjectMatch = subjectFilter === 'all' || subject === subjectFilter;
                const classMatch = classFilter === 'all' || classNum === classFilter;
                
                if (subjectMatch && classMatch) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }
        
        // Функция обновления рекомендаций
        function updateRecommendations(subject, classNum, topic) {
            const recommendationsList = document.querySelector('.recommendations-list');
            recommendationsList.innerHTML = '';
            
            // Создаем рекомендации на основе выбранной темы
            const recommendations = [];
            
            // Рекомендуем другие темы из того же класса и предмета
            if (formulasData[subject] && formulasData[subject][classNum]) {
                for (const otherTopic in formulasData[subject][classNum]) {
                    if (otherTopic !== topic) {
                        recommendations.push({
                            subject: subject,
                            class: classNum,
                            topic: otherTopic,
                            name: formulasData[subject][classNum][otherTopic].title
                        });
                    }
                }
            }
            
            // Ограничиваем количество рекомендаций
            const limitedRecommendations = recommendations.slice(0, 5);
            
            limitedRecommendations.forEach(rec => {
                const recElement = document.createElement('div');
                recElement.className = 'recommendation-item';
                recElement.textContent = rec.name;
                
                recElement.addEventListener('click', () => {
                    displayFormulas(rec.subject, rec.class, rec.topic);
                    updateRecommendations(rec.subject, rec.class, rec.topic);
                });
                
                recommendationsList.appendChild(recElement);
            });
            
            if (limitedRecommendations.length === 0) {
                recommendationsList.innerHTML = '<div class="recommendation-item">Рекомендации появятся здесь после выбора темы</div>';
            }
        }
        
        // Класс для инженерного калькулятора
        class EngineeringCalculator {
            constructor() {
                this.display = document.querySelector('.calc-display');
                this.currentInput = '0';
                this.waitingForNewInput = true;
                this.memory = 0;
                this.lastResult = null;
                
                this.setupEventListeners();
                this.updateDisplay();
            }
            
            setupEventListeners() {
                const buttons = document.querySelectorAll('.calc-btn');
                
                buttons.forEach(button => {
                    button.addEventListener('click', () => {
                        const value = button.textContent;
                        const action = button.getAttribute('data-action');
                        
                        if (value === 'C') {
                            this.clear();
                        } else if (value === '⌫') {
                            this.backspace();
                        } else if (value === '=') {
                            this.calculate();
                        } else if (value === 'x²') {
                            this.square();
                        } else if (value === 'x³') {
                            this.cube();
                        } else if (value === 'x^y') {
                            this.power();
                        } else if (value === '√') {
                            this.sqrt();
                        } else if (value === 'sin') {
                            this.sin();
                        } else if (value === 'cos') {
                            this.cos();
                        } else if (value === 'tan') {
                            this.tan();
                        } else if (value === 'log') {
                            this.log();
                        } else if (value === '±') {
                            this.toggleSign();
                        } else if (value === '(' || value === ')') {
                            this.addParentheses(value);
                        } else if (value === '0' || value === '1' || value === '2' || 
                                   value === '3' || value === '4' || value === '5' || 
                                   value === '6' || value === '7' || value === '8' || 
                                   value === '9' || value === '.') {
                            this.inputNumber(value);
                        } else if (value === '+' || value === '-' || value === '×' || value === '÷') {
                            this.inputOperator(value);
                        }
                        
                        this.updateDisplay();
                    });
                });
            }
            
            updateDisplay() {
                this.display.textContent = this.currentInput;
            }
            
            clear() {
                this.currentInput = '0';
                this.waitingForNewInput = true;
            }
            
            backspace() {
                if (this.currentInput.length > 1) {
                    this.currentInput = this.currentInput.slice(0, -1);
                } else {
                    this.currentInput = '0';
                }
                this.waitingForNewInput = false;
            }
            
            calculate() {
                try {
                    // Заменяем символы для корректного вычисления
                    let expression = this.currentInput
                        .replace(/×/g, '*')
                        .replace(/÷/g, '/');
                    
                    // Вычисляем выражение
                    const result = eval(expression);
                    
                    // Сохраняем результат для дальнейших вычислений
                    this.lastResult = result;
                    
                    // Отображаем результат
                    this.currentInput = result.toString();
                    this.waitingForNewInput = true;
                } catch (e) {
                    this.currentInput = 'Ошибка';
                    setTimeout(() => {
                        this.currentInput = '0';
                        this.waitingForNewInput = true;
                        this.updateDisplay();
                    }, 1500);
                }
            }
            
            inputNumber(number) {
                if (this.waitingForNewInput) {
                    this.currentInput = number;
                    this.waitingForNewInput = false;
                } else {
                    // Предотвращаем множественные точки
                    if (number === '.' && this.currentInput.includes('.')) {
                        return;
                    }
                    this.currentInput += number;
                }
            }
            
            inputOperator(operator) {
                if (this.waitingForNewInput && this.lastResult !== null) {
                    this.currentInput = this.lastResult.toString();
                    this.waitingForNewInput = false;
                }
                this.currentInput += operator;
                this.waitingForNewInput = true;
            }
            
            square() {
                this.currentInput = `(${this.currentInput})²`;
                this.waitingForNewInput = true;
                this.updateDisplay();
                setTimeout(() => {
                    this.calculate();
                }, 100);
            }
            
            cube() {
                this.currentInput = `(${this.currentInput})³`;
                this.waitingForNewInput = true;
                this.updateDisplay();
                setTimeout(() => {
                    this.calculate();
                }, 100);
            }
            
            power() {
                this.currentInput = `${this.currentInput}^`;
                this.waitingForNewInput = false;
            }
            
            sqrt() {
                this.currentInput = `√(${this.currentInput})`;
                this.waitingForNewInput = true;
                this.updateDisplay();
                setTimeout(() => {
                    this.calculate();
                }, 100);
            }
            
            sin() {
                this.currentInput = `sin(${this.currentInput})`;
                this.waitingForNewInput = true;
                this.updateDisplay();
                setTimeout(() => {
                    this.calculate();
                }, 100);
            }
            
            cos() {
                this.currentInput = `cos(${this.currentInput})`;
                this.waitingForNewInput = true;
                this.updateDisplay();
                setTimeout(() => {
                    this.calculate();
                }, 100);
            }
            
            tan() {
                this.currentInput = `tan(${this.currentInput})`;
                this.waitingForNewInput = true;
                this.updateDisplay();
                setTimeout(() => {
                    this.calculate();
                }, 100);
            }
            
            log() {
                this.currentInput = `log(${this.currentInput})`;
                this.waitingForNewInput = true;
                this.updateDisplay();
                setTimeout(() => {
                    this.calculate();
                }, 100);
            }
            
            toggleSign() {
                if (this.currentInput.startsWith('-')) {
                    this.currentInput = this.currentInput.substring(1);
                } else {
                    this.currentInput = '-' + this.currentInput;
                }
            }
            
            addParentheses(value) {
                this.currentInput += value;
                this.waitingForNewInput = false;
            }
        }
        
        // Класс для блокнота
        class Notebook {
            constructor() {
                this.currentPage = 1;
                this.textareas = [
                    document.getElementById('page1-text'),
                    document.getElementById('page2-text'),
                    document.getElementById('page3-text')
                ];
                this.canvases = [
                    document.getElementById('page1-canvas'),
                    document.getElementById('page2-canvas'),
                    document.getElementById('page3-canvas')
                ];
                
                this.currentTool = 'text';
                this.ctxs = this.canvases.map(canvas => canvas ? canvas.getContext('2d') : null);
                this.isDrawing = false;
                this.lastX = 0;
                this.lastY = 0;
                this.color = '#000000';
                
                this.setupEventListeners();
                this.initCanvases();
                this.switchPage(1);
            }
            
            initCanvases() {
                this.canvases.forEach((canvas, index) => {
                    if (canvas) {
                        this.resizeCanvas(index);
                        this.ctxs[index].fillStyle = 'white';
                        this.ctxs[index].fillRect(0, 0, canvas.width, canvas.height);
                        this.ctxs[index].strokeStyle = '#000000';
                        this.ctxs[index].lineWidth = 2;
                        this.ctxs[index].lineCap = 'round';
                    }
                });
            }
            
            resizeCanvas(pageIndex) {
                if (!this.canvases[pageIndex]) return;
                
                const container = this.canvases[pageIndex].parentElement;
                const width = container.clientWidth;
                const height = container.clientHeight;
                
                // Сохраняем содержимое холста
                const imageData = this.ctxs[pageIndex].getImageData(0, 0, this.canvases[pageIndex].width, this.canvases[pageIndex].height);
                
                // Устанавливаем новые размеры
                this.canvases[pageIndex].width = width;
                this.canvases[pageIndex].height = height;
                
                // Восстанавливаем содержимое
                this.ctxs[pageIndex].putImageData(imageData, 0, 0);
            }
            
            setupEventListeners() {
                // Обработчики для переключения страниц
                const pageButtons = document.querySelectorAll('.page-btn');
                pageButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        const page = parseInt(button.dataset.page);
                        this.switchPage(page);
                    });
                });
                
                // Обработчики для инструментов
                const toolButtons = document.querySelectorAll('.tool-btn[data-tool]');
                toolButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        toolButtons.forEach(btn => btn.classList.remove('active'));
                        button.classList.add('active');
                        this.currentTool = button.getAttribute('data-tool');
                        this.switchTool();
                    });
                });
                
                // Обработчики для рисования
                this.canvases.forEach((canvas, index) => {
                    if (canvas) {
                        canvas.addEventListener('mousedown', this.startDrawing.bind(this, index));
                        canvas.addEventListener('mousemove', this.draw.bind(this, index));
                        canvas.addEventListener('mouseup', this.stopDrawing.bind(this));
                        canvas.addEventListener('mouseout', this.stopDrawing.bind(this));
                        
                        // Обработчики для сенсорных устройств
                        canvas.addEventListener('touchstart', this.handleTouchStart.bind(this, index));
                        canvas.addEventListener('touchmove', this.handleTouchMove.bind(this, index));
                        canvas.addEventListener('touchend', this.stopDrawing.bind(this));
                    }
                });
                
                // Обработчики для цветов
                const colorButtons = document.querySelectorAll('.tool-btn[data-tool="color"]');
                colorButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        this.color = window.getComputedStyle(button).backgroundColor;
                        colorButtons.forEach(btn => {
                            btn.style.border = 'none';
                        });
                        button.style.border = '2px solid #000';
                    });
                });
                
                // Обработчик для кнопки очистки
                document.querySelector('.clear-btn')?.addEventListener('click', () => {
                    if (this.currentTool === 'text') {
                        this.textareas[this.currentPage - 1].querySelector('textarea').value = '';
                    } else {
                        this.clearCanvas();
                    }
                });
                
                // Обработчик для кнопки сохранения
                document.querySelector('.save-btn')?.addEventListener('click', () => {
                    this.saveNote();
                });
            }
            
            switchPage(page) {
                // Скрываем все страницы
                this.textareas.forEach((textarea, index) => {
                    textarea.classList.remove('active');
                    if (this.canvases[index]) {
                        this.canvases[index].classList.remove('active');
                    }
                });
                
                // Показываем выбранную страницу
                this.textareas[page - 1].classList.add('active');
                if (this.canvases[page - 1]) {
                    this.canvases[page - 1].classList.add('active');
                }
                
                // Обновляем индикатор текущей страницы
                document.getElementById('current-page').textContent = page;
                
                this.currentPage = page;
                this.switchTool();
            }
            
            switchTool() {
                if (this.currentTool === 'text') {
                    this.textareas[this.currentPage - 1].classList.add('active');
                    if (this.canvases[this.currentPage - 1]) {
                        this.canvases[this.currentPage - 1].classList.remove('active');
                    }
                } else {
                    this.textareas[this.currentPage - 1].classList.remove('active');
                    if (this.canvases[this.currentPage - 1]) {
                        this.canvases[this.currentPage - 1].classList.add('active');
                    }
                }
            }
            
            startDrawing(pageIndex, e) {
                if (this.currentTool !== 'draw' && this.currentTool !== 'erase') return;
                
                this.isDrawing = true;
                const rect = this.canvases[pageIndex].getBoundingClientRect();
                this.lastX = e.clientX - rect.left;
                this.lastY = e.clientY - rect.top;
            }
            
            handleTouchStart(pageIndex, e) {
                if (this.currentTool !== 'draw' && this.currentTool !== 'erase') return;
                
                e.preventDefault();
                const touch = e.touches[0];
                const rect = this.canvases[pageIndex].getBoundingClientRect();
                const x = touch.clientX - rect.left;
                const y = touch.clientY - rect.top;
                
                this.isDrawing = true;
                this.lastX = x;
                this.lastY = y;
            }
            
            handleTouchMove(e) {
                if (!this.isDrawing) return;
                
                e.preventDefault();
                const touch = e.touches[0];
                const rect = this.canvases[this.currentPage - 1].getBoundingClientRect();
                const x = touch.clientX - rect.left;
                const y = touch.clientY - rect.top;
                
                this.ctxs[this.currentPage - 1].strokeStyle = this.currentTool === 'erase' ? '#ffffff' : this.color;
                this.ctxs[this.currentPage - 1].lineWidth = this.currentTool === 'erase' ? 20 : 2;
                this.ctxs[this.currentPage - 1].lineCap = 'round';
                
                this.ctxs[this.currentPage - 1].beginPath();
                this.ctxs[this.currentPage - 1].moveTo(this.lastX, this.lastY);
                this.ctxs[this.currentPage - 1].lineTo(x, y);
                this.ctxs[this.currentPage - 1].stroke();
                
                this.lastX = x;
                this.lastY = y;
            }
            
            draw(pageIndex, e) {
                if (!this.isDrawing) return;
                
                const rect = this.canvases[pageIndex].getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                this.ctxs[pageIndex].strokeStyle = this.currentTool === 'erase' ? '#ffffff' : this.color;
                this.ctxs[pageIndex].lineWidth = this.currentTool === 'erase' ? 20 : 2;
                this.ctxs[pageIndex].lineCap = 'round';
                
                this.ctxs[pageIndex].beginPath();
                this.ctxs[pageIndex].moveTo(this.lastX, this.lastY);
                this.ctxs[pageIndex].lineTo(x, y);
                this.ctxs[pageIndex].stroke();
                
                this.lastX = x;
                this.lastY = y;
            }
            
            stopDrawing() {
                this.isDrawing = false;
            }
            
            clearCanvas() {
                const canvas = this.canvases[this.currentPage - 1];
                const ctx = this.ctxs[this.currentPage - 1];
                if (canvas && ctx) {
                    ctx.fillStyle = 'white';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                }
            }
            
            saveNote() {
                if (this.currentTool === 'text') {
                    const text = this.textareas[this.currentPage - 1].querySelector('textarea').value;
                    if (text.trim() === '') {
                        alert('Введите текст перед сохранением');
                        return;
                    }
                    
                    // Создаем элемент для скачивания
                    const blob = new Blob([text], {type: 'text/plain'});
                    const url = URL.createObjectURL(blob);
                    
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `note_page${this.currentPage}.txt`;
                    document.body.appendChild(a);
                    a.click();
                    
                    // Очищаем ссылку
                    setTimeout(() => {
                        document.body.removeChild(a);
                        URL.revokeObjectURL(url);
                    }, 0);
                    
                    alert(`Текст страницы ${this.currentPage} сохранен как note_page${this.currentPage}.txt`);
                } else {
                    // Сохраняем изображение
                    const canvas = this.canvases[this.currentPage - 1];
                    const image = canvas.toDataURL('image/png');
                    const link = document.createElement('a');
                    link.download = `drawing_page${this.currentPage}.png`;
                    link.href = image;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    alert(`Рисунок страницы ${this.currentPage} сохранен как drawing_page${this.currentPage}.png`);
                }
            }
        }
    </script>
</body>
</html>